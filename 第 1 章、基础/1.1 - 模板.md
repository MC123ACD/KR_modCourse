在 `all/entity_db`（简称 E）返回的表内容：

- `E`
	- `entities`
	- `components`

##### 1. `entities` 表中包含的子表，称为模板（template）
- **作用**：创建各种实体，以及支持模板之间的深拷贝
- 默认为空，后面会通过 `kr/game_templates` 和 `all/templates` 模块动态增加模板
- `game_templates` 创建模板时会读取 `kr/balance/balance` 内的数据

##### 2. `components` 表中包含的子表，称为组件（components）
- **作用**：为模板增加组件
- 默认为空，后面会通过 `all/components` 模块动态增加组件

##### 3. 使用模板创建的单位、贴图、精灵等统称为实体（entities）
- 其中单位特指英雄、士兵、敌人

实体创建逻辑见 [[1.4 - 函数#二、实体创建逻辑]]
最终模板参数用于函数等，传递过程： `balance` → 模板 → 实体 → 函数

## 一. 模板操作函数
### [一] 创建模板
```lua
tt = E:register_t(模板, 底模板)
```
  - **作用**：使模板派生于底模板生成新模板（拥有底模板的所有键值对），给模板增加 `template_name` 键，键值为模板名称
  - **返回值**：新模板的引用
  - **原理**：`E.entities.模板 = table.deepclone(E.entities.底模板)`

**示例**：  
```lua
tt = E:register_t("hero_gerald", "hero")  -- tt 等价于 E:get_template("hero_gerald") 即E.entities.hero_gerald
tt.health.hp = 666	-- 爵士模板血量改为 666
```

### [二] 添加组件
```lua
E:add_comps(模板, 组件， ...)
```
  - **作用**：向模板增加多个 `components` 中的组件
  - **原理**：`E.entities.模板.组件 = table.deepclone(组件)`

**示例：**  
```lua
E:add_comps("hero_gerald", "melee", "health")	-- 向爵士模板增加 melee 和 health 组件
```

### [三] 索引模板
```lua
E:get_template(模板)
```
- **原理**：`t = E.entities.模板`

**注意**：需确保模板已存在（通过 `E:register_t` 创建）

**示例：**
```lua
E:get_template("hero_gerald").health.hp = 666	-- 爵士模板血量设置为 666
```

### [四] 复制组件
```lua
key = E:clone_c(组件)
```
- **作用**：将对应键设置为对应组件，用于初始化
- **原理**：`key = table.deepclone(组件)`

**示例：**
```lua
tt.melee.attacks[1] = E:clone_c("aura_attack")	-- 给近战攻击 1 设置范围攻击组件 
```

### [五] 返回指定表内所有包含指定键的子表
```lua
E:filter(表, 键, ...)	-- 可以传任意数量
```
- **作用**：返回一个表，表内具有包含指定键的表

**示例：**
```lua
T = E:filter(store.entities, "tower")	-- 此时 T 是一个表，内有所有包含 tower 键的实体（所有防御塔）

for _, t in pairs(T) do	-- 遍历所有具有 tower 键的实体，使其攻击速度改为 1（将所有已建造的防御塔攻击速度改为 1 秒/次）
	t.attacks.list[1].cooldown = 1
end
```

### [六] 返回所有包含指定键的模板
```lua
E:filter_templates(键, ...)	-- 可以传任意数量
```
- **作用**：返回一个表，表内具有包含指定键的模板
- **原理**：`E:filter(E.entities, ...)`

**示例：**
```lua
T = E:filter_templates("tower")	-- 此时 T 是一个表，内有所有具有 tower 键的模板（所有防御塔）

for _, t in pairs(T) do	-- 遍历所有具有 tower 键的模板，使其降价 10（使所有防御塔价格降低 10 块）
	t.tower.price = t.tower.price - 10
end
```

