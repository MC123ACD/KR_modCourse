所有 lua 文件统称为模块（**module**）

模块主要用于：
1. 分类，将相关函数与变量组织在一个模块，避免将所有代码写到同一个文件内
2. 便于模块化代码复用
3. 独立命名空间，避免命名冲突

### 示例：
**1. 创建一个模块文件：`mymath.lua`**

这个模块将提供一些基本的数学运算
```lua
-- 定义一个名为 mymath 的模块（表）
local mymath = {}

-- 在模块中定义一个常量
mymath.version = "1.0"

-- 在模块中定义一个函数：加法
function mymath.add(a, b)
    return a + b
end

-- 在模块中定义一个函数：乘法
function mymath.mul(a, b)
    return a * b
end

-- 一个私有的局部函数，外部无法直接访问
local function privateFunction()
    print("这是一个私有函数")
end

-- 模块必须返回这个表
return mymath
```

**2. 在另一个模块中使用这个模块**
```lua
-- 加载 mymath 模块
-- require 函数会找到 mymath.lua 文件，执行它，并返回 mymath 表
local mathLib = require("mymath")

-- 使用模块里的功能
print(mathLib.version) 	-- 输出：1.0

local sum = mathLib.add(10, 20)		-- 加法，结果 30

local product = mathLib.mul(5, 6)	-- 乘法，结果 30

-- 尝试调用私有函数会报错
-- mathLib.privateFunction() -- 错误：attempt to call a nil value
```

### 加载模块
```lua
require(模块名: str) -> any
```
`require` 会执行以下步骤：
1. 在 `package.path` 指定的路径中查找指定名字的模块
2. 运行该文件
3. 返回该文件最终返回的值（通常就是一个包含了一系列函数的表）
4. 将返回的表缓存在 `package.loaded` 中，下次 `require` 同一个模块时，将会直接返回缓存的值，而不是重新加载（不会多次运行模块）
注：`package` 为全局表

#### 示例 ：
**1. 定义模块 a**
```lua
-- 模块 a
local a = {
	num = 1
}

a.num = a.num + 1

return a
```

**2. 加载模块**
```lua
-- 另一个模块中
a = require("a")

print(a.num)	-- 输出 2

a = require("a")

print(a.num)	-- 输出依旧是 2
```

示意图：
![[Pasted image 20251115103112.png|550]]

#### 加载路径
加载的路径取决于 `package.path` 中的路径

`package.path` 具有默认值，通常在 main 模块中增加额外路径，可以通过断点后在 Globals 全局变量中查看具体路径

##### 示例：
```lua
package.path = "mods/?.lua;		-- “?” 加载模块时会格式化为加载的模块名称，用 “;” 分隔每个路径
?.lua;				-- 优先加载游戏根目录
/?.lua;
/kr1-desktop/?.lua;
/kr1/?.lua;
/all-desktop/?.lua;
/all/?.lua;
/lib/?.lua;
/_assets/kr1-desktop/?.lua;
/_assets/all-desktop/?.lua"
```