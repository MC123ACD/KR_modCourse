# 工具函数
## 一、索敌
几乎所有索敌本质都是在一定范围索敌
也就是说基本所有索敌都是在范围索敌的基础上增加一些代码而来的（图片是游戏自带调试模式的功能，快捷键 b）
![[Pasted image 20250705124548.png|361]]

| <center>作用（所有目标都是一个表）</center>                                                          | <center>函数（`e` 基本都传 `store.entities`，圆心 `o` 传坐标）</center>                                                                                                                                                                           |
| --------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **返回包含范围内所有敌人的表**                                                                       | `U.find_enemies_in_range(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                         |
| **返回包含范围内所有士兵的表**                                                                       | `U.find_soldiers_in_range(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                        |
| **返回包含范围内所有目标的表**                                                                       | `U.find_targets_in_range(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                         |
| **返回包含范围内所有防御塔的表**                                                                      | `U.find_towers_in_range(e, o, 攻击参数, 过滤函数)`                                                                                                                                                                                          |
| **返回第一个敌人表、<br>包含范围内所有敌人的表、<br>预判的位置**                                                  | `U.find_foremost_enemy(e, o, 最小半径, 最大半径, 预判量, 标签, bans, 过滤函数, 无视最小半径的标签)`                                                                                                                                                           |
| **返回第一个目标**                                                                             | `U.find_first_target(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                             |
| **返回最近一个敌人、<br>包含范围内所有敌人的表**                                                            | `U.find_nearest_enemy(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                            |
| **返回最近一个士兵**                                                                            | `U.find_nearest_soldier(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                          |
| **返回随机一个敌人**                                                                            | `U.find_random_enemy(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                             |
| **返回随机一个目标**                                                                            | `U.find_random_target(e, o, 最小半径, 最大半径, 标签, bans, 过滤函数)`                                                                                                                                                                            |
| **返回一个根据到终点的距离排序的表，表内的子表包含范围内每个敌人与 `o` 附近的节点**                                          | `U.find_enemies_in_paths(e, o, 最小节点距离, 最大节点距离, 最大距离, 标签, bans, 是否仅上游, 过滤函数)`                                                                                                                                                        |
| **返回在特定坐标的一个实体**                                                                        | `U.find_entity_at_pos(e, x, y, 过滤函数)`                                                                                                                                                                                               |
| **返回所有有敌人的路径的表**                                                                        | `U.find_paths_with_enemies(e, 标签, bans, 过滤函数)`                                                                                                                                                                                      |
| <font color="#f2f2f2">..........................................................</font> | <font color="#f2f2f2">......................................................................................................................................................................................................</font> |

`过滤函数` 用于筛选目标，筛选出过滤函数返回 `true` 的实体，`false` 表示无视这个实体

`最小范围内标签` 用于判断目标标签有没有设定的标签，如果有则无最小范围限制

`是否仅上游` 用于指定是否只筛选位于当前节点的**上游**（即更靠近路径起点）或**下游**（即更靠近路径终点）的敌人

## 二、判断拥有效果

| <center>作用</center>                         | <center>函数（`s` 基本都传 `store`）</center>    |
| ------------------------------------------- | ---------------------------------------- |
| **返回实体拥有的指定效果，若不传递表则返回所有拥有的效果**             | `U.get_modifiers(s, 实体, 表)`              |
| **判断实体是否有单个对应效果，额外返回找到的效果，若不传递模板名称则返回所有效果** | `U.has_modifiers(s, 实体, 效果模板名称)`         |
| **判断实体是否有表内的效果**                            | `U.has_modifier_in_list(s, 实体, 表)`       |
| **判断实体是否有指定类型的效果，额外返回所有找到的效果**              | `U.has_modifier_types(s, 实体, 效果类型, ...)` |

**通常用于索敌的过滤函数**
当然也可以用于技能，对具有特定效果的敌人造成额外效果，典型就是三代莉恩，对有诅咒效果的敌人造成额外伤害

## 三、动画

| <center>作用</center>                                            | <center>函数（`e` 为实体，`i` 为索引，`ts` 为时间戳）</center>            |
| -------------------------------------------------------------- | --------------------------------------------------------- |
| **在指定时间内循环挂起协程，<br>中断函数用于提前终止，<br>若被中断返回 `true`，否则 `false`**   | `U.y_wait(store, 等待时间, 中断函数)`                             |
| **播放实体的动画**                                                    | `U.animation_start(e, 动画名, 是否水平翻转, ts, 是否循环, i, 强制时间戳)`   |
| **判断指定动画是否已播放完成，<br>完成返回 `true`，否则 `false`，<br>循环动画将根据播放完成次数** | `U.animation_finished(e, i, 次数)`                          |
| **若动画没有完成则循环挂起函数，<br>直到动画播放完成，<br>循环动画将根据播放完成次数**              | `U.y_animation_wait(e, i, 次数)`                            |
| **同上播放动画，只不过播放的是动画组**                                          | `U.animation_start_group(e, 动画名, 是否水平翻转, ts, 是否循环, 组名)`   |
| **同上判断动画播放完成**                                                 | `U.animation_finished_group(e, 组名, 次数)`                   |
| **同上挂起协程等待动画播放完成**                                             | `U.y_animation_wait_group(e, 组名, 次数)`                     |
| **同上**                                                         | `U.y_animation_play_group(e, 动画名, 是否水平翻转, ts, 次数, 组名)`    |
| **可以看作执行播放动画与判断完成函数**                                          | `U.y_animation_play(e, 动画名, 是否水平翻转, ts, 次数, i)`           |
| **根据角度确定动画名称和翻转状态，<br>返回动画名、是否水平翻转、索引**                        | `U.animation_name_for_angle(e, 组名, 角度, i)`                |
| **根据实体朝向目标点的角度确定动画，<br>返回动画名、是否翻转、索引**                         | `U.animation_name_facing_point(e, 组名, 目标点, i, 偏移, 是否用路径)` |
| **返回指定动画的时间戳**                                                 | `U.get_animation_ts(e, 组名)`                               |
| **隐藏指定范围的精灵**                                                  | `U.sprites_hide(e, 起始索引, 结束索引, 是否保持计数)`                   |
| **显示指定范围的精灵**                                                  | `U.sprites_show(e, 起始索引, 结束索引, 是否恢复计数)`                   |

