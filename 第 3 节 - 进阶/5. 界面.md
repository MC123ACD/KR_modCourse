# 地图界面
地图上的所有界面，英雄殿堂，科技等，统称为地图界面（**screen map**）

# 关卡界面
进入关卡后的所有界面，能力按钮、英雄肖像等，统称为关卡界面（**game gui**）

# 增加额外防御塔选择
注：本篇为五代特有

### [一] 增加防御塔选择槽位
在 `kr/data/kui_templates/group_towers_wheel` 增加一个新槽位：
```lua
{
	template_name = "button_tower_ring_sel",	-- kui模板
	class = "TowerRingItemButton",	-- 续承的类
	r = 0,	-- 旋转
	id = "button_tower_ring_sel_06",	-- 序号
	pos = v(150, 250.5),	-- 位置
	scale = v(0.9999, 0.9999)	-- 缩放
}
```

### [二] 创建按钮
在 `sequels/kviews_screen_map_sequels.TowerRoomView:initialize` 函数增加代码：
```lua
...
-- 通关第5关后将树灵增加选择的塔中，用于解锁额外选择槽位
if #user_data.towers.selected < 6 and #user_data.levels > 5 then
	table.insert(user_data.towers.selected, "arborean_emissary")	-- 填写模板名（无tower_前缀）
	storage:save_slot(user_data)
end
...

-- 正式创建槽位
self.roster_sel_items = {
	self:ci("button_tower_ring_sel_01"),
	...
	self:ci("button_tower_ring_sel_06")	-- 创建第六个防御塔选择槽位
}
self.roster_sel_positions = {
	V.vclone(self.roster_sel_items[1].pos),
	...
	V.vclone(self.roster_sel_items[6].pos)	-- 槽位位置
}
...
```

### [三] 增加防御塔建造按钮
修改 `sequels/kviews_screen_map_sequels.game_gui:init` 函数部分：
```lua
for i = 1, 6 do	-- 5改为6
	local tower_found = selected_holders[i]

	if tower_found then
		for _, holder in ipairs(tower_menus.holder[1]) do
			if holder.type == tower_found then
				holder.place = index
				index = index + 1
...
```

### [四] 修改防御塔建造按钮位置
修改 `kr-desktop/data/game_gui_data` 的 `tower_menu_button_places` 键

其每个子键索引对应相应按钮的位置
```lua
tower_menu_button_places = {
	v(-92 * ring_scale, -146 * ring_scale),	-- 第一个按钮位置
	v(92 * ring_scale, -146 * ring_scale),	-- 第二个按钮位置...
	v(-153 * ring_scale, 31 * ring_scale),
	v(153 * ring_scale, 31 * ring_scale),
	v(0 * ring_scale, 155 * ring_scale),
	v(-150 * ring_scale, 165 * ring_scale),	-- 第六个按钮位置，修改这个
}
```