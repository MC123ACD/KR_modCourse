### [一] 增加 Boss 二阶段
以二代利维坦为例：

##### 1. 模板增加二阶段属性
```lua
tt = E:register_t("eb_leviathan", "boss")
...
tt.second_phase = {}
tt.second_phase.wait_time = 5		-- 死亡后进入二阶段等待时间
tt.second_phase.hp_max = 10000		-- 二阶段血量
tt.second_phase.armor = 0.5			-- 二阶段护甲
```

##### 2. 更新函数增加相关逻辑
```lua
function scripts.eb_leviathan.update(this, store, script)
...
	::label_244_0::

	while true do
		if this.health.dead then	-- 如果死亡
			if not this.is_second_phase then	-- 如果没有进入二阶段，进入二阶段
				U.animation_start(this, "death", nil, store.tick_ts, false)		-- 播放死亡动画

				U.y_wait(store, this.second_phase.wait_time)	-- 等待 5 秒

				this.is_second_phase = true		-- 标记为进入二阶段
				this.health.dead = false		-- 标记为未死亡

				this.health.hp_max = this.second_phase.hp_max		-- 设置新的最大血量
				this.health.hp = this.second_phase.hp_max			-- 设置新的血量
				this.health.armor = this.second_phase.armor			-- 设置新的护甲

				goto label_244_0		-- 直接跳出，避免进入死亡移除环节（正式死亡）
			end

			-- 二阶段死亡则进入死亡移除环节（正式死亡）
			this.phase = "dead"

			LU.kill_all_enemies(store, true)

			for _, t in pairs(tentacles) do
				t.interrupt = true
			end

			do_death()
			queue_remove(store, this)
			signal.emit("boss-killed", this)

			return
		end
...
```

##### 3. 优化细节
```lua
if not this.is_second_phase then
	this.ui.can_click = false		-- 进入二阶段等待时禁止玩家点击，避免显示boss状态栏
	this.health_bar.hidden = true	-- 进入二阶段等待时隐藏血条

	U.animation_start(this, "death", nil, store.tick_ts, false)

	U.y_wait(store, this.second_phase.wait_time)

	this.ui.can_click = true		-- 重新启用，允许玩家点击
	this.health_bar.hidden = false	-- 重新显示血条
	this.is_second_phase = true
	this.health.dead = false

	this.health.hp_max = this.second_phase.hp_max
	this.health.hp = this.second_phase.hp_max
	this.health.armor = this.second_phase.armor

	goto label_244_0
end
```