## 4.1 算术运算符

```lua
local a, b = 10, 3

print(a + b)	-- 加法：13
print(a - b)	-- 减法：7
print(a * b)	-- 乘法：30
print(a / b)	-- 除法：3.3333
print(a % b)	-- 取余：1
print(a ^ b)	-- 指数：1000（10³）
print(-a)		-- 取负：-10

-- 取余运算的特殊用途
print("奇数判断: 15 % 2 = " .. (15 % 2))		-- 1为奇数，0为偶数
print("范围限制: 25 % 24 = " .. (25 % 24))	-- 结果在0-23之间
```

## 4.2 关系运算符（比较运算符）

```lua
local x, y = 10, 20

print(x == y)    -- 相等：false
print(x ~= y)    -- 不相等：true（注意：不是!=）
print(x < y)     -- 小于：true
print(x > y)     -- 大于：false
print(x <= y)    -- 小于等于：true
print(x >= y)    -- 大于等于：false
```

### 4.2.1 字符串比较
```lua
print("apple" < "banana")  -- true
print("10" < "2")  -- true（字符串比较，不是数值）
```

### 4.2.2 表比较
```lua
local t1 = {1, 2, 3}
local t2 = {1, 2, 3}
local t3 = t1

print(t1 == t2)  -- false（不同对象）
-- 注：比较的是引用，不是内容
print(t1 == t3)  -- true（同一对象）
```

### 4.2.3 不同类型比较
```lua
print(1 == "1")				-- false（类型不同）
print(1 == tonumber("1"))	-- true
```

## 4.3 逻辑运算符
### 4.3.1 and 与逻辑
```lua
-- and：如果第一个操作数为真，返回第二个操作数；否则返回第一个操作数
print(true and false)	-- true 为真，输出 false
print(false and true)	-- false 为假，输出 false
print(true and "hello")	-- true 为真，输出 "hello"
print(nil and true)		-- nil 为假，输出 nil
```

### 4.3.2 or 或逻辑
```lua
-- or：如果第一个操作数为真，返回第一个操作数；否则返回第二个操作数
print(true or false)		-- true 为真，输出 true
print(false or true)		-- false 为假，输出 true
print(nil or "default")		-- nil 为假，输出 "default"
```

### 4.3.3 not 取反
```lua
-- not：取反，总是返回布尔值
print(not true)		-- false
print(not false)	-- true
print(not nil)		-- true
print(not 0)		-- false（0是真值）
```

### 4.3.4 实用技巧
```lua
local config = {
    volume = nil,  -- 未设置
    difficulty = "normal"
}

-- 使用or提供默认值
local volume = config.volume or 50  -- 如果volume是nil，使用50
print("音量: " .. volume)

-- 使用and进行条件赋值
local is_admin = true
local message = is_admin and "欢迎管理员" or "欢迎访客"
print("消息: " .. message)


```

### 4.3.5 短路求值
#### and 的短路求值
```lua
-- 如果其中一个判断为假，跳过后续运算
-- 第一个判断为假，跳过第二个 true 判断
if false and true then
	...
end

-- 示例
local function expensive_calculation()
    print("执行复杂计算...")
    return 42
end

local should_calculate = false		-- 不想进行计算
local result = should_calculate and expensive_calculation()
-- should_calculate 为假，expensive_calculation 函数不会被调用
```

#### or 的短路求值
```lua
-- 如果其中一个判断为真，跳过后续运算
-- 第一个判断为真，跳过第二个 false 判断
if true or false then
	...
end

-- 示例
-- 示例
local function say(s)
    if not s then
        print("s = false")
    else
        print("s = true")
    end

    -- 如果 s 为假（nil），将 s 赋值为 "hello world"，否则不变
    s = s or "hello world"

    print(s)
end

say()
say("hello")
--[[ 输出
s = false
hello world
s = true
hello
--]]
```

## 4.4 长度运算符
#### 4.4.1 统计字符串长度
```lua
local name = "张三"
-- 使用 "#" 统计字符串长度
print("\"" .. name .. "\"的长度: " .. #name)  -- 输出：6（中文一个字符等于 3 个字节）
```

### 4.4.2 统计表内数组部分长度
```lua
local towers = {"箭塔", "兵营", "法师塔", "炮塔"}
print("防御塔数量: " .. #towers)      -- 输出：4

-- 注意：无法使用 "#" 统计字典部分的长度
local tower = {
    name = "炮塔",
    level = 10,
    damage = 100
}
print("键数量: " .. #tower)      -- 错误！输出：0
```

## 4.5 字符串连接运算符

```lua
-- 使用 .. 连接字符串
local greeting = "你好" .. ", " .. "世界!"
print(greeting)  -- 输出：你好, 世界!

-- 如果操作数不是字符串，会自动转换
local age = 25
print("年龄: " .. age)  -- 自动将25转换为"25"
```

## 4.6 运算符优先级

| 从高到低的优先级             |            |
| -------------------- | ---------- |
| `1. ^`               | (指数)       |
| `2. not # -`         | (取反、长度、负号) |
| `3. * / %`           | (乘、除、取余)   |
| `4. + -`             | (加、减)      |
| `5. ..`              | (字符串连接运算符) |
| `6. < > <= >= ~= ==` | (比较运算符)    |
| `7. and`             | (与逻辑)      |
| `8. or`              | (或逻辑)      |

#### 示例
算术运算符：
```lua
print(2 + 3 * 4)	-- 3*4先计算，然后加2 = 14

-- 可以使用括号来指定优先级
print((2 + 3) * 4)	-- 2+3先计算，然后乘4 = 20
```

逻辑运算符：
```lua
local x, y, z = true, 1, 2

print(x and y or z)		-- 如果 x 为真输出 1，为假输出 2

print(x and (y and 3 or z))	-- 先判断 y 得到值，为真则值为 3，为假则值为 2，如果 x 为真输出 3
```

## 4.7 练习

### 练习 1：简单计算器
（答案见 [[第 1 节 - 语法/参考答案#练习 4.1：简单计算器]]）
```lua
-- 实现一个简单的四则运算计算器
```

## 4.8 本章总结

### 关键知识点回顾
1. **运算符**：
	- **算术**：`+ - * / % ^ -`（负号）
	- **关系**：`== ~= < > <= >=`
	- **逻辑**：`and or not`
	- **字符串**：`..`（连接）

2. **短路求值**：
	- **and**：其中一个为假跳过后续运算
	- **or**：其中一个为真跳过后续运算
	- **短路求值失效**：使用括号分组而不是变量

3. **优先级**：
	- 指数 > 负号 > 乘除 > 加减 > 连接 > 比较 > 逻辑

### 常见错误与技巧
```lua
-- 1. 错误：混淆 "="、 "=="
local x = 5

-- 错误示例，应该是 ==
if x = 10 then 
	print("x是10")
end

-- 正确示例
if x == 10 then
    print("x是10")
end

-- 2. 技巧：使用 or 提供默认值
local sound_volume = user_setting.volume or 70

-- 3. 技巧：使用 and 简化条件判断
local player = get_player()
local name = player and player.name or "未知玩家"

-- 注意：Lua 中只有 false 和 nil 是假值，其他任何值都是真
if 0 then  -- 这个条件为真！
    print("0在Lua中是真值")
end

-- 4. 错误：将逻辑运算分组为多个变量
local n1, n2, n3 = 1, 2, 3
local s1, s2, s3 = "a", "b", "c"

-- 错误示例，应使用括号分组，而不是分组为变量
local check_n = n1 == 1 and n2 == 2 and n3 == 3
local check_s = s1 == "a" and s2 == "b" and s3 == "c"	-- 即使 n3 判断为假也会继续判断 s123

if check_n and check_s then		-- 可读性改善，代价是短路求值失效一半
	print("检查通过")
end

-- 正确示例，使用括号分组
-- n3 判断为假，直接停止判断，虽然可读性较差
if (n1 == 1 and n2 == 2 and n3 == 3) and (s1 == "a" and s2 == "b" and s3 == "c") then
	print("检查通过")
end
```

### 检查清单
（点击勾选框勾选）
完成本章后，你应该能够：
- [ ] 使用各种运算符进行计算和比较
- [ ] 理解运算符优先级并正确使用括号
- [ ] 利用逻辑运算符实现条件默认值

### 思考题
1. 为什么字符串连接使用 `..` 而不是 `+`？
2. 表达式 `a and b or c` 在什么情况下不能代替 `a ? b : c` 的三元运算？

---

**下一章预告**：在第 5 章中，我们将学习控制结构，包括条件判断和循环语句。这是让程序"有逻辑"的关键一步！

**拓展练习**：
1. 创建一个简单的配置系统，使用表存储配置，并提供默认值
2. 实现一个类型安全的加法函数，只对数字进行加法运算