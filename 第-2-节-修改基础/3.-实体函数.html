<!DOCTYPE html> <html lang="zh-cn"><head>
<title>3. 实体函数</title>
<base href="..">
<meta name="pathname" content="第-2-节-修改基础/3.-实体函数.html">
<meta name="description" content="王国保卫战修改教程 - 3. 实体函数">
<meta property="og:title" content="3. 实体函数">
<meta property="og:description" content="王国保卫战修改教程 - 3. 实体函数">
<meta property="og:type" content="website">
<meta property="og:url" content="第-2-节-修改基础/3.-实体函数.html">
<meta property="og:image" content="site-lib/media/pasted-image-20251215185551.png">
<meta charset="UTF-8"><meta property="og:site_name" content="王国保卫战修改教程"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="preload" href="site-lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/snippets.css"></noscript><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="site-lib/styles/theme.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/supported-plugins.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager mod-windows is-frameless is-hidden-frameless styled-scrollbars show-inline-title show-ribbon background-settings-workplace-theme-dark-in-the-sky background-image-settings-markdown-page-custom notebook-liked-markdown-page-grid-notebook-1 panel-page-bg-theme-light-custom panel-page-bg-theme-dark-plant hide-left-ribbon-retention-drawer toggle-divider-lines toggle-header-bottom-line bt-bubble-layout bt-bubble-layout-hide-borders remove-heading-indicator h1-toggle-underline toggle-left-aligned-content fancy-hr-no-icon custom-unordered-list custom-ordered-list list-no-border folder-icons bt-toggle-colorful-folder folder-style-change-options-colorful-default folder-colorful-one table-width-auto table-style-two link-underline-internal enable-alternative-checkboxes default-loading-page loading-text-typing-style rainbow-tag translucent-setting-panel underline-tab-style canvas-card-text-middle admonition-bg-color-same toggle-calendar-shadow style-options-for-buttons-plugin dataview-list-style-pacman memos-banner-gradient thino-frosted-style thino-background-default quiet-outline-optimize code-theme-sublime is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event allow-fold-headings show-indentation-guide show-properties is-readable-line-width" data-type="markdown"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="3._实体函数_0">3. 实体函数</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt<span class="token punctuation">.</span>main_script<span class="token punctuation">.</span>insert <span class="token operator">=</span> 函数<span class="token punctuation">:</span> func
tt<span class="token punctuation">.</span>main_script<span class="token punctuation">.</span>update <span class="token operator">=</span> 函数<span class="token punctuation">:</span> func
tt<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>fn_level_up <span class="token operator">=</span> 函数<span class="token punctuation">:</span> func
<span class="token comment">-- 这些都是实体函数</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>存储位置：实体函数通常存储在 <code>kr/game_scripts</code> 与 <code>all/scripts</code> 中</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>作用：实体函数通常用于 <code>main_script</code> 系统，为实体增加逻辑</li>
</ul></div><div class="el-h2"><h2 data-heading="3.1 插入函数" dir="auto" class="heading" id="3.1_插入函数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.1 插入函数</h2></div><div class="el-p"><p dir="auto">每次创建实体都会调用一次的函数，称为插入函数（<strong>insert script</strong>）</p></div><div class="el-h3"><h3 data-heading="3.1.1 造成伤害" dir="auto" class="heading" id="3.1.1_造成伤害_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.1.1 造成伤害</h3></div><div class="el-p"><p dir="auto"><strong>首先在模板找到函数，并在 <code>kr/game_scripts</code> 搜索</strong></p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 艾莉丹插入函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_elves_archer<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
	<span class="token comment">-- this 表示调用插入函数的实体</span>
	<span class="token punctuation">...</span>
	
	<span class="token keyword">local</span> d <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">create_entity</span><span class="token punctuation">(</span><span class="token string">"damage"</span><span class="token punctuation">)</span>	<span class="token comment">-- 造成伤害</span>
	d<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">233666</span>					<span class="token comment">-- 伤害</span>
	d<span class="token punctuation">.</span>target_id <span class="token operator">=</span> this<span class="token punctuation">.</span>id				<span class="token comment">-- 目标 id 设置为当前英雄 id</span>
	<span class="token function">queue_damage</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> d<span class="token punctuation">)</span>				<span class="token comment">-- 插入伤害队列</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">使用修改的英雄进入关卡，英雄掉血，成功</p></div><div class="el-h3"><h3 data-heading="3.1.2 造成效果" dir="auto" class="heading" id="3.1.2_造成效果_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.1.2 造成效果</h3></div><div class="el-p"><p dir="auto">造成效果同上，不过要插入实体队列（queue_insert）</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> mod <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">create_entity</span><span class="token punctuation">(</span>效果模板名<span class="token punctuation">:</span> str<span class="token punctuation">)</span>	<span class="token comment">-- 造成效果</span>
mod<span class="token punctuation">.</span>modifier<span class="token punctuation">.</span>target_id <span class="token operator">=</span> this<span class="token punctuation">.</span>id			<span class="token comment">-- 目标</span>
<span class="token function">queue_insert</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> mod<span class="token punctuation">)</span>					<span class="token comment">-- 插入实体队列</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.1.3 实体增加光环" dir="auto" class="heading" id="3.1.3_实体增加光环_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.1.3 实体增加光环</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 沙王插入函数，给沙王增加死亡骑士光环</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_alric<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> script<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	<span class="token keyword">if</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>toughness<span class="token punctuation">.</span>level <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">then</span>		<span class="token comment">-- 若坚韧技能等级大于 0，可选</span>
		<span class="token keyword">local</span> e <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">create_entity</span><span class="token punctuation">(</span><span class="token string">"death_rider_aura"</span><span class="token punctuation">)</span>	<span class="token comment">-- 创建死亡骑士光环</span>
		e<span class="token punctuation">.</span>aura<span class="token punctuation">.</span>source_id <span class="token operator">=</span> this<span class="token punctuation">.</span>id						<span class="token comment">-- 来源设置为沙王</span>

		<span class="token function">queue_insert</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> e<span class="token punctuation">)</span>							<span class="token comment">-- 将 e 插入实体队列</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 进入游戏后发现光环显示位置错误，在模板移除偏移即可（与修改效果同理）</span>
<span class="token comment">-- 创建新模板，续承死亡骑士光环</span>
tt <span class="token operator">=</span> <span class="token function">RT</span><span class="token punctuation">(</span><span class="token string">"death_rider_aura_alric"</span><span class="token punctuation">,</span> <span class="token string">"death_rider_aura"</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>aura<span class="token punctuation">.</span>use_mod_offset <span class="token operator">=</span> <span class="token keyword">nil</span>	<span class="token comment">-- 移除偏移</span>

<span class="token comment">-- 插入函数创建新的光环即可：E:create_entity("death_rider_aura_alric")</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.1.4 E:create_entity - 创建实体" dir="auto" class="heading" id="3.1.4_Ecreate_entity_-_创建实体_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.1.4 E:create_entity - 创建实体</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">E<span class="token punctuation">:</span><span class="token function">create_entity</span><span class="token punctuation">(</span>实体模板名<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 实体引用<span class="token punctuation">:</span> table
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>创建实体后需要插入实体队列才会正式创建实体</li>
</ul></div><div class="el-h2"><h2 data-heading="3.2 store - 临时存储" dir="auto" class="heading" id="3.2_store_-_临时存储_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.2 store - 临时存储</h2></div><div class="el-p"><p dir="auto">store 位于 <code>game</code> 表中，用于存储临时数据，如实体、玩家拥有的金币、生命、游戏时间、实体与伤害队列等</p></div><div class="el-h4"><h4 data-heading="实体存储位置" dir="auto" class="heading" id="实体存储位置_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>实体存储位置</h4></div><div class="el-p"><p dir="auto">所有创建的实体都会存储在 <code>store.entities</code> 表中，每个实体都有独立 ID，ID 只增不减。</p></div><div class="el-h2"><h2 data-heading="3.3 升级函数" dir="auto" class="heading" id="3.3_升级函数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.3 升级函数</h2></div><div class="el-p"><p dir="auto">每次实体升级时调用的函数，称为升级函数（<strong>level up script</strong>）</p></div><div class="el-h3"><h3 data-heading="3.3.1 数据随等级而变化" dir="auto" class="heading" id="3.3.1_数据随等级而变化_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.3.1 数据随等级而变化</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板内</span>
<span class="token comment">-- 艾莉丹的双刀跳斩</span>
tt<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>double_strike <span class="token operator">=</span> <span class="token function">CC</span><span class="token punctuation">(</span><span class="token string">"hero_skill"</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>double_strike<span class="token punctuation">.</span>cooldown <span class="token operator">=</span> <span class="token punctuation">{</span>	<span class="token comment">-- 冷却时间随等级变化（原版 12 秒）</span>
	<span class="token number">12</span><span class="token punctuation">,</span>	<span class="token comment">-- 一级 12 秒</span>
	<span class="token number">10</span><span class="token punctuation">,</span>	<span class="token comment">-- 二级 10 秒</span>
	<span class="token number">8</span>	<span class="token comment">-- 三级 8 秒</span>
<span class="token punctuation">}</span>

<span class="token comment">-- 艾莉丹升级函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_elves_archer<span class="token punctuation">.</span><span class="token function">level_up</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> initial<span class="token punctuation">)</span>
<span class="token punctuation">...</span>
	s <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>double_strike

	<span class="token keyword">if</span> initial <span class="token keyword">and</span> s<span class="token punctuation">.</span>level <span class="token operator">&gt;</span> θ <span class="token keyword">then</span>
		<span class="token keyword">local</span> a <span class="token operator">=</span> this<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>		<span class="token comment">-- 近战攻击 2 为双刀跳斩</span>
		a<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token keyword">nil</span>
		a<span class="token punctuation">.</span>damage_min <span class="token operator">=</span> s<span class="token punctuation">.</span>damage_min<span class="token punctuation">[</span>s<span class="token punctuation">.</span>level<span class="token punctuation">]</span>
		a<span class="token punctuation">.</span>damage_max <span class="token operator">=</span> s<span class="token punctuation">.</span>damage_max<span class="token punctuation">[</span>s<span class="token punctuation">.</span>level<span class="token punctuation">]</span>
		
		a<span class="token punctuation">.</span>cooldown <span class="token operator">=</span> s<span class="token punctuation">.</span>cooldown<span class="token punctuation">[</span>s<span class="token punctuation">.</span>level<span class="token punctuation">]</span>	<span class="token comment">-- 增加代码</span>
	<span class="token keyword">end</span>
<span class="token punctuation">...</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="3.4 更新函数" dir="auto" class="heading" id="3.4_更新函数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.4 更新函数</h2></div><div class="el-p"><p dir="auto">随着游戏逻辑时间更新而调用的函数，称为更新函数（<strong>update script</strong>）</p></div><div class="el-h3"><h3 data-heading="3.4.1 技能造成效果" dir="auto" class="heading" id="3.4.1_技能造成效果_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.4.1 技能造成效果</h3></div><div class="el-p"><p dir="auto">找到技能造成伤害的部分，在后面加上造成效果的逻辑即可</p></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以给火男烈焰冲击增加燃烧效果为例</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 火男模板</span>
tt <span class="token operator">=</span> <span class="token function">RT</span><span class="token punctuation">(</span><span class="token string">"hero_ignus"</span><span class="token punctuation">,</span> <span class="token string">"hero"</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mod <span class="token operator">=</span> <span class="token string">"mod_lava_ignus"</span>	<span class="token comment">-- 造成这个效果</span>

<span class="token keyword">local</span> tt <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">register_t</span><span class="token punctuation">(</span><span class="token string">"mod_lava_ignus"</span><span class="token punctuation">,</span> <span class="token string">"mod_lava"</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>dps<span class="token punctuation">.</span>damage_inc <span class="token operator">=</span> <span class="token number">2</span>	<span class="token comment">-- 翻倍燃烧伤害</span>

<span class="token comment">-- 更新函数内</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_ignus<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	a <span class="token operator">=</span> this<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
	skill <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>flaming_frenzy
	
	<span class="token keyword">if</span> sta <span class="token operator">~=</span> A_NO_TARGET <span class="token keyword">and</span> <span class="token keyword">not</span> a<span class="token punctuation">.</span>disabled <span class="token keyword">and</span> store<span class="token punctuation">.</span>tick_ts <span class="token operator">-</span> a<span class="token punctuation">.</span>ts <span class="token operator">&gt;=</span> a<span class="token punctuation">.</span>cooldown <span class="token keyword">then</span>	<span class="token comment">-- 计算冷却时间</span>
	<span class="token punctuation">...</span>
		targets <span class="token operator">=</span> U<span class="token punctuation">.</span><span class="token function">find_enemies_in_range</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>entities<span class="token punctuation">,</span> this<span class="token punctuation">.</span>pos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>max_range<span class="token punctuation">,</span> a<span class="token punctuation">.</span>vis_flags<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>vis_bans<span class="token punctuation">)</span>	<span class="token comment">-- 索敌</span>
	
		<span class="token keyword">if</span> targets <span class="token keyword">then</span>
			<span class="token keyword">for</span> _<span class="token punctuation">,</span> t <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>targets<span class="token punctuation">)</span> <span class="token keyword">do</span>
				<span class="token comment">-- 造成伤害</span>
				<span class="token keyword">local</span> d <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">create_entity</span><span class="token punctuation">(</span><span class="token string">"damage"</span><span class="token punctuation">)</span>
				d<span class="token punctuation">.</span>damage_type <span class="token operator">=</span> a<span class="token punctuation">.</span>damage_type
				d<span class="token punctuation">.</span>source_id <span class="token operator">=</span> this<span class="token punctuation">.</span>id
				d<span class="token punctuation">.</span>target_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
				d<span class="token punctuation">.</span>value <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>damage_min<span class="token punctuation">,</span> a<span class="token punctuation">.</span>damage_max<span class="token punctuation">)</span>
	
				<span class="token function">queue_damage</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
	
				<span class="token comment">-- 造成效果</span>
				<span class="token keyword">local</span> mod <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">create_entity</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>mod<span class="token punctuation">)</span>
				mod<span class="token punctuation">.</span>modifier<span class="token punctuation">.</span>target_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
				mod<span class="token punctuation">.</span>modifier<span class="token punctuation">.</span>source_id <span class="token operator">=</span> this<span class="token punctuation">.</span>id
	
				<span class="token function">queue_insert</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> mod<span class="token punctuation">)</span>
			<span class="token keyword">end</span>
			<span class="token punctuation">...</span>
		<span class="token keyword">end</span>
		<span class="token punctuation">...</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.4.2 计算时间" dir="auto" class="heading" id="3.4.2_计算时间_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.4.2 计算时间</h3></div><div class="el-p"><p dir="auto">计算时间常用到 <code>store.tick_ts</code> （游戏时间）与 <code>ts</code>（时间戳）</p></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_1"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">a <span class="token operator">=</span> this<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>	<span class="token comment">-- 某个技能</span>

<span class="token keyword">if</span> store<span class="token punctuation">.</span>tick_ts <span class="token operator">-</span> a<span class="token punctuation">.</span>ts <span class="token operator">&gt;</span> a<span class="token punctuation">.</span>cooldown <span class="token keyword">then</span>
	a<span class="token punctuation">.</span>ts <span class="token operator">=</span> store<span class="token punctuation">.</span>tick_ts	<span class="token comment">-- 刷新 a 的时间戳</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">表示如果<strong>当前时间</strong>与<strong>上次释放技能 <code>a</code> 的时间戳</strong>之差<strong>大于冷却时间</strong>，执行条件代码块<br>
换句话说就是<strong>上次释放技能过去的时间</strong>大于冷却时间</p></div><div class="el-h2"><h2 data-heading="3.5 谁在调用插入与更新函数" dir="auto" class="heading" id="3.5_谁在调用插入与更新函数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.5 谁在调用插入与更新函数</h2></div><div class="el-p"><p dir="auto">通常所有函数的调用源头都是 Love 2D 引擎的 <code>love.update</code> 回调函数。按照以下调用链通过模拟器（<strong>simulation</strong>）协调系统，通过系统（<code>sys.main_script</code>）来调用实体的更新函数与插入函数<br>
<span alt="Pasted image 20251215185551.png" src="site-lib/media/pasted-image-20251215185551.png" class="internal-embed media-embed image-embed is-loaded" target="_self" style="width: 1200px; max-width: 100%;"><img alt="Pasted image 20251215185551.png" src="site-lib/media/pasted-image-20251215185551.png" target="_self" style="width: 1200px; max-width: 100%;"></span></p></div><div class="el-h2"><h2 data-heading="3.6 打印日志" dir="auto" class="heading" id="3.6_打印日志_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.6 打印日志</h2></div><div class="el-p"><p dir="auto">游戏内置了一套完整的日志系统，用于开发调试和问题排查。日志系统采用分级机制，便于控制不同开发阶段的输出信息量。</p></div><div class="el-h3"><h3 data-heading="3.6.1 六级日志系统" dir="auto" class="heading" id="3.6.1_六级日志系统_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.6.1 六级日志系统</h3></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">等级</th>
<th dir="ltr">函数</th>
<th dir="ltr">用途</th>
<th dir="ltr">典型场景</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr">6 级</td>
<td dir="ltr"><code>log.paranoid</code></td>
<td dir="ltr"><strong>偏执级调试</strong></td>
<td dir="ltr">最详细的跟踪信息，如每帧状态、函数调用栈</td>
</tr>
<tr>
<td dir="ltr">5 级</td>
<td dir="ltr"><code>log.debug</code></td>
<td dir="ltr"><strong>调试信息</strong></td>
<td dir="ltr">开发过程中的详细调试信息</td>
</tr>
<tr>
<td dir="ltr">4 级</td>
<td dir="ltr"><code>log.todo</code></td>
<td dir="ltr"><strong>待办事项</strong></td>
<td dir="ltr">标记需要完成的功能或修复的问题</td>
</tr>
<tr>
<td dir="ltr">3 级</td>
<td dir="ltr"><code>log.info</code></td>
<td dir="ltr"><strong>常规信息</strong></td>
<td dir="ltr">正常的游戏流程信息</td>
</tr>
<tr>
<td dir="ltr">2 级</td>
<td dir="ltr"><code>log.warning</code></td>
<td dir="ltr"><strong>警告信息</strong></td>
<td dir="ltr">潜在问题或不规范使用</td>
</tr>
<tr>
<td dir="ltr">1 级</td>
<td dir="ltr"><code>log.error</code></td>
<td dir="ltr"><strong>错误信息</strong></td>
<td dir="ltr">程序错误和异常情况</td>
</tr>
</tbody>
</table></div><div class="el-h3"><h3 data-heading="3.6.2 函数" dir="auto" class="heading" id="3.6.2_函数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.6.2 函数</h3></div><div class="el-h4"><h4 data-heading="1. 创建新日志实例" dir="auto" class="heading" id="1._创建新日志实例_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>1. 创建新日志实例</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">log<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>打印的日志前缀<span class="token punctuation">:</span> str<span class="token punctuation">,</span> 日志等级?<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 日志实例<span class="token punctuation">:</span> table
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>推荐在 <code>args</code> 修改全局日志等级</li>
</ul></div><div class="el-h5"><h5 data-heading="示例" dir="auto" class="heading" id="示例_2"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h5></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"load atlas: %s,%s-%.6f"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ref_scale<span class="token punctuation">)</span>

<span class="token comment">--[[ 输出
[22841.0227] image_db.DEBUG preload_atlas() - load atlas: _assets/kr1-desktop/images/fullhd,screen_settings-1.000000
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>[22841.0227]</code> 为时间信息</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>image_db</code> 为前缀</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>DEBUG</code> 为等级，调试五级</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>preload_atlas</code> 调用的函数</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span><code>load atlas: _assets/kr1-desktop/images/fullhd,screen_settings-1.000000</code> 信息</li>
</ul></div><div class="el-h4"><h4 data-heading="2. 偏执级调试（6 级）" dir="auto" class="heading" id="2._偏执级调试（6_级）_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>2. 偏执级调试（6 级）</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 打印最详细的调试信息</span>
log<span class="token punctuation">.</span><span class="token function">paranoid</span><span class="token punctuation">(</span><span class="token string">"实体 %d 当前状态: pos=(%.1f, %.1f), hp=%d/%d"</span><span class="token punctuation">,</span> 
    this<span class="token punctuation">.</span>id<span class="token punctuation">,</span> this<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp<span class="token punctuation">,</span> this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp_max<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><strong>用途</strong>：深度跟踪复杂逻辑的执行流程</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>特点</strong>：信息量极大，仅在调试特定问题时开启</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>示例场景</strong>：
<ul class="has-list-bullet">
<li data-line="3" dir="auto"><span class="list-bullet"></span>追踪 AI 决策过程</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>监控每帧的状态变化</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>调试复杂的协程逻辑</li>
</ul>
</li>
</ul></div><div class="el-h4"><h4 data-heading="3. 调试信息（5 级）" dir="auto" class="heading" id="3._调试信息（5_级）_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3. 调试信息（5 级）</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 打印开发调试信息</span>
log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"技能 %s 触发，目标=%d，伤害=%d"</span><span class="token punctuation">,</span> 
    skill_name<span class="token punctuation">,</span> target<span class="token punctuation">.</span>id<span class="token punctuation">,</span> damage_value<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><strong>用途</strong>：开发阶段的主要调试工具</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>特点</strong>：包含详细的过程信息，但比偏执级简洁</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>示例场景</strong>：
<ul class="has-list-bullet">
<li data-line="3" dir="auto"><span class="list-bullet"></span>技能释放和冷却</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>伤害计算过程</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>实体创建和销毁</li>
</ul>
</li>
</ul></div><div class="el-h4"><h4 data-heading="4. 待办事项（4 级）" dir="auto" class="heading" id="4._待办事项（4_级）_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>4. 待办事项（4 级）</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 标记需要完成的功能</span>
log<span class="token punctuation">.</span><span class="token function">todo</span><span class="token punctuation">(</span><span class="token string">"TODO: 为英雄 %s 实现连击系统"</span><span class="token punctuation">,</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token comment">-- 或标记已知问题</span>
log<span class="token punctuation">.</span><span class="token function">todo</span><span class="token punctuation">(</span><span class="token string">"FIXME: 当敌人被冰冻时，伤害计算有误"</span><span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><strong>用途</strong>：标记开发中的待办事项和已知问题</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>特点</strong>：便于团队协作和任务跟踪</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>最佳实践</strong>：
<ul class="has-list-bullet">
<li data-line="3" dir="auto"><span class="list-bullet"></span>描述清晰的问题或功能需求</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>包含解决建议（如果有）</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>定期清理已完成的待办事项</li>
</ul>
</li>
</ul></div><div class="el-h4"><h4 data-heading="5. 常规信息（3 级）" dir="auto" class="heading" id="5._常规信息（3_级）_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>5. 常规信息（3 级）</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 打印正常的游戏流程信息</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"关卡 %d 开始，初始金币=%d，生命=%d"</span><span class="token punctuation">,</span> 
    store<span class="token punctuation">.</span>wave<span class="token punctuation">,</span> store<span class="token punctuation">.</span>gold<span class="token punctuation">,</span> store<span class="token punctuation">.</span>lives<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><strong>用途</strong>：记录正常的游戏运行信息</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>特点</strong>：适合玩家可见的进度信息</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>示例场景</strong>：
<ul class="has-list-bullet">
<li data-line="3" dir="auto"><span class="list-bullet"></span>关卡开始/结束</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>英雄升级</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>重要游戏事件</li>
</ul>
</li>
</ul></div><div class="el-h4"><h4 data-heading="6. 警告信息（2 级）" dir="auto" class="heading" id="6._警告信息（2_级）_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>6. 警告信息（2 级）</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 打印潜在问题警告</span>
log<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">"实体 %d 的 hp=%d，但 hp_max=%d，血量数据异常"</span><span class="token punctuation">,</span>
    this<span class="token punctuation">.</span>id<span class="token punctuation">,</span> this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp<span class="token punctuation">,</span> this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp_max<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><strong>用途</strong>：提示潜在问题或不规范情况</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>特点</strong>：程序能继续运行，但可能存在风险</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>示例场景</strong>：
<ul class="has-list-bullet">
<li data-line="3" dir="auto"><span class="list-bullet"></span>数据范围异常</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>资源加载失败但有备用方案</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>预期外的游戏状态</li>
</ul>
</li>
</ul></div><div class="el-h4"><h4 data-heading="7. 错误信息（1 级）" dir="auto" class="heading" id="7._错误信息（1_级）_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>7. 错误信息（1 级）</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 打印错误信息</span>
log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"无法找到实体 %d 的目标 %d，技能释放失败"</span><span class="token punctuation">,</span>
    this<span class="token punctuation">.</span>id<span class="token punctuation">,</span> target_id<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><strong>用途</strong>：报告程序错误和异常情况</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>特点</strong>：通常伴随功能失效</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>示例场景</strong>：
<ul class="has-list-bullet">
<li data-line="3" dir="auto"><span class="list-bullet"></span>空指针访问</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>资源加载完全失败</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>关键逻辑无法执行</li>
</ul>
</li>
</ul></div><div class="el-h3"><h3 data-heading="3.6.3 实用技巧" dir="auto" class="heading" id="3.6.3_实用技巧_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.6.3 实用技巧</h3></div><div class="el-h4"><h4 data-heading="1. 格式化输出" dir="auto" class="heading" id="1._格式化输出_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>1. 格式化输出</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 使用格式化字符串提高可读性</span>
<span class="token keyword">local</span> hit_count <span class="token operator">=</span> <span class="token operator">#</span>targets
<span class="token keyword">local</span> total_damage <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> _<span class="token punctuation">,</span> dmg <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>damages<span class="token punctuation">)</span> <span class="token keyword">do</span>
    total_damage <span class="token operator">=</span> total_damage <span class="token operator">+</span> dmg<span class="token punctuation">.</span>value
<span class="token keyword">end</span>

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"范围攻击命中 %d 个目标，总伤害 %d"</span><span class="token punctuation">,</span> hit_count<span class="token punctuation">,</span> total_damage<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h4"><h4 data-heading="2. 条件日志" dir="auto" class="heading" id="2._条件日志_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>2. 条件日志</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 只在特定条件下输出日志</span>
<span class="token keyword">if</span> DEBUG_MODE <span class="token keyword">then</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"详细状态: %s"</span><span class="token punctuation">,</span> <span class="token function">inspect</span><span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 或者在开发阶段使用</span>
<span class="token keyword">if</span> store<span class="token punctuation">.</span>tick_ts <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token keyword">then</span>  <span class="token comment">-- 只在游戏前10秒输出</span>
    log<span class="token punctuation">.</span><span class="token function">paranoid</span><span class="token punctuation">(</span><span class="token string">"初始状态跟踪: %s"</span><span class="token punctuation">,</span> this<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.6.4 调试工作流示例" dir="auto" class="heading" id="3.6.4_调试工作流示例_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.6.4 调试工作流示例</h3></div><div class="el-h4"><h4 data-heading="1. 新功能开发" dir="auto" class="heading" id="1._新功能开发_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>1. 新功能开发</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">function</span> scripts<span class="token punctuation">.</span>new_hero<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">todo</span><span class="token punctuation">(</span><span class="token string">"实现新英雄的插入函数"</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"新英雄创建，ID=%d，位置=(%.1f,%.1f)"</span><span class="token punctuation">,</span>
        this<span class="token punctuation">.</span>id<span class="token punctuation">,</span> this<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    
    <span class="token comment">-- 开发过程中的调试</span>
    log<span class="token punctuation">.</span><span class="token function">paranoid</span><span class="token punctuation">(</span><span class="token string">"初始组件状态: %s"</span><span class="token punctuation">,</span> <span class="token function">inspect</span><span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">-- 实现逻辑...</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>new_hero<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">todo</span><span class="token punctuation">(</span><span class="token string">"实现新英雄的更新函数"</span><span class="token punctuation">)</span>
    
    <span class="token comment">-- 跟踪特定问题</span>
    <span class="token keyword">if</span> this<span class="token punctuation">.</span>some_problem <span class="token keyword">then</span>
        log<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">"检测到问题状态: %s"</span><span class="token punctuation">,</span> this<span class="token punctuation">.</span>some_problem<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    <span class="token comment">-- 实现逻辑...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h4"><h4 data-heading="2. 问题排查" dir="auto" class="heading" id="2._问题排查_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>2. 问题排查</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">function</span> scripts<span class="token punctuation">.</span>problem_skill<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
    <span class="token keyword">local</span> skill <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>problem_skill
    
    <span class="token comment">-- 逐步添加日志定位问题</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"技能检查: level=%d, cooldown=%f"</span><span class="token punctuation">,</span> 
        skill<span class="token punctuation">.</span>level<span class="token punctuation">,</span> skill<span class="token punctuation">.</span>cooldown<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> store<span class="token punctuation">.</span>tick_ts <span class="token operator">-</span> skill<span class="token punctuation">.</span>last_use <span class="token operator">&gt;</span> skill<span class="token punctuation">.</span>cooldown <span class="token keyword">then</span>
        log<span class="token punctuation">.</span><span class="token function">paranoid</span><span class="token punctuation">(</span><span class="token string">"技能可用，开始索敌..."</span><span class="token punctuation">)</span>
        
        <span class="token keyword">local</span> target <span class="token operator">=</span> U<span class="token punctuation">.</span><span class="token function">find_foremost_enemy</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>entities<span class="token punctuation">,</span> this<span class="token punctuation">.</span>pos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> target <span class="token keyword">then</span>
            log<span class="token punctuation">.</span><span class="token function">paranoid</span><span class="token punctuation">(</span><span class="token string">"找到目标: ID=%d, hp=%d"</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span>id<span class="token punctuation">,</span> target<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp<span class="token punctuation">)</span>
            
            <span class="token comment">-- 检查目标状态</span>
            <span class="token keyword">if</span> target<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span>
                log<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">"目标已死亡但仍被选中，ID=%d"</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token keyword">end</span>
            
            <span class="token comment">-- 执行技能...</span>
        <span class="token keyword">else</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"未找到有效目标"</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h4"><h4 data-heading="3. 性能分析" dir="auto" class="heading" id="3._性能分析_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3. 性能分析</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">function</span> scripts<span class="token punctuation">.</span>heavy_function<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
    <span class="token keyword">local</span> start_time <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">-- 执行复杂计算...</span>
    
    <span class="token keyword">local</span> end_time <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> duration <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
    
    <span class="token keyword">if</span> duration <span class="token operator">&gt;</span> <span class="token number">0.016</span> <span class="token keyword">then</span>  <span class="token comment">-- 超过一帧时间（30fps）</span>
        log<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">"函数执行时间过长: %.3f秒，实体ID=%d"</span><span class="token punctuation">,</span> 
            duration<span class="token punctuation">,</span> this<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span><span class="token function">paranoid</span><span class="token punctuation">(</span><span class="token string">"详细状态: %s"</span><span class="token punctuation">,</span> <span class="token function">inspect</span><span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elseif</span> duration <span class="token operator">&gt;</span> <span class="token number">0.001</span> <span class="token keyword">then</span>  <span class="token comment">-- 超过1毫秒</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"函数执行时间: %.3f秒"</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.6.5 更多日志库函数见 [[12. 库#日志库]]" dir="auto" class="heading" id="3.6.5_更多日志库函数见_[[12._库#日志库]]_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.6.5 更多日志库函数见 <a data-href="12. 库#日志库" href="总结/12.-库.html#日志库" class="internal-link" target="_self" rel="noopener nofollow">12. 库 &gt; 日志库</a></h3></div><div class="el-h2"><h2 data-heading="3.7 索敌" dir="auto" class="heading" id="3.7_索敌_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.7 索敌</h2></div><div class="el-p"><p dir="auto">几乎所有索敌本质都是在一定范围索敌，然后根据条件过滤目标。</p></div><div class="el-h3"><h3 data-heading="3.7.1 基础索敌" dir="auto" class="heading" id="3.7.1_基础索敌_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.7.1 基础索敌</h3></div><div class="el-h4"><h4 data-heading="1. 搜索范围内所有敌人" dir="auto" class="heading" id="1._搜索范围内所有敌人_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>1. 搜索范围内所有敌人</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">U<span class="token punctuation">.</span><span class="token function">find_enemies_in_range</span><span class="token punctuation">(</span>
	实体列表<span class="token punctuation">:</span> list<span class="token punctuation">,</span>
	原点<span class="token punctuation">:</span> vec2<span class="token punctuation">,</span> 
	最小半径<span class="token punctuation">:</span> num<span class="token punctuation">,</span> 
	最大半径<span class="token punctuation">:</span> num<span class="token punctuation">,</span> 
	标签<span class="token punctuation">:</span> int<span class="token punctuation">,</span> 
	禁止标签<span class="token punctuation">:</span> int<span class="token punctuation">,</span> 
	过滤函数?<span class="token punctuation">:</span> func
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 范围内所有敌人<span class="token punctuation">:</span> list
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>e</code> 参数通常为 <code>store.entities</code></li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>为过滤函数传递：实体、原点</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>过滤函数用于筛选目标，返回假的目标将会被筛选</li>
</ul></div><div class="el-h4"><h4 data-heading="2. 搜索首个敌人" dir="auto" class="heading" id="2._搜索首个敌人_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>2. 搜索首个敌人</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">U<span class="token punctuation">.</span><span class="token function">find_foremost_enemy</span><span class="token punctuation">(</span>
	实体列表<span class="token punctuation">:</span> list<span class="token punctuation">,</span> 
	原点<span class="token punctuation">:</span> vec2<span class="token punctuation">,</span> 
	最小半径<span class="token punctuation">:</span> num<span class="token punctuation">,</span> 
	最大半径<span class="token punctuation">:</span> num<span class="token punctuation">,</span> 
	预判时间<span class="token punctuation">:</span> num<span class="token punctuation">,</span> 
	标签<span class="token punctuation">:</span> int<span class="token punctuation">,</span> 
	禁止标签<span class="token punctuation">:</span> int<span class="token punctuation">,</span> 
	过滤函数?<span class="token punctuation">:</span> func<span class="token punctuation">,</span> 
	禁用最小半径的标签<span class="token punctuation">:</span> int
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 首个敌人<span class="token punctuation">:</span> table<span class="token punctuation">,</span> 范围内所有敌人<span class="token punctuation">:</span> <span class="token function">list</span><span class="token punctuation">{</span>敌人<span class="token punctuation">:</span> table<span class="token punctuation">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 预判位置<span class="token punctuation">:</span> vec2
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>禁用最小半径的标签：拥有此标签的目标不受搜索最小半径限制</li>
</ul></div><div class="el-p"><p dir="auto">所有索敌见<a data-href="9. 工具函数#一、索敌" href="总结/9.-工具函数.html#一、索敌" class="internal-link" target="_self" rel="noopener nofollow">9. 工具函数 &gt; 一、索敌</a></p></div><div class="el-h3"><h3 data-heading="3.7.2 过滤函数" dir="auto" class="heading" id="3.7.2_过滤函数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.7.2 过滤函数</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> target <span class="token operator">=</span> U<span class="token punctuation">.</span><span class="token function">find_foremost_enemy</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> origin<span class="token punctuation">)</span>	<span class="token comment">-- v 为实体，origin 为原点</span>
	<span class="token punctuation">...</span>	<span class="token comment">-- 函数体</span>
	<span class="token keyword">return</span> v<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp <span class="token operator">&gt;=</span> <span class="token number">1000</span>	<span class="token comment">-- 筛选掉血量小于 1000 的敌人</span>
<span class="token keyword">end</span><span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>	
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.7.3 寻找血量最高的敌人" dir="auto" class="heading" id="3.7.3_寻找血量最高的敌人_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.7.3 寻找血量最高的敌人</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> targets <span class="token operator">=</span> U<span class="token punctuation">.</span><span class="token function">find_enemies_in_range</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>entities<span class="token punctuation">,</span> hero<span class="token punctuation">.</span>pos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> a<span class="token punctuation">.</span>vis_flags<span class="token punctuation">,</span> a<span class="token punctuation">.</span>vis_bans<span class="token punctuation">)</span>

<span class="token keyword">if</span> targets <span class="token keyword">then</span>
	table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>targets<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>
		<span class="token keyword">return</span> e1<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp <span class="token operator">&gt;</span> e2<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp	<span class="token comment">-- 根据血量排序，血量最高的排序在最前</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span>
	
	<span class="token keyword">local</span> target <span class="token operator">=</span> targets<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>	<span class="token comment">-- 取血量最高目标</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="3.8 实体攻击增加条件" dir="auto" class="heading" id="3.8_实体攻击增加条件_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.8 实体攻击增加条件</h2></div><div class="el-h3"><h3 data-heading="3.8.1 近战攻击条件" dir="auto" class="heading" id="3.8.1_近战攻击条件_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.8.1 近战攻击条件</h3></div><div class="el-p"><p dir="auto">给近战攻击的 <code>fn_can</code> 指定条件函数即可。</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fn_can <span class="token operator">=</span> 条件函数<span class="token punctuation">:</span> func
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>为条件函数传递： <code>store</code>、攻击、目标</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>条件函数返回真表示可以攻击</li>
</ul></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_3"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以给鬼侍灭魂斩增加条件为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trigger_min_hp <span class="token operator">=</span> <span class="token number">150</span>	<span class="token comment">-- 释放条件：目标血量大于等于 150</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fn_can <span class="token operator">=</span> scripts<span class="token punctuation">.</span>hero_oni<span class="token punctuation">.</span>update

<span class="token comment">-- game_scripts</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_oni<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>

<span class="token comment">-- 写在更新函数下面</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_oni<span class="token punctuation">.</span><span class="token function">melee_fn_can_2</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> a<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
	<span class="token keyword">return</span> target<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp <span class="token operator">&gt;=</span> a<span class="token punctuation">.</span>trigger_min_hp
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.8.2 远程攻击条件" dir="auto" class="heading" id="3.8.2_远程攻击条件_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.8.2 远程攻击条件</h3></div><div class="el-p"><p dir="auto">给远程攻击的 <code>filter_fn</code> 指定条件函数即可。</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>filter_fn <span class="token operator">=</span> 条件函数<span class="token punctuation">:</span> func
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>为条件函数传递：目标、原点</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>条件函数返回真表示可以攻击</li>
</ul></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_4"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以小公主为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trigger_min_hp <span class="token operator">=</span> <span class="token number">150</span>	
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>filter_fn <span class="token operator">=</span> scripts<span class="token punctuation">.</span>hero_alleria<span class="token punctuation">.</span>ranged_filter_fn_1

<span class="token comment">-- game_scripts</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_alleria<span class="token punctuation">.</span><span class="token function">ranged_filter_fn_1</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> origin<span class="token punctuation">)</span>
	<span class="token keyword">return</span> v<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp <span class="token operator">&gt;</span> trigger_min_hp
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.8.3 释放概率根据条件而变化" dir="auto" class="heading" id="3.8.3_释放概率根据条件而变化_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.8.3 释放概率根据条件而变化</h3></div><div class="el-p"><p dir="auto">给攻击的 <code>fn_chance</code> 指定条件函数即可。</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fn_chance <span class="token operator">=</span> 条件函数<span class="token punctuation">:</span> func
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>为条件函数传递：当前实体、<code>store</code>、攻击、目标</li>
</ul></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_5"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以使鬼侍灭魂斩 100% 秒杀处于流血效果的目标为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 鬼侍近战攻击 2 是灭魂斩的秒杀，3 则是灭魂斩不秒杀的真伤</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>instakill_mod_type <span class="token operator">=</span> MOD_TYPE_BLEED	<span class="token comment">-- 效果类型：流血类型</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fn_chance <span class="token operator">=</span> scripts<span class="token punctuation">.</span>hero_oni<span class="token punctuation">.</span>fn_chance_death_strike

<span class="token comment">-- game_scripts</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_oni<span class="token punctuation">.</span><span class="token function">fn_chance_death_strike</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> a<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
	<span class="token keyword">return</span> U<span class="token punctuation">.</span><span class="token function">has_modifier_types</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> target<span class="token punctuation">,</span> a<span class="token punctuation">.</span>instakill_mod_type<span class="token punctuation">)</span> <span class="token keyword">or</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> attack<span class="token punctuation">.</span>chance
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.8.4 判断是否拥有状态效果" dir="auto" class="heading" id="3.8.4_判断是否拥有状态效果_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.8.4 判断是否拥有状态效果</h3></div><div class="el-h4"><h4 data-heading="1. 判断拥有单个效果" dir="auto" class="heading" id="1._判断拥有单个效果_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>1. 判断拥有单个效果</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">U<span class="token punctuation">.</span><span class="token function">has_modifiers</span><span class="token punctuation">(</span>store<span class="token punctuation">:</span> table<span class="token punctuation">,</span> 实体<span class="token punctuation">:</span> table<span class="token punctuation">,</span> 效果模板名<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 是否拥有<span class="token punctuation">:</span> bool<span class="token punctuation">,</span> 找到的效果实体<span class="token punctuation">:</span> table
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>若不传递效果模板名称则返回所有效果</li>
</ul></div><div class="el-h4"><h4 data-heading="2. 判断拥有效果类型" dir="auto" class="heading" id="2._判断拥有效果类型_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>2. 判断拥有效果类型</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">U<span class="token punctuation">.</span><span class="token function">has_modifier_types</span><span class="token punctuation">(</span>store<span class="token punctuation">:</span> table<span class="token punctuation">,</span> 实体<span class="token punctuation">:</span> table<span class="token punctuation">,</span> 效果类型<span class="token punctuation">:</span> int<span class="token punctuation">...</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 是否拥有<span class="token punctuation">:</span> bool<span class="token punctuation">,</span> 所有找到的效果实体<span class="token punctuation">:</span> table
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="3.9 增加新攻击与技能" dir="auto" class="heading" id="3.9_增加新攻击与技能_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9 增加新攻击与技能</h2></div><div class="el-h3"><h3 data-heading="3.9.1 攻击概率造成效果" dir="auto" class="heading" id="3.9.1_攻击概率造成效果_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9.1 攻击概率造成效果</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">deepclone</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>		<span class="token comment">-- 深拷贝的攻击</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>chance <span class="token operator">=</span> 概率<span class="token punctuation">:</span> num
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mod <span class="token operator">=</span> 效果模板名<span class="token punctuation">:</span> str
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_6"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以火男普攻概率造成燃烧效果为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">deepclone</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>		<span class="token comment">-- 深拷贝近战普攻</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>chance <span class="token operator">=</span> <span class="token number">0.5</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mod <span class="token operator">=</span> <span class="token string">"mod_lava"</span>

<span class="token comment">-- 升级函数，只有能升级（有升级函数）的单位才需要修改升级函数</span>
<span class="token punctuation">...</span>
this<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>damage_min <span class="token operator">=</span> ls<span class="token punctuation">.</span>melee_damage_min<span class="token punctuation">[</span>hl<span class="token punctuation">]</span>
this<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>damage_max <span class="token operator">=</span> ls<span class="token punctuation">.</span>melee_damage_max<span class="token punctuation">[</span>hl<span class="token punctuation">]</span>
<span class="token comment">-- 同时将伤害赋值到新攻击上</span>
this<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>damage_min <span class="token operator">=</span> ls<span class="token punctuation">.</span>melee_damage_min<span class="token punctuation">[</span>hl<span class="token punctuation">]</span>
this<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>damage_max <span class="token operator">=</span> ls<span class="token punctuation">.</span>melee_damage_max<span class="token punctuation">[</span>hl<span class="token punctuation">]</span>
<span class="token punctuation">...</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.9.2 防御塔攻击概率造成效果" dir="auto" class="heading" id="3.9.2_防御塔攻击概率造成效果_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9.2 防御塔攻击概率造成效果</h3></div><div class="el-p"><p dir="auto">防御塔的攻击需要自己写逻辑。</p></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_7"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以地震普攻概率造成眩晕效果为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
<span class="token keyword">local</span> tower_dwaarp <span class="token operator">=</span> <span class="token function">RT</span><span class="token punctuation">(</span><span class="token string">"tower_dwaarp"</span><span class="token punctuation">,</span> <span class="token string">"tower"</span><span class="token punctuation">)</span>
tower_dwaarp<span class="token punctuation">.</span>attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">deepclone</span><span class="token punctuation">(</span>tower_dwaarp<span class="token punctuation">.</span>attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tower_dwaarp<span class="token punctuation">.</span>attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mod <span class="token operator">=</span> <span class="token string">"mod_stun"</span>
tower_dwaarp<span class="token punctuation">.</span>attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>chance <span class="token operator">=</span> <span class="token number">0.5</span>

<span class="token comment">-- 更新函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>tower_dwaarp<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> script<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	<span class="token keyword">local</span> aa_m <span class="token operator">=</span> this<span class="token punctuation">.</span>attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
	
	<span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span>
		<span class="token keyword">if</span> this<span class="token punctuation">.</span>tower<span class="token punctuation">.</span>blocked <span class="token keyword">then</span>
			coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span>
			<span class="token punctuation">...</span>
			<span class="token keyword">if</span> store<span class="token punctuation">.</span>tick_ts <span class="token operator">-</span> aa<span class="token punctuation">.</span>ts <span class="token operator">&gt;</span> aa<span class="token punctuation">.</span>cooldown <span class="token keyword">then</span>
				<span class="token punctuation">...</span>
				<span class="token comment">-- 若进行攻击 1 则计算概率，然后将攻击 1 改成攻击 4</span>
				<span class="token keyword">if</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> aa_m<span class="token punctuation">.</span>chance <span class="token keyword">then</span>
					aa <span class="token operator">=</span> aa_m
				<span class="token keyword">end</span>
			<span class="token keyword">end</span>
			<span class="token punctuation">...</span>
			
			<span class="token keyword">if</span> <span class="token keyword">not</span> drill_ready <span class="token keyword">and</span> <span class="token keyword">not</span> lava_ready <span class="token keyword">and</span> <span class="token keyword">not</span> std_ready <span class="token keyword">then</span>
				coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">else</span>
				<span class="token punctuation">...</span>
				<span class="token keyword">if</span> std_ready <span class="token keyword">and</span> trigger_enemy <span class="token keyword">then</span>
					<span class="token comment">-- 更新两个时间戳</span>
					aa<span class="token punctuation">.</span>ts <span class="token operator">=</span> store<span class="token punctuation">.</span>tick_ts
                    this<span class="token punctuation">.</span>attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ts <span class="token operator">=</span> store<span class="token punctuation">.</span>tick_ts
					<span class="token punctuation">...</span>
					<span class="token comment">-- 还原</span>
					aa <span class="token operator">=</span> this<span class="token punctuation">.</span>attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
					std_ready <span class="token operator">=</span> <span class="token keyword">false</span>
					lava_ready <span class="token operator">=</span> <span class="token keyword">false</span>
					<span class="token punctuation">...</span>
				<span class="token keyword">end</span>
				<span class="token punctuation">...</span>
			<span class="token keyword">end</span>
			<span class="token punctuation">...</span>
		<span class="token keyword">end</span>
		<span class="token punctuation">...</span>
	<span class="token keyword">end</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.9.3 增加远程攻击" dir="auto" class="heading" id="3.9.3_增加远程攻击_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9.3 增加远程攻击</h3></div><div class="el-h4"><h4 data-heading="1. 士兵" dir="auto" class="heading" id="1._士兵_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>1. 士兵</h4></div><div class="el-p"><p dir="auto">以爵士为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
tt <span class="token operator">=</span> <span class="token function">RT</span><span class="token punctuation">(</span><span class="token string">"hero_gerald"</span><span class="token punctuation">,</span> <span class="token string">"hero"</span><span class="token punctuation">)</span>
<span class="token function">AC</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> <span class="token string">"melee"</span><span class="token punctuation">,</span> <span class="token string">"timed_attacks"</span><span class="token punctuation">,</span> <span class="token string">"dodge"</span><span class="token punctuation">,</span> <span class="token string">"ranged"</span><span class="token punctuation">)</span>
<span class="token punctuation">...</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bullet <span class="token operator">=</span> <span class="token string">"gerald_arrow"</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bullet_start_offset <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">v</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cooldown <span class="token operator">=</span> <span class="token number">1</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max_range <span class="token operator">=</span> <span class="token number">150</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min_range <span class="token operator">=</span> <span class="token number">25</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shoot_time <span class="token operator">=</span> <span class="token function">fts</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token string">"idle"</span>		<span class="token comment">-- 使用待机时的动画</span>

tt <span class="token operator">=</span> <span class="token function">RT</span><span class="token punctuation">(</span><span class="token string">"gerald_arrow"</span><span class="token punctuation">,</span> <span class="token string">"arrow"</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>damage_min <span class="token operator">=</span> <span class="token number">10</span>
tt<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>damage_max <span class="token operator">=</span> <span class="token number">25</span>
tt<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>prediction_error <span class="token operator">=</span> <span class="token keyword">false</span>

<span class="token comment">-- 更新函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_gerald<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	brk<span class="token punctuation">,</span> sta <span class="token operator">=</span> SU<span class="token punctuation">.</span><span class="token function">y_soldier_melee_block_and_attacks</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span>	<span class="token comment">-- 调用近战攻击函数</span>
	<span class="token comment">-- brk 就是 break，sta 就是 status</span>
	
	<span class="token keyword">if</span> brk <span class="token keyword">or</span> sta <span class="token operator">~=</span> A_NO_TARGET <span class="token keyword">then</span>	<span class="token comment">-- 删除 sta ~= A_NO_TARGET 条件即可让近战攻击与远程攻击同时进行</span>
		<span class="token comment">-- block empty</span>
	<span class="token keyword">else</span>
		brk<span class="token punctuation">,</span> sta <span class="token operator">=</span> SU<span class="token punctuation">.</span><span class="token function">y_soldier_ranged_attacks</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span>	<span class="token comment">-- 调用远程攻击函数</span>
		
		<span class="token keyword">if</span> brk <span class="token keyword">then</span>
			<span class="token comment">-- block empty</span>
		<span class="token keyword">elseif</span> SU<span class="token punctuation">.</span><span class="token function">soldier_go_back_step</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span> <span class="token keyword">then</span>	<span class="token comment">-- 前往集结点</span>
			<span class="token comment">-- block empty</span>
		<span class="token keyword">else</span>
			SU<span class="token punctuation">.</span><span class="token function">soldier_idle</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span>
			SU<span class="token punctuation">.</span><span class="token function">soldier_regen</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h4"><h4 data-heading="2. 敌人" dir="auto" class="heading" id="2._敌人_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>2. 敌人</h4></div><div class="el-p"><p dir="auto">以利维坦为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt <span class="token operator">=</span> <span class="token function">RT</span><span class="token punctuation">(</span><span class="token string">"eb_leviathan"</span><span class="token punctuation">,</span> <span class="token string">"boss"</span><span class="token punctuation">)</span>
<span class="token function">AC</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> <span class="token string">"attacks"</span><span class="token punctuation">,</span> <span class="token string">"ranged"</span><span class="token punctuation">)</span>
<span class="token punctuation">...</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bullet <span class="token operator">=</span> <span class="token string">"bolt_blazefang_eb_leviathan"</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bullet_start_offset <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">v</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">v</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">v</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cooldown <span class="token operator">=</span> <span class="token number">1</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>hold_advance <span class="token operator">=</span> <span class="token keyword">true</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max_range <span class="token operator">=</span> <span class="token number">150</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>min_range <span class="token operator">=</span> <span class="token number">25</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shoot_time <span class="token operator">=</span> <span class="token function">fts</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token string">"idle"</span>		<span class="token comment">-- 使用待机时的动画</span>
tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shared_cooldown <span class="token operator">=</span> <span class="token keyword">true</span>
<span class="token punctuation">...</span>

tt <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">register_t</span><span class="token punctuation">(</span><span class="token string">"bolt_blazefang_eb_leviathan"</span><span class="token punctuation">,</span> <span class="token string">"bolt_blazefang"</span><span class="token punctuation">)</span>	<span class="token comment">-- 续承蜥蜴人未来战士子弹</span>
tt<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>damage_max <span class="token operator">=</span> <span class="token number">1000</span>
tt<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>damage_min <span class="token operator">=</span> <span class="token number">600</span>

<span class="token comment">-- 更新函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>eb_leviathan<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> script<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	<span class="token keyword">local</span> a <span class="token operator">=</span> this<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
	
	<span class="token punctuation">::</span>label_244_0<span class="token punctuation">::</span>

	<span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span>
		<span class="token punctuation">...</span>
		<span class="token keyword">if</span> this<span class="token punctuation">.</span>unit<span class="token punctuation">.</span>is_stunned <span class="token keyword">then</span>
			coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span>
			<span class="token keyword">local</span> ranged <span class="token operator">=</span> U<span class="token punctuation">.</span><span class="token function">find_nearest_soldier</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>entities<span class="token punctuation">,</span> this<span class="token punctuation">.</span>pos<span class="token punctuation">,</span> a<span class="token punctuation">.</span>min_range<span class="token punctuation">,</span> a<span class="token punctuation">.</span>max_range<span class="token punctuation">,</span> a<span class="token punctuation">.</span>vis_flags<span class="token punctuation">,</span> a<span class="token punctuation">.</span>vis_bans<span class="token punctuation">)</span>

			<span class="token comment">-- 如果找到士兵目标</span>
			<span class="token keyword">if</span> ranged <span class="token keyword">then</span>
				<span class="token comment">-- 如果可以远程攻击，并且没有被拦截一直进行远程攻击</span>
				<span class="token keyword">while</span> SU<span class="token punctuation">.</span><span class="token function">can_range_soldier</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">,</span> ranged<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token operator">#</span>this<span class="token punctuation">.</span>enemy<span class="token punctuation">.</span>blockers <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">do</span>
					<span class="token keyword">if</span> <span class="token keyword">not</span> SU<span class="token punctuation">.</span><span class="token function">y_enemy_range_attacks</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">,</span> ranged<span class="token punctuation">)</span> <span class="token keyword">then</span>
						<span class="token keyword">goto</span> label_244_0
					<span class="token keyword">end</span>
	
					coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">end</span>
			<span class="token keyword">end</span>
			<span class="token punctuation">...</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.9.4 增加新技能" dir="auto" class="heading" id="3.9.4_增加新技能_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9.4 增加新技能</h3></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_8"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以给尼鲁增加一个技能：每 275 秒增加 1 生命（升级二技能翠绿迸发解锁）为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
tt<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>heal_live <span class="token operator">=</span> <span class="token function">CC</span><span class="token punctuation">(</span><span class="token string">"hero_skill"</span><span class="token punctuation">)</span>	<span class="token comment">-- 防御塔与其他单位技能组件是 power</span>
tt<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>heal_live<span class="token punctuation">.</span>cooldown <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token number">275</span><span class="token punctuation">,</span>	<span class="token comment">-- 一级冷却时间 275 秒</span>
	<span class="token number">245</span><span class="token punctuation">,</span>	<span class="token comment">-- 三级冷却时间 245 秒</span>
	<span class="token number">210</span>		<span class="token comment">-- 三级冷却时间 210 秒</span>
<span class="token punctuation">}</span>
<span class="token punctuation">...</span>
tt<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CC</span><span class="token punctuation">(</span><span class="token string">"custom_attack"</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token string">"fairy_dust"</span>	<span class="token comment">-- 动画套用四技能衰弱咒语</span>
tt<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sound <span class="token operator">=</span> <span class="token string">"HeroNyruFairyDustCast"</span>	<span class="token comment">-- 音效，也是借用衰弱咒语</span>
tt<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cooldown <span class="token operator">=</span> <span class="token keyword">nil</span>
tt<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token keyword">true</span>
tt<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>heal_live <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment">-- 升级函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_muyrn<span class="token punctuation">.</span><span class="token function">level_up</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> initial<span class="token punctuation">)</span>
	s <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>verdant_blast
	sl <span class="token operator">=</span> s<span class="token punctuation">.</span>level
	
	<span class="token punctuation">...</span>
	<span class="token keyword">if</span> sl <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> initial <span class="token keyword">then</span>
		<span class="token punctuation">...</span>
		<span class="token keyword">local</span> a <span class="token operator">=</span> this<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
		a<span class="token punctuation">.</span>cooldown <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>heal_live<span class="token punctuation">.</span>cooldown<span class="token punctuation">[</span>sl<span class="token punctuation">]</span>
		a<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token keyword">nil</span>
		<span class="token punctuation">...</span>
	<span class="token keyword">end</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>

<span class="token comment">-- 更新函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_muyrn<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	<span class="token keyword">if</span> this<span class="token punctuation">.</span>unit<span class="token punctuation">.</span>is_stunned <span class="token keyword">then</span>
		SU<span class="token punctuation">.</span><span class="token function">soldier_idle</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span>
	<span class="token keyword">else</span>
		<span class="token punctuation">...</span>
		a <span class="token operator">=</span> this<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
		skill <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>heal_live
	
		<span class="token keyword">if</span> <span class="token keyword">not</span> a<span class="token punctuation">.</span>disabled <span class="token keyword">and</span> store<span class="token punctuation">.</span>tick_ts <span class="token operator">-</span> a<span class="token punctuation">.</span>ts <span class="token operator">&gt;</span> a<span class="token punctuation">.</span>cooldown <span class="token keyword">then</span>
			a<span class="token punctuation">.</span>ts <span class="token operator">=</span> store<span class="token punctuation">.</span>tick_ts
			U<span class="token punctuation">.</span><span class="token function">animation_start</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> a<span class="token punctuation">.</span>animation<span class="token punctuation">,</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span>tick_ts<span class="token punctuation">)</span>
			S<span class="token punctuation">:</span><span class="token function">queue</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>sound<span class="token punctuation">)</span>	<span class="token comment">-- 播放音效</span>
			
			store<span class="token punctuation">.</span>lives <span class="token operator">=</span> store<span class="token punctuation">.</span>lives <span class="token operator">+</span> a<span class="token punctuation">.</span>heal_live	<span class="token comment">-- 增加生命</span>
	
			SU<span class="token punctuation">.</span><span class="token function">y_hero_animation_wait</span><span class="token punctuation">(</span>this<span class="token punctuation">)</span>	<span class="token comment">-- 等待动画完成</span>
		<span class="token punctuation">...</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.9.5 闪避反击" dir="auto" class="heading" id="3.9.5_闪避反击_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9.5 闪避反击</h3></div><div class="el-p"><p dir="auto">为闪避组件的 <code>counter_attack</code> 指定攻击即可。</p></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_9"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以爵士格挡为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>counter_attack <span class="token operator">=</span> <span class="token function">CC</span><span class="token punctuation">(</span><span class="token string">"melee_attack"</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>counter_attack<span class="token punctuation">.</span>damage_type <span class="token operator">=</span> <span class="token function">bor</span><span class="token punctuation">(</span>DAMAGE_TRUE<span class="token punctuation">,</span> DAMAGE_NO_DODGE<span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>counter_attack<span class="token punctuation">.</span>reflected_damage_factor <span class="token operator">=</span> <span class="token number">0.5</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>counter_attack<span class="token punctuation">.</span>reflected_damage_factor_inc <span class="token operator">=</span> <span class="token number">0.5</span>	<span class="token comment">-- 技能升级提升系数</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>counter_attack<span class="token punctuation">.</span>hit_time <span class="token operator">=</span> <span class="token function">fts</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>counter_attack<span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token string">"counter"</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>counter_attack<span class="token punctuation">.</span>sound <span class="token operator">=</span> <span class="token string">"HeroPaladinDeflect"</span>

<span class="token comment">-- 更新函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_gerald<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	<span class="token keyword">local</span> d <span class="token operator">=</span> this<span class="token punctuation">.</span>dodge
	
	<span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span>
		<span class="token punctuation">...</span>
		<span class="token keyword">if</span> this<span class="token punctuation">.</span>unit<span class="token punctuation">.</span>is_stunned <span class="token keyword">then</span>
			SU<span class="token punctuation">.</span><span class="token function">soldier_idle</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span>
		<span class="token keyword">else</span>
			<span class="token punctuation">...</span>
			skill <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>block_counter
			
			<span class="token keyword">if</span> skill<span class="token punctuation">.</span>level <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> d <span class="token keyword">and</span> d<span class="token punctuation">.</span>active <span class="token keyword">then</span>
	
				d<span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token keyword">false</span>		<span class="token comment">-- 闪避后 dodge.active 会被赋值为真</span>
				d<span class="token punctuation">.</span>counter_attack_pending <span class="token operator">=</span> <span class="token keyword">true</span>	<span class="token comment">-- counter_attack_pending 为真表示将下次的普攻改成闪避反击</span>
	
				<span class="token keyword">local</span> la <span class="token operator">=</span> d<span class="token punctuation">.</span>last_attack
				<span class="token keyword">local</span> ca <span class="token operator">=</span> d<span class="token punctuation">.</span>counter_attack
	
				<span class="token keyword">if</span> la <span class="token keyword">then</span>
					<span class="token keyword">local</span> counter_damage <span class="token operator">=</span> ca<span class="token punctuation">.</span>reflected_damage_factor <span class="token operator">+</span> ca<span class="token punctuation">.</span>reflected_damage_factor_inc <span class="token operator">*</span> skill<span class="token punctuation">.</span>level
				
					ca<span class="token punctuation">.</span>damage_max <span class="token operator">=</span> la<span class="token punctuation">.</span>damage_max <span class="token operator">*</span> counter_damage
					ca<span class="token punctuation">.</span>damage_min <span class="token operator">=</span> la<span class="token punctuation">.</span>damage_min <span class="token operator">*</span> counter_damage
				<span class="token keyword">end</span>
				<span class="token punctuation">...</span>
			<span class="token keyword">end</span>
			<span class="token punctuation">...</span>
		<span class="token keyword">end</span>
		<span class="token punctuation">...</span>
	<span class="token keyword">end</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.9.6 闪避条件" dir="auto" class="heading" id="3.9.6_闪避条件_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9.6 闪避条件</h3></div><div class="el-p"><p dir="auto">给闪避的 <code>can_dodge</code> 指定条件函数即可。</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded">tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>can_dodge <span class="token operator">=</span> 条件函数<span class="token punctuation">:</span> func
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>为条件函数传递 <code>store</code> 当前实体、远程攻击、攻击、来源</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>条件函数返回真表示可以闪避</li>
</ul></div><div class="el-h4"><h4 data-heading="示例" dir="auto" class="heading" id="示例_10"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例</h4></div><div class="el-p"><p dir="auto">以爵士格挡为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
tt<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>can_dodge <span class="token operator">=</span> scripts<span class="token punctuation">.</span>hero_gerald<span class="token punctuation">.</span>fn_can_dodge

<span class="token comment">-- game_scripts</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_gerald<span class="token punctuation">.</span><span class="token function">fn_can_dodge</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">,</span> ranged_attack<span class="token punctuation">,</span> attack<span class="token punctuation">,</span> source<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>attack <span class="token keyword">and</span> attack<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"area"</span> <span class="token keyword">or</span> source <span class="token keyword">and</span> source<span class="token punctuation">.</span>vis <span class="token keyword">and</span> <span class="token function">band</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>vis<span class="token punctuation">.</span>flags<span class="token punctuation">,</span> F_BOSS<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">and</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> this<span class="token punctuation">.</span>dodge<span class="token punctuation">.</span>low_chance_factor <span class="token keyword">then</span>
		<span class="token comment">-- 如果攻击为范围伤害，或为 Boss 计算闪避概率（Boss 闪避概率为三分之一）</span>
		<span class="token keyword">return</span> <span class="token keyword">false</span>
	<span class="token keyword">end</span>

	<span class="token keyword">return</span> <span class="token keyword">true</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="3.9.7 攻击优先级" dir="auto" class="heading" id="3.9.7_攻击优先级_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.9.7 攻击优先级</h3></div><div class="el-p"><p dir="auto">攻击优先级存储于攻击的 <code>order</code> 中，通过 <code>U.attack_order</code> 自动排序。攻击概率造成效果也是通过其排序方法实现的。</p></div><div class="el-h4"><h4 data-heading="排序方法" dir="auto" class="heading" id="排序方法_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>排序方法</h4></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">释放概率不同，释放概率低者在前</li>
<li data-line="1" dir="auto">释放概率相同，冷却时间长者在前</li>
<li data-line="2" dir="auto">所有条件相同，攻击索引低者在前</li>
</ol></div><div class="el-h4"><h4 data-heading="手动指定优先级" dir="auto" class="heading" id="手动指定优先级_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>手动指定优先级</h4></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 雷格森插入函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_regson<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
	<span class="token punctuation">...</span>
	this<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>order <span class="token operator">=</span> U<span class="token punctuation">.</span><span class="token function">attack_order</span><span class="token punctuation">(</span>this<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>attacks<span class="token punctuation">)</span>	<span class="token comment">-- 删除这个</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>

<span class="token comment">-- 直接在模板指定攻击优先级</span>
tt<span class="token punctuation">.</span>melee<span class="token punctuation">.</span>order <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token number">2</span><span class="token punctuation">,</span>		<span class="token comment">-- 优先释放近战攻击 2</span>
	<span class="token number">1</span><span class="token punctuation">,</span>		<span class="token comment">-- 之后释放近战攻击 1</span>
	<span class="token punctuation">...</span>		<span class="token comment">-- 注：必须填写所有的攻击，没填写的攻击将永不释放</span>
<span class="token punctuation">}</span>

<span class="token comment">-- 远程攻击同理</span>
this<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>order <span class="token operator">=</span> U<span class="token punctuation">.</span><span class="token function">attack_order</span><span class="token punctuation">(</span>this<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>attacks<span class="token punctuation">)</span>	<span class="token comment">-- 删除这个</span>

tt<span class="token punctuation">.</span>ranged<span class="token punctuation">.</span>order <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token number">2</span><span class="token punctuation">,</span>		<span class="token comment">-- 优先释放远程攻击 2</span>
	<span class="token number">1</span><span class="token punctuation">,</span>		<span class="token comment">-- 之后释放远程攻击 1</span>
	<span class="token punctuation">...</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="3.10 特殊效果" dir="auto" class="heading" id="3.10_特殊效果_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.10 特殊效果</h2></div><div class="el-h3"><h3 data-heading="3.10.1 增加二阶段" dir="auto" class="heading" id="3.10.1_增加二阶段_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.10.1 增加二阶段</h3></div><div class="el-p"><p dir="auto">以利维坦为例：</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模板</span>
tt <span class="token operator">=</span> E<span class="token punctuation">:</span><span class="token function">register_t</span><span class="token punctuation">(</span><span class="token string">"eb_leviathan"</span><span class="token punctuation">,</span> <span class="token string">"boss"</span><span class="token punctuation">)</span>
<span class="token punctuation">...</span>
tt<span class="token punctuation">.</span>second_phase <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
tt<span class="token punctuation">.</span>second_phase<span class="token punctuation">.</span>wait_time <span class="token operator">=</span> <span class="token number">5</span>		<span class="token comment">-- 死亡后进入二阶段等待时间</span>
tt<span class="token punctuation">.</span>second_phase<span class="token punctuation">.</span>hp_max <span class="token operator">=</span> <span class="token number">10000</span>		<span class="token comment">-- 二阶段血量</span>
tt<span class="token punctuation">.</span>second_phase<span class="token punctuation">.</span>armor <span class="token operator">=</span> <span class="token number">0.5</span>			<span class="token comment">-- 二阶段护甲</span>

<span class="token comment">-- 更新函数</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>eb_leviathan<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">,</span> script<span class="token punctuation">)</span>
<span class="token punctuation">...</span>
	<span class="token punctuation">::</span>label_244_0<span class="token punctuation">::</span>

	<span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span>
		<span class="token keyword">if</span> this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>dead <span class="token keyword">then</span>
			<span class="token keyword">if</span> <span class="token keyword">not</span> this<span class="token punctuation">.</span>is_second_phase <span class="token keyword">then</span>
				this<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>can_click <span class="token operator">=</span> <span class="token keyword">false</span>		<span class="token comment">-- 进入二阶段等待时禁止玩家点击，避免显示状态栏</span>
				this<span class="token punctuation">.</span>health_bar<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token keyword">true</span>	<span class="token comment">-- 进入二阶段等待时隐藏血条</span>
				U<span class="token punctuation">.</span><span class="token function">animation_start</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> <span class="token string">"death"</span><span class="token punctuation">,</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span>tick_ts<span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>		<span class="token comment">-- 播放死亡动画</span>

				U<span class="token punctuation">.</span><span class="token function">y_wait</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">.</span>second_phase<span class="token punctuation">.</span>wait_time<span class="token punctuation">)</span>	<span class="token comment">-- 等待 5 秒</span>

				this<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>can_click <span class="token operator">=</span> <span class="token keyword">true</span>		<span class="token comment">-- 重新启用，允许玩家点击</span>
				this<span class="token punctuation">.</span>health_bar<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token keyword">false</span>	<span class="token comment">-- 重新显示血条</span>
				this<span class="token punctuation">.</span>is_second_phase <span class="token operator">=</span> <span class="token keyword">true</span>
				this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>dead <span class="token operator">=</span> <span class="token keyword">false</span>

				this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp_max <span class="token operator">=</span> this<span class="token punctuation">.</span>second_phase<span class="token punctuation">.</span>hp_max		<span class="token comment">-- 设置新的最大血量</span>
				this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>hp <span class="token operator">=</span> this<span class="token punctuation">.</span>second_phase<span class="token punctuation">.</span>hp_max			<span class="token comment">-- 设置新的血量</span>
				this<span class="token punctuation">.</span>health<span class="token punctuation">.</span>armor <span class="token operator">=</span> this<span class="token punctuation">.</span>second_phase<span class="token punctuation">.</span>armor			<span class="token comment">-- 设置新的护甲</span>

				<span class="token keyword">goto</span> label_244_0		<span class="token comment">-- 直接跳出，避免进入死亡移除环节（正式死亡）</span>
			<span class="token keyword">end</span>

			<span class="token comment">-- 二阶段死亡则进入死亡移除环节（正式死亡）</span>
			this<span class="token punctuation">.</span>phase <span class="token operator">=</span> <span class="token string">"dead"</span>

			LU<span class="token punctuation">.</span><span class="token function">kill_all_enemies</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>

			<span class="token keyword">for</span> _<span class="token punctuation">,</span> t <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>tentacles<span class="token punctuation">)</span> <span class="token keyword">do</span>
				t<span class="token punctuation">.</span>interrupt <span class="token operator">=</span> <span class="token keyword">true</span>
			<span class="token keyword">end</span>

			<span class="token function">do_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token function">queue_remove</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> this<span class="token punctuation">)</span>
			signal<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"boss-killed"</span><span class="token punctuation">,</span> this<span class="token punctuation">)</span>

			<span class="token keyword">return</span>
		<span class="token keyword">end</span>
		<span class="token punctuation">...</span>
	<span class="token keyword">end</span>
	<span class="token punctuation">...</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="3.11 练习" dir="auto" class="heading" id="3.11_练习_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.11 练习</h2></div><div class="el-h3"><h3 data-heading="练习 1：了解驱动函数逻辑" dir="auto" class="heading" id="练习_1：了解驱动函数逻辑_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 1：了解驱动函数逻辑</h3></div><div class="el-p"><p dir="auto">根据 <a data-href="3. 实体函数#3 5 谁在调用插入与更新函数" href="第-2-节-修改基础/3.-实体函数.html#3 5 谁在调用插入与更新函数" class="internal-link" target="_self" rel="noopener nofollow">3. 实体函数 &gt; 3 5 谁在调用插入与更新函数</a> 阅读代码了解驱动函数是怎么调用实体函数的</p></div><div class="el-p"><p dir="auto"><strong>要点：</strong></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><strong>系统存储位置</strong>：系统存储于 <code>all/systems</code></li>
<li data-line="1" dir="auto"><strong>协程机制</strong>：更新函数使用协程（coroutine）管理与控制执行流程</li>
<li data-line="2" dir="auto"><strong>队列</strong>：使用多个队列（实体队列、伤害队列）批量处理操作</li>
</ol></div><div class="el-h3"><h3 data-heading="练习 2：日志与调试实践" dir="auto" class="heading" id="练习_2：日志与调试实践_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 2：日志与调试实践</h3></div><div class="el-p"><p dir="auto">（答案见<a data-href="第 2 节 - 修改基础/参考答案#练习 3 2：日志与调试实践" href="第-2-节-修改基础/参考答案.html#练习 3 2：日志与调试实践" class="internal-link" target="_self" rel="noopener nofollow">第 2 节 - 修改基础/参考答案 &gt; 练习 3 2：日志与调试实践</a>）</p></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 假设你正在为英雄 "暗影刺客" 实现一个新技能 "暗影突袭"</span>
<span class="token comment">-- 技能效果：对范围内血量最低的敌人造成伤害并附加流血效果</span>

<span class="token comment">-- 已有代码框架：</span>
<span class="token keyword">function</span> scripts<span class="token punctuation">.</span>hero_shadow_assassin<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> store<span class="token punctuation">)</span>
    <span class="token keyword">local</span> skill <span class="token operator">=</span> this<span class="token punctuation">.</span>hero<span class="token punctuation">.</span>skills<span class="token punctuation">.</span>shadow_assault
    <span class="token keyword">local</span> attack <span class="token operator">=</span> this<span class="token punctuation">.</span>timed_attacks<span class="token punctuation">.</span>list<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>  <span class="token comment">-- 第3个是暗影突袭</span>
    
    <span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span>
	    <span class="token keyword">if</span> skill<span class="token punctuation">.</span>level <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token keyword">not</span> attack<span class="token punctuation">.</span>disabled <span class="token keyword">then</span>
	        <span class="token keyword">if</span> store<span class="token punctuation">.</span>tick_ts <span class="token operator">-</span> attack<span class="token punctuation">.</span>ts <span class="token operator">&gt;=</span> attack<span class="token punctuation">.</span>cooldown <span class="token keyword">then</span>
	            <span class="token comment">-- 技能可用，开始索敌...</span>
	            
	            <span class="token comment">-- TODO: 在这里实现技能逻辑</span>
	            <span class="token comment">-- 要求：</span>
	            <span class="token comment">-- 1. 找到范围内血量最低的敌人</span>
	            <span class="token comment">-- 2. 造成伤害 (伤害值 = 基础伤害 + 技能等级 * 伤害成长)</span>
	            <span class="token comment">-- 3. 附加流血效果</span>
	            <span class="token comment">-- 4. 刷新技能时间戳</span>
	            <span class="token comment">-- 5. 播放动画和音效</span>
	            
	            <span class="token comment">-- 技能参数：</span>
	            <span class="token comment">-- attack.radius = 200          -- 技能范围</span>
	            <span class="token comment">-- attack.damage_base = 50      -- 基础伤害</span>
	            <span class="token comment">-- attack.damage_per_level = 30 -- 每级伤害成长</span>
	            <span class="token comment">-- attack.mod = "mod_bleed_v2"  -- 流血效果模板</span>
	        <span class="token keyword">end</span>
	    <span class="token keyword">end</span>
	    
	    coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 要求：</span>
<span class="token comment">-- 1. 实现上述TODO部分的技能逻辑</span>
<span class="token comment">-- 2. 在关键位置添加适当的日志：</span>
<span class="token comment">--    - 使用 log.debug 记录技能触发和目标选择</span>
<span class="token comment">--    - 使用 log.info 记录技能释放成功</span>
<span class="token comment">--    - 使用 log.warning 处理边界情况（如无目标）</span>
<span class="token comment">--    - 使用 log.error 处理严重错误</span>
<span class="token comment">--    - 使用 log.paranoid 记录详细的计算过程（可选）</span>
<span class="token comment">-- 3. 确保代码有良好的错误处理</span>

<span class="token comment">-- 提示函数：</span>
<span class="token comment">-- U.find_enemies_in_range  -- 范围内所有敌人</span>
<span class="token comment">-- table.sort               -- 对表排序</span>
<span class="token comment">-- E:create_entity("damage")-- 创建伤害实体</span>
<span class="token comment">-- E:create_entity			-- 创建效果实体</span>
<span class="token comment">-- queue_damage             -- 排队伤害</span>
<span class="token comment">-- queue_insert             -- 排队插入实体</span>
<span class="token comment">-- U.animation_start        -- 播放动画</span>
<span class="token comment">-- S:queue					-- 播放音效</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="3.12 本章总结" dir="auto" class="heading" id="3.12_本章总结_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>3.12 本章总结</h2></div><div class="el-h3"><h3 data-heading="关键知识点回顾" dir="auto" class="heading" id="关键知识点回顾_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>关键知识点回顾</h3></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>实体函数概述</strong></p>
<ul class="has-list-bullet">
<li data-line="1" dir="auto"><span class="list-bullet"></span><strong>定义</strong>：存储在 <code>kr/game_scripts</code> 和 <code>all/scripts</code> 中的逻辑函数</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><strong>作用</strong>：为 <code>main_script</code> 系统增加实体逻辑</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><strong>插入函数（insert）</strong>：实体创建时调用一次</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span><strong>更新函数（update）</strong>：每帧调用，管理实体持续行为</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span><strong>升级函数（level up）</strong>：实体升级时调用</li>
</ul>
</li>
<li data-line="7" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>存储位置</strong></p>
<ul class="has-list-bullet">
<li data-line="8" dir="auto"><span class="list-bullet"></span><strong>实体存储</strong>：所有实体存储在 <code>store.entities</code> 表中</li>
<li data-line="9" dir="auto"><span class="list-bullet"></span><strong>临时存储</strong>：<code>store</code> 用于存储游戏临时数据</li>
</ul>
</li>
<li data-line="11" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>核心技能实现</strong></p>
<ul class="has-list-bullet">
<li data-line="12" dir="auto"><span class="list-bullet"></span><strong>造成伤害</strong>：<code>E:create_entity("damage")</code> + <code>queue_damage</code></li>
<li data-line="13" dir="auto"><span class="list-bullet"></span><strong>造成效果</strong>：<code>E:create_entity</code> + <code>queue_insert</code></li>
<li data-line="14" dir="auto"><span class="list-bullet"></span><strong>增加光环</strong>：创建光环实体并设置 <code>source_id</code></li>
<li data-line="15" dir="auto"><span class="list-bullet"></span><strong>修改攻击优先级</strong>：直接在模板攻击指定 <code>order</code> 数组</li>
</ul>
</li>
<li data-line="17" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>时间与状态管理</strong></p>
<ul class="has-list-bullet">
<li data-line="18" dir="auto"><span class="list-bullet"></span><strong>游戏时间</strong>：<code>store.tick_ts</code></li>
<li data-line="19" dir="auto"><span class="list-bullet"></span><strong>时间戳</strong>：<code>a.ts</code>（攻击的时间戳）</li>
<li data-line="20" dir="auto"><span class="list-bullet"></span><strong>冷却计算</strong>：<code>store.tick_ts - a.ts &gt;= a.cooldown</code></li>
<li data-line="21" dir="auto"><span class="list-bullet"></span><strong>效果判断</strong>：<code>U.has_modifiers</code> 和 <code>U.has_modifier_types</code></li>
</ul>
</li>
<li data-line="23" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>打印日志</strong></p>
<ul class="has-list-bullet">
<li data-line="24" dir="auto"><span class="list-bullet"></span><strong>详细</strong>：<code>log.paranoid</code> 打印最详细的跟踪信息</li>
<li data-line="25" dir="auto"><span class="list-bullet"></span><strong>调试</strong>：<code>log.debug</code> 打印开发过程中的详细调试信息</li>
<li data-line="26" dir="auto"><span class="list-bullet"></span><strong>代办</strong>：<code>log.todo</code> 打印标记需要完成的功能或修复的问题</li>
<li data-line="27" dir="auto"><span class="list-bullet"></span><strong>信息</strong>：<code>log.info</code> 打印正常的游戏流程信息</li>
<li data-line="28" dir="auto"><span class="list-bullet"></span><strong>警告</strong>：<code>log.warning</code> 打印潜在问题或不规范使用</li>
<li data-line="29" dir="auto"><span class="list-bullet"></span><strong>错误</strong>：<code>log.error</code> 打印程序错误和异常情况</li>
</ul>
</li>
<li data-line="31" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>索敌与目标选择</strong></p>
<ul class="has-list-bullet">
<li data-line="32" dir="auto"><span class="list-bullet"></span><strong>范围索敌</strong>：<code>U.find_enemies_in_range</code></li>
<li data-line="33" dir="auto"><span class="list-bullet"></span><strong>首个敌人</strong>：<code>U.find_foremost_enemy</code></li>
<li data-line="34" dir="auto"><span class="list-bullet"></span><strong>过滤函数</strong>：可自定义条件筛选目标</li>
<li data-line="35" dir="auto"><span class="list-bullet"></span><strong>特殊筛选</strong>：如按血量排序找到最高血量目标</li>
</ul>
</li>
<li data-line="37" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>攻击条件控制</strong></p>
<ul class="has-list-bullet">
<li data-line="38" dir="auto"><span class="list-bullet"></span><strong>近战条件</strong>：<code>fn_can</code> 函数</li>
<li data-line="39" dir="auto"><span class="list-bullet"></span><strong>远程条件</strong>：<code>filter_fn</code> 函数</li>
<li data-line="40" dir="auto"><span class="list-bullet"></span><strong>释放概率</strong>：<code>fn_chance</code> 函数</li>
</ul>
</li>
<li data-line="42" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>扩展攻击与技能</strong></p>
<ul class="has-list-bullet">
<li data-line="43" dir="auto"><span class="list-bullet"></span><strong>新增攻击</strong>：使用 <code>table.deepclone</code> 复制攻击</li>
<li data-line="44" dir="auto"><span class="list-bullet"></span><strong>概率效果</strong>：设置 <code>chance</code> 和 <code>mod</code> 属性</li>
<li data-line="45" dir="auto"><span class="list-bullet"></span><strong>士兵新增远程攻击</strong>：需在更新函数中调用远程攻击 <code>y_soldier_ranged_attacks</code> 函数</li>
<li data-line="46" dir="auto"><span class="list-bullet"></span><strong>敌人新增远程攻击</strong>：需在逻辑循环中集成远程攻击检与 <code>y_enemy_range_attacks</code> 函数</li>
<li data-line="47" dir="auto"><span class="list-bullet"></span><strong>新增技能</strong>：在 <code>timed_attacks</code> 中添加，配合升级函数解锁</li>
<li data-line="48" dir="auto"><span class="list-bullet"></span><strong>闪避机制</strong>：<code>counter_attack</code> 和 <code>can_dodge</code> 函数</li>
</ul>
</li>
<li data-line="50" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>特殊机制实现</strong></p>
<ul class="has-list-bullet">
<li data-line="51" dir="auto"><span class="list-bullet"></span><strong>二阶段机制</strong>：通过状态标志和血量重置实现</li>
</ul>
</li>
<li data-line="53" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>架构与调用机制</strong></p>
<ul class="has-list-bullet">
<li data-line="54" dir="auto"><span class="list-bullet"></span><strong>ECS 架构</strong>：实体-组件-系统的分离设计</li>
<li data-line="55" dir="auto"><span class="list-bullet"></span><strong>调用链</strong>：Love2D → 游戏层 → 模拟器 → 实体函数</li>
<li data-line="56" dir="auto"><span class="list-bullet"></span><strong>协程管理</strong>：更新函数使用协程实现复杂逻辑控制</li>
</ul>
</li>
</ol></div><div class="el-h3"><h3 data-heading="检查清单" dir="auto" class="heading" id="检查清单_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>检查清单</h3></div><div class="el-p"><p dir="auto">（点击勾选框勾选）<br>
完成本章后，你应该能够：</p></div><div class="el-ul"><ul class="contains-task-list has-list-bullet">
<li data-line="0" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="0" type="checkbox" class="task-list-item-checkbox">理解插入、更新、升级三种实体函数的作用和调用时机</li>
<li data-line="1" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="1" type="checkbox" class="task-list-item-checkbox">在插入函数中实现伤害、效果、光环等基础功能</li>
<li data-line="2" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="2" type="checkbox" class="task-list-item-checkbox">使用 <code>store.tick_ts</code> 和 <code>a.ts</code> 计算时间和冷却</li>
<li data-line="3" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="3" type="checkbox" class="task-list-item-checkbox">使用日志库打印日志</li>
<li data-line="4" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="4" type="checkbox" class="task-list-item-checkbox">实现各种索敌逻辑和目标筛选</li>
<li data-line="5" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="5" type="checkbox" class="task-list-item-checkbox">为攻击添加释放条件和概率控制</li>
<li data-line="6" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="6" type="checkbox" class="task-list-item-checkbox">通过深拷贝和组件配置新增攻击和技能</li>
<li data-line="7" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="7" type="checkbox" class="task-list-item-checkbox">实现闪避和反击机制</li>
<li data-line="8" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="8" type="checkbox" class="task-list-item-checkbox">创建复杂的多阶段机制</li>
<li data-line="9" data-task="" class="task-list-item" dir="auto"><span class="list-bullet"></span><input data-line="9" type="checkbox" class="task-list-item-checkbox">理解实体函数的调用链和协程机制</li>
</ul></div><div class="el-h3"><h3 data-heading="思考题" dir="auto" class="heading" id="思考题_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>思考题</h3></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">为什么实体函数要分为插入、更新、升级三种类型？这种分离设计如何提高代码的可维护性和性能？</li>
<li data-line="1" dir="auto">如果要为一个英雄添加一个新的召唤技能，需要考虑哪些方面？</li>
<li data-line="2" dir="auto">ECS 架构如何支持游戏中复杂的行为组合？</li>
<li data-line="3" dir="auto">协程在游戏逻辑管理中有哪些优势和局限性？</li>
<li data-line="4" dir="auto">当多个实体需要共享某种行为时，如何设计避免代码重复？</li>
<li data-line="5" dir="auto">如何处理实体之间的复杂交互（如连锁反应）？</li>
</ol></div><div class="el-h3"><h3 data-heading="实战建议" dir="auto" class="heading" id="实战建议_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>实战建议</h3></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>代码复用</strong>：</p>
<ul class="has-list-bullet">
<li data-line="1" dir="auto"><span class="list-bullet"></span>观察现有英雄的实现，提取通用模式</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>创建可复用的辅助函数库</li>
</ul>
</li>
<li data-line="4" dir="auto"><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p><strong>文档习惯</strong>：</p>
<ul class="has-list-bullet">
<li data-line="5" dir="auto"><span class="list-bullet"></span>为自定义函数添加清晰文档注释</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span>记录重要的设计决策和实现细节</li>
</ul>
</li>
</ol></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto"><strong>下一章预告</strong>：在第 4 章中，我们将学习修改游戏的关卡，包括路径、网格、出怪等，为更复杂的修改做准备。</p></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3._实体函数_0" data-path="#3._实体函数_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3. 实体函数">3. 实体函数</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.1_插入函数_0" data-path="#3.1_插入函数_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.1 插入函数">3.1 插入函数</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.1.1_造成伤害_0" data-path="#3.1.1_造成伤害_0"><div class="tree-item-inner heading-link" heading-name="3.1.1 造成伤害">3.1.1 造成伤害</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.1.2_造成效果_0" data-path="#3.1.2_造成效果_0"><div class="tree-item-inner heading-link" heading-name="3.1.2 造成效果">3.1.2 造成效果</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.1.3_实体增加光环_0" data-path="#3.1.3_实体增加光环_0"><div class="tree-item-inner heading-link" heading-name="3.1.3 实体增加光环">3.1.3 实体增加光环</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.1.4_Ecreate_entity_-_创建实体_0" data-path="#3.1.4_Ecreate_entity_-_创建实体_0"><div class="tree-item-inner heading-link" heading-name="3.1.4 E:create_entity - 创建实体">3.1.4 E:create_entity - 创建实体</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.2_store_-_临时存储_0" data-path="#3.2_store_-_临时存储_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.2 store - 临时存储">3.2 store - 临时存储</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#实体存储位置_0" data-path="#实体存储位置_0"><div class="tree-item-inner heading-link" heading-name="实体存储位置">实体存储位置</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.3_升级函数_0" data-path="#3.3_升级函数_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.3 升级函数">3.3 升级函数</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.3.1_数据随等级而变化_0" data-path="#3.3.1_数据随等级而变化_0"><div class="tree-item-inner heading-link" heading-name="3.3.1 数据随等级而变化">3.3.1 数据随等级而变化</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.4_更新函数_0" data-path="#3.4_更新函数_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.4 更新函数">3.4 更新函数</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.4.1_技能造成效果_0" data-path="#3.4.1_技能造成效果_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.4.1 技能造成效果">3.4.1 技能造成效果</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_0" data-path="#示例_0"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.4.2_计算时间_0" data-path="#3.4.2_计算时间_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.4.2 计算时间">3.4.2 计算时间</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_1" data-path="#示例_1"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.5_谁在调用插入与更新函数_0" data-path="#3.5_谁在调用插入与更新函数_0"><div class="tree-item-inner heading-link" heading-name="3.5 谁在调用插入与更新函数">3.5 谁在调用插入与更新函数</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.6_打印日志_0" data-path="#3.6_打印日志_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.6 打印日志">3.6 打印日志</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.6.1_六级日志系统_0" data-path="#3.6.1_六级日志系统_0"><div class="tree-item-inner heading-link" heading-name="3.6.1 六级日志系统">3.6.1 六级日志系统</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.6.2_函数_0" data-path="#3.6.2_函数_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.6.2 函数">3.6.2 函数</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#1._创建新日志实例_0" data-path="#1._创建新日志实例_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="1. 创建新日志实例">1. 创建新日志实例</div></a><div class="tree-item-children"><div class="tree-item" data-depth="5"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_2" data-path="#示例_2"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#2._偏执级调试（6_级）_0" data-path="#2._偏执级调试（6_级）_0"><div class="tree-item-inner heading-link" heading-name="2. 偏执级调试（6 级）">2. 偏执级调试（6 级）</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3._调试信息（5_级）_0" data-path="#3._调试信息（5_级）_0"><div class="tree-item-inner heading-link" heading-name="3. 调试信息（5 级）">3. 调试信息（5 级）</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#4._待办事项（4_级）_0" data-path="#4._待办事项（4_级）_0"><div class="tree-item-inner heading-link" heading-name="4. 待办事项（4 级）">4. 待办事项（4 级）</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#5._常规信息（3_级）_0" data-path="#5._常规信息（3_级）_0"><div class="tree-item-inner heading-link" heading-name="5. 常规信息（3 级）">5. 常规信息（3 级）</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#6._警告信息（2_级）_0" data-path="#6._警告信息（2_级）_0"><div class="tree-item-inner heading-link" heading-name="6. 警告信息（2 级）">6. 警告信息（2 级）</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#7._错误信息（1_级）_0" data-path="#7._错误信息（1_级）_0"><div class="tree-item-inner heading-link" heading-name="7. 错误信息（1 级）">7. 错误信息（1 级）</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.6.3_实用技巧_0" data-path="#3.6.3_实用技巧_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.6.3 实用技巧">3.6.3 实用技巧</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#1._格式化输出_0" data-path="#1._格式化输出_0"><div class="tree-item-inner heading-link" heading-name="1. 格式化输出">1. 格式化输出</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#2._条件日志_0" data-path="#2._条件日志_0"><div class="tree-item-inner heading-link" heading-name="2. 条件日志">2. 条件日志</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.6.4_调试工作流示例_0" data-path="#3.6.4_调试工作流示例_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.6.4 调试工作流示例">3.6.4 调试工作流示例</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#1._新功能开发_0" data-path="#1._新功能开发_0"><div class="tree-item-inner heading-link" heading-name="1. 新功能开发">1. 新功能开发</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#2._问题排查_0" data-path="#2._问题排查_0"><div class="tree-item-inner heading-link" heading-name="2. 问题排查">2. 问题排查</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3._性能分析_0" data-path="#3._性能分析_0"><div class="tree-item-inner heading-link" heading-name="3. 性能分析">3. 性能分析</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.6.5_更多日志库函数见_[[12._库#日志库]]_0" data-path="#3.6.5_更多日志库函数见_[[12._库#日志库]]_0"><div class="tree-item-inner heading-link" heading-name="3.6.5 更多日志库函数见 [[12. 库#日志库]]">3.6.5 更多日志库函数见 <span>12. 库 &gt; 日志库</span></div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.7_索敌_0" data-path="#3.7_索敌_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.7 索敌">3.7 索敌</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.7.1_基础索敌_0" data-path="#3.7.1_基础索敌_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.7.1 基础索敌">3.7.1 基础索敌</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#1._搜索范围内所有敌人_0" data-path="#1._搜索范围内所有敌人_0"><div class="tree-item-inner heading-link" heading-name="1. 搜索范围内所有敌人">1. 搜索范围内所有敌人</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#2._搜索首个敌人_0" data-path="#2._搜索首个敌人_0"><div class="tree-item-inner heading-link" heading-name="2. 搜索首个敌人">2. 搜索首个敌人</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.7.2_过滤函数_0" data-path="#3.7.2_过滤函数_0"><div class="tree-item-inner heading-link" heading-name="3.7.2 过滤函数">3.7.2 过滤函数</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.7.3_寻找血量最高的敌人_0" data-path="#3.7.3_寻找血量最高的敌人_0"><div class="tree-item-inner heading-link" heading-name="3.7.3 寻找血量最高的敌人">3.7.3 寻找血量最高的敌人</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.8_实体攻击增加条件_0" data-path="#3.8_实体攻击增加条件_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.8 实体攻击增加条件">3.8 实体攻击增加条件</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.8.1_近战攻击条件_0" data-path="#3.8.1_近战攻击条件_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.8.1 近战攻击条件">3.8.1 近战攻击条件</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_3" data-path="#示例_3"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.8.2_远程攻击条件_0" data-path="#3.8.2_远程攻击条件_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.8.2 远程攻击条件">3.8.2 远程攻击条件</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_4" data-path="#示例_4"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.8.3_释放概率根据条件而变化_0" data-path="#3.8.3_释放概率根据条件而变化_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.8.3 释放概率根据条件而变化">3.8.3 释放概率根据条件而变化</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_5" data-path="#示例_5"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.8.4_判断是否拥有状态效果_0" data-path="#3.8.4_判断是否拥有状态效果_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.8.4 判断是否拥有状态效果">3.8.4 判断是否拥有状态效果</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#1._判断拥有单个效果_0" data-path="#1._判断拥有单个效果_0"><div class="tree-item-inner heading-link" heading-name="1. 判断拥有单个效果">1. 判断拥有单个效果</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#2._判断拥有效果类型_0" data-path="#2._判断拥有效果类型_0"><div class="tree-item-inner heading-link" heading-name="2. 判断拥有效果类型">2. 判断拥有效果类型</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9_增加新攻击与技能_0" data-path="#3.9_增加新攻击与技能_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9 增加新攻击与技能">3.9 增加新攻击与技能</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9.1_攻击概率造成效果_0" data-path="#3.9.1_攻击概率造成效果_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9.1 攻击概率造成效果">3.9.1 攻击概率造成效果</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_6" data-path="#示例_6"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9.2_防御塔攻击概率造成效果_0" data-path="#3.9.2_防御塔攻击概率造成效果_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9.2 防御塔攻击概率造成效果">3.9.2 防御塔攻击概率造成效果</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_7" data-path="#示例_7"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9.3_增加远程攻击_0" data-path="#3.9.3_增加远程攻击_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9.3 增加远程攻击">3.9.3 增加远程攻击</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#1._士兵_0" data-path="#1._士兵_0"><div class="tree-item-inner heading-link" heading-name="1. 士兵">1. 士兵</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#2._敌人_0" data-path="#2._敌人_0"><div class="tree-item-inner heading-link" heading-name="2. 敌人">2. 敌人</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9.4_增加新技能_0" data-path="#3.9.4_增加新技能_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9.4 增加新技能">3.9.4 增加新技能</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_8" data-path="#示例_8"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9.5_闪避反击_0" data-path="#3.9.5_闪避反击_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9.5 闪避反击">3.9.5 闪避反击</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_9" data-path="#示例_9"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9.6_闪避条件_0" data-path="#3.9.6_闪避条件_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9.6 闪避条件">3.9.6 闪避条件</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#示例_10" data-path="#示例_10"><div class="tree-item-inner heading-link" heading-name="示例">示例</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.9.7_攻击优先级_0" data-path="#3.9.7_攻击优先级_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.9.7 攻击优先级">3.9.7 攻击优先级</div></a><div class="tree-item-children"><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#排序方法_0" data-path="#排序方法_0"><div class="tree-item-inner heading-link" heading-name="排序方法">排序方法</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#手动指定优先级_0" data-path="#手动指定优先级_0"><div class="tree-item-inner heading-link" heading-name="手动指定优先级">手动指定优先级</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.10_特殊效果_0" data-path="#3.10_特殊效果_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.10 特殊效果">3.10 特殊效果</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#3.10.1_增加二阶段_0" data-path="#3.10.1_增加二阶段_0"><div class="tree-item-inner heading-link" heading-name="3.10.1 增加二阶段">3.10.1 增加二阶段</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.11_练习_0" data-path="#3.11_练习_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.11 练习">3.11 练习</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#练习_1：了解驱动函数逻辑_0" data-path="#练习_1：了解驱动函数逻辑_0"><div class="tree-item-inner heading-link" heading-name="练习 1：了解驱动函数逻辑">练习 1：了解驱动函数逻辑</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#练习_2：日志与调试实践_0" data-path="#练习_2：日志与调试实践_0"><div class="tree-item-inner heading-link" heading-name="练习 2：日志与调试实践">练习 2：日志与调试实践</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-2-节-修改基础/3.-实体函数.html#3.12_本章总结_0" data-path="#3.12_本章总结_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3.12 本章总结">3.12 本章总结</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#关键知识点回顾_0" data-path="#关键知识点回顾_0"><div class="tree-item-inner heading-link" heading-name="关键知识点回顾">关键知识点回顾</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#检查清单_0" data-path="#检查清单_0"><div class="tree-item-inner heading-link" heading-name="检查清单">检查清单</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#思考题_0" data-path="#思考题_0"><div class="tree-item-inner heading-link" heading-name="思考题">思考题</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-2-节-修改基础/3.-实体函数.html#实战建议_0" data-path="#实战建议_0"><div class="tree-item-inner heading-link" heading-name="实战建议">实战建议</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>