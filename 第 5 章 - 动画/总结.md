# (一) 逻辑
## 一、插入逻辑
1. 插入实体时调用 `sys.render:on_insert` 函数初始化 `frames`
	1. 遍历实体的所有精灵
	2. 初始化各种参数，位置、透明度、旋转等
	3. 同时增加到实体 `render.frames` 与 `store.render_frames` 内
	4. 初始化血条 `fk`、`fb`、`ff` 增加到实体 `health_bar.frames` 与 `store.render_frames` 内
		1. **`fk`** = Foreground Black (黑色条)
		2. **`fb`** = Foreground Background (背景条)
		3. **`ff`** = Foreground Foreground (前景条）

## 二、更新逻辑
1. 遍历所有具有 `render` 键的实体的 `render.sprites` 精灵
	1. 若精灵 `animated` 键为 `true`，调用 `animation_db:fn` 通过前缀与精灵名称搜索动画
		1. 在 `animation_db.db` 索引前缀与精灵名称拼接的字符串得到动画
		2. 调用 `animation_db:fni` 函数得到要播放的动画帧
			1. 调用 `animation_db:expand_frames` 根据动画 `from` 与 `to` 键得到动画总帧数
			2. 通过时间戳与动画 `fps` 键计算将要播放的动画帧
			3. 将动画前缀与将要播放的动画帧拼接为字符串作为具体帧并返回
	2. 若精灵 `animation` 键为 `true` 直接调用 `animation_db:fni` 跳过通过精灵名称搜索动画
	3. 若精灵 `exo` 键为 `true` 调用 `exoskeleton:f` 函数加载骨骼动画并存入精灵 `exo` 键
	4. 调用 `image_db:s` 函数根据具体帧加载对应图像，并存入精灵 `ss` 键
	5. 根据实体血量设置 `health_bar.frames` 缩放与隐藏血条不同部分
2. 排序 `store.render_frames`
    1. 首先按图层排序，图层升序排序
    2. 相同图层时，按 `y` 轴排序升序
    3. 相同图层与 `y` 轴时，按 `draw_order` 升序排序
    4. 所有其他条件都相同时，按 `x` 轴升序排序
3. 在 `game.draw_game` 函数调用 `render_utils.draw_frames_range` 函数绘制图像

## 三、补间动画
1. 实体插入时调用 `sys.tween:on_insert` 函数读取实体 `tween.props` 属性键
2. 调用 `sys.tween:on_update` 函数更新补间动画，根据关键帧进行插值计算
	1. 遍历所有具有 `tween` 键的实体的 `tween.props`
	2. 根据 `sprite_id` 对相应精灵的 `props.name` 指定的键进行插值计算