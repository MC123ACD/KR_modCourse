<!DOCTYPE html> <html lang="zh-cn"><head>
<title>参考答案</title>
<base href="..">
<meta name="pathname" content="第-1-节-语法/参考答案.html">
<meta name="description" content="王国保卫战修改教程 - 参考答案">
<meta property="og:title" content="参考答案">
<meta property="og:description" content="王国保卫战修改教程 - 参考答案">
<meta property="og:type" content="website">
<meta property="og:url" content="第-1-节-语法/参考答案.html">
<meta property="og:image" content="undefined">
<meta charset="UTF-8"><meta property="og:site_name" content="王国保卫战修改教程"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="preload" href="site-lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/snippets.css"></noscript><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="site-lib/styles/theme.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/supported-plugins.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager mod-windows is-frameless is-hidden-frameless styled-scrollbars show-inline-title show-ribbon background-settings-workplace-theme-dark-in-the-sky background-image-settings-markdown-page-custom notebook-liked-markdown-page-grid-notebook-1 panel-page-bg-theme-light-custom panel-page-bg-theme-dark-plant hide-left-ribbon-retention-drawer toggle-divider-lines toggle-header-bottom-line bt-bubble-layout bt-bubble-layout-hide-borders remove-heading-indicator h1-toggle-underline toggle-left-aligned-content fancy-hr-no-icon custom-unordered-list custom-ordered-list list-no-border folder-icons bt-toggle-colorful-folder folder-style-change-options-colorful-default folder-colorful-one table-width-auto table-style-two link-underline-internal enable-alternative-checkboxes default-loading-page loading-text-typing-style rainbow-tag translucent-setting-panel underline-tab-style canvas-card-text-middle admonition-bg-color-same toggle-calendar-shadow style-options-for-buttons-plugin dataview-list-style-pacman memos-banner-gradient thino-frosted-style thino-background-default quiet-outline-optimize code-theme-sublime is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event allow-fold-headings show-indentation-guide show-properties is-readable-line-width" data-type="markdown"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="参考答案_0">参考答案</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-h2"><h2 data-heading="**本篇为所有练习的参考答案，下滑查看**" dir="auto" class="heading" id="**本篇为所有练习的参考答案，下滑查看**_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>本篇为所有练习的参考答案，下滑查看</strong></h2></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span></li>
<li data-line="1" dir="auto"><span class="list-bullet"></span></li>
<li data-line="2" dir="auto"><span class="list-bullet"></span></li>
<li data-line="3" dir="auto"><span class="list-bullet"></span></li>
<li data-line="4" dir="auto"><span class="list-bullet"></span></li>
<li data-line="5" dir="auto"><span class="list-bullet"></span></li>
<li data-line="6" dir="auto"><span class="list-bullet"></span></li>
<li data-line="7" dir="auto"><span class="list-bullet"></span></li>
<li data-line="8" dir="auto"><span class="list-bullet"></span></li>
<li data-line="9" dir="auto"><span class="list-bullet"></span></li>
<li data-line="10" dir="auto"><span class="list-bullet"></span></li>
<li data-line="11" dir="auto"><span class="list-bullet"></span></li>
<li data-line="12" dir="auto"><span class="list-bullet"></span></li>
<li data-line="13" dir="auto"><span class="list-bullet"></span></li>
<li data-line="14" dir="auto"><span class="list-bullet"></span></li>
<li data-line="15" dir="auto"><span class="list-bullet"></span></li>
<li data-line="16" dir="auto"><span class="list-bullet"></span></li>
<li data-line="17" dir="auto"><span class="list-bullet"></span></li>
<li data-line="18" dir="auto"><span class="list-bullet"></span></li>
<li data-line="19" dir="auto"><span class="list-bullet"></span></li>
<li data-line="20" dir="auto"><span class="list-bullet"></span></li>
<li data-line="21" dir="auto"><span class="list-bullet"></span></li>
</ul></div><div class="el-h3"><h3 data-heading="**练习 2.2**：判断以下哪些是合法的标识符：" dir="auto" class="heading" id="**练习_2.2**：判断以下哪些是合法的标识符：_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>练习 2.2</strong>：判断以下哪些是合法的标识符：</h3></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>playerName</code> ✓</li>
<li data-line="1" dir="auto"><code>2ndPlayer</code> ✗（以数字开头）</li>
<li data-line="2" dir="auto"><code>player_score</code> ✓</li>
<li data-line="3" dir="auto"><code>local</code> ✗（关键字）</li>
<li data-line="4" dir="auto"><code>_internal</code> ✓</li>
<li data-line="5" dir="auto"><code>my-var</code> ✗（包含连字符）</li>
<li data-line="6" dir="auto"><code>玩家1</code> ✗（中文）</li>
</ol></div><div class="el-h3"><h3 data-heading="练习 2.3：创建一个自我介绍程序" dir="auto" class="heading" id="练习_2.3：创建一个自我介绍程序_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 2.3：创建一个自我介绍程序</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 基本信息</span>
<span class="token keyword">local</span> name <span class="token operator">=</span> <span class="token string">"张三"</span>
<span class="token keyword">local</span> age <span class="token operator">=</span> <span class="token number">25</span>
<span class="token keyword">local</span> interests <span class="token operator">=</span> <span class="token string">"编程、游戏、阅读"</span>
<span class="token keyword">local</span> goal <span class="token operator">=</span> <span class="token string">"掌握Lua编程，开发自己的小游戏"</span>

<span class="token comment">-- 输出信息</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"姓名: "</span> <span class="token operator">..</span> name<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"年龄: "</span> <span class="token operator">..</span> age <span class="token operator">..</span> <span class="token string">"岁"</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"兴趣爱好: "</span> <span class="token operator">..</span> interests<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"学习目标: "</span> <span class="token operator">..</span> goal<span class="token punctuation">)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 3.1：数据类型识别" dir="auto" class="heading" id="练习_3.1：数据类型识别_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 3.1：数据类型识别</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">describe_value</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">local</span> description
    
    <span class="token keyword">if</span> t <span class="token operator">==</span> <span class="token string">"nil"</span> <span class="token keyword">then</span>
        description <span class="token operator">=</span> <span class="token string">"空值"</span>
    <span class="token keyword">elseif</span> t <span class="token operator">==</span> <span class="token string">"boolean"</span> <span class="token keyword">then</span>
        description <span class="token operator">=</span> <span class="token string">"布尔值"</span>
    <span class="token keyword">elseif</span> t <span class="token operator">==</span> <span class="token string">"number"</span> <span class="token keyword">then</span>
        description <span class="token operator">=</span> <span class="token string">"数字"</span>
    <span class="token keyword">elseif</span> t <span class="token operator">==</span> <span class="token string">"string"</span> <span class="token keyword">then</span>
        description <span class="token operator">=</span> <span class="token string">"字符串"</span>
    <span class="token keyword">elseif</span> t <span class="token operator">==</span> <span class="token string">"table"</span> <span class="token keyword">then</span>
        description <span class="token operator">=</span> <span class="token string">"表"</span>
    <span class="token keyword">elseif</span> t <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token keyword">then</span>
        description <span class="token operator">=</span> <span class="token string">"函数"</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试输出</span>
<span class="token function">describe_value</span><span class="token punctuation">(</span><span class="token keyword">nil</span><span class="token punctuation">)</span>				<span class="token comment">-- 输出 空值</span>
<span class="token function">describe_value</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>			<span class="token comment">-- 输出 布尔值</span>
<span class="token function">describe_value</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>				<span class="token comment">-- 输出 数字</span>
<span class="token function">describe_value</span><span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span>		<span class="token comment">-- 输出 字符串</span>
<span class="token function">describe_value</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>		<span class="token comment">-- 输出 表</span>
<span class="token function">describe_value</span><span class="token punctuation">(</span>describe_value<span class="token punctuation">)</span>	<span class="token comment">-- 输出 函数</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 4.1：简单计算器" dir="auto" class="heading" id="练习_4.1：简单计算器_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 4.1：简单计算器</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> operator <span class="token operator">=</span> <span class="token string">"+"</span>	<span class="token comment">-- 模拟用户输入</span>
<span class="token keyword">local</span> a <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">local</span> b <span class="token operator">=</span> <span class="token number">3</span>

<span class="token keyword">if</span> operator <span class="token operator">==</span> <span class="token string">"+"</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>
<span class="token keyword">elseif</span> operator <span class="token operator">==</span> <span class="token string">"-"</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span>
<span class="token keyword">elseif</span> operator <span class="token operator">==</span> <span class="token string">"*"</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a <span class="token operator">*</span> b<span class="token punctuation">)</span>
<span class="token keyword">elseif</span> operator <span class="token operator">==</span> <span class="token string">"/"</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>
<span class="token keyword">elseif</span> operator <span class="token operator">==</span> <span class="token string">"%"</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a <span class="token operator">%</span> b<span class="token punctuation">)</span>
<span class="token keyword">elseif</span> operator <span class="token operator">==</span> <span class="token string">"^"</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 5.1：猜数字游戏" dir="auto" class="heading" id="练习_5.1：猜数字游戏_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 5.1：猜数字游戏</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"我已经想好了一个1-100之间的数字"</span><span class="token punctuation">)</span>

<span class="token comment">-- 生成随机数</span>
math<span class="token punctuation">.</span><span class="token function">randomseed</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">-- 设置随机种子</span>
<span class="token keyword">local</span> random_number <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> guess_count <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">local</span> max_guesses <span class="token operator">=</span> <span class="token number">4</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"你有"</span> <span class="token operator">..</span> max_guesses <span class="token operator">..</span> <span class="token string">"次机会猜中这个数字"</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> guess_count <span class="token operator">&lt;</span> max_guesses <span class="token keyword">do</span>
    guess_count <span class="token operator">=</span> guess_count <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">local</span> remaining_guesses <span class="token operator">=</span> max_guesses <span class="token operator">-</span> guess_count <span class="token operator">+</span> <span class="token number">1</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n第"</span> <span class="token operator">..</span> guess_count <span class="token operator">..</span> <span class="token string">"次尝试，还剩"</span> <span class="token operator">..</span> remaining_guesses <span class="token operator">..</span> <span class="token string">"次机会"</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"请输入你的猜测（1-100）:"</span><span class="token punctuation">)</span>
    
    <span class="token comment">-- 模拟用户输入</span>
    <span class="token keyword">local</span> guess
    <span class="token keyword">if</span> guess_count <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span>
        guess <span class="token operator">=</span> <span class="token number">50</span>  <span class="token comment">-- 第一次猜50</span>
    <span class="token keyword">elseif</span> guess_count <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">then</span>
        guess <span class="token operator">=</span> <span class="token number">25</span>  <span class="token comment">-- 第二次猜25</span>
    <span class="token keyword">else</span>
        guess <span class="token operator">=</span> secret_number  <span class="token comment">-- 第三次猜中</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"你猜的是："</span> <span class="token operator">..</span> guess<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> guess <span class="token operator">&lt;</span> secret_number <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"太小了！"</span><span class="token punctuation">)</span>
    <span class="token keyword">elseif</span> guess <span class="token operator">&gt;</span> secret_number <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"太大了！"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"恭喜你！猜对了！"</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"你用了"</span> <span class="token operator">..</span> guess_count <span class="token operator">..</span> <span class="token string">"次猜中数字"</span> <span class="token operator">..</span> secret_number<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">if</span> guess_count <span class="token operator">==</span> max_guesses <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n很遗憾，你没有在"</span> <span class="token operator">..</span> max_guesses <span class="token operator">..</span> <span class="token string">"次内猜中"</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正确答案是："</span> <span class="token operator">..</span> secret_number<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"游戏结束"</span><span class="token punctuation">)</span>
<span class="token comment">--[[ 输出
我已经想好了一个1-100之间的数字
你有4次机会猜中这个数字

第1次尝试，还剩10次机会
请输入你的猜测（1-100）:
你猜的是：50
太大了！

第2次尝试，还剩9次机会
请输入你的猜测（1-100）:
你猜的是：25
太小了！

第3次尝试，还剩8次机会
请输入你的猜测（1-100）:
你猜的是：26
恭喜你！猜对了！
你用了3次猜中数字26
游戏结束
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 5.2：打印图形" dir="auto" class="heading" id="练习_5.2：打印图形_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 5.2：打印图形</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 1. 打印直角三角形</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 直角三角形:"</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> height <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> height <span class="token keyword">do</span>
    <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> i <span class="token keyword">do</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"* "</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 2. 打印倒直角三角形</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n2. 倒直角三角形:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
    <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> i <span class="token keyword">do</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"* "</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 3. 打印等腰三角形</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n3. 等腰三角形:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> height <span class="token keyword">do</span>
    <span class="token comment">-- 打印空格</span>
    <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> height <span class="token operator">-</span> i <span class="token keyword">do</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token comment">-- 打印星号</span>
    <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">do</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 4. 打印空心菱形</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n4. 空心菱形:"</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> diamond_height <span class="token operator">=</span> <span class="token number">8</span>
<span class="token keyword">local</span> half <span class="token operator">=</span> diamond_height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span>

<span class="token comment">-- 上半部分</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> half <span class="token keyword">do</span>
    <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> half <span class="token operator">-</span> i <span class="token keyword">do</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> i <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">-</span> <span class="token number">3</span> <span class="token keyword">do</span>
            io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 下半部分</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> half <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
    <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> half <span class="token operator">-</span> i <span class="token keyword">do</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> i <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">-</span> <span class="token number">3</span> <span class="token keyword">do</span>
            io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token comment">--[[ 输出
1. 直角三角形:
* 
* * 
* * * 
* * * * 
* * * * * 

2. 倒直角三角形:
* * * * * 
* * * * 
* * * 
* * 
* 

3. 等腰三角形:
    *
   ***
  *****
 *******
*********

4. 空心菱形:
    *
   * *
  *   *
 *     *
*       *
 *     *
  *   *
   * *
    *
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 6.1：简单的计算器函数库" dir="auto" class="heading" id="练习_6.1：简单的计算器函数库_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 6.1：简单的计算器函数库</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 加法</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token keyword">end</span>

<span class="token comment">-- 减法</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">subtract</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b
<span class="token keyword">end</span>

<span class="token comment">-- 乘法</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> a <span class="token operator">*</span> b
<span class="token keyword">end</span>

<span class="token comment">-- 除法（带错误检查）</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> <span class="token string">"除数不能为 0"</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">return</span> a <span class="token operator">/</span> b
<span class="token keyword">end</span>

<span class="token comment">-- 平均值</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> sum <span class="token operator">=</span> <span class="token number">0</span>
    
    <span class="token keyword">for</span> _<span class="token punctuation">,</span> num <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span> <span class="token keyword">do</span>
        sum <span class="token operator">=</span> sum <span class="token operator">+</span> num
    <span class="token keyword">end</span>
    
    <span class="token keyword">return</span> sum <span class="token operator">/</span> <span class="token operator">#</span>numbers
<span class="token keyword">end</span>

<span class="token comment">-- 使用函数库</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"5 + 3 = "</span> <span class="token operator">..</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"10 - 4 = "</span> <span class="token operator">..</span> <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"6 * 7 = "</span> <span class="token operator">..</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">local</span> result<span class="token punctuation">,</span> error_msg <span class="token operator">=</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> error_msg <span class="token keyword">then</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"错误: "</span> <span class="token operator">..</span> error_msg<span class="token punctuation">)</span>
<span class="token keyword">else</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"10 / 2 = "</span> <span class="token operator">..</span> result<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"平均值(1,2,3,4,5) = "</span> <span class="token operator">..</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">--[[ 输出
5 + 3 = 8
10 - 4 = 6
6 * 7 = 42
错误: 除数不能为 0
平均值(1,2,3,4,5) = 3
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 6.2：提取函数，优化代码" dir="auto" class="heading" id="练习_6.2：提取函数，优化代码_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 6.2：提取函数，优化代码</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 模拟购买的物品</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">get_cart_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">"苹果"</span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> quantity <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">"香蕉"</span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> quantity <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">"橙子"</span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> quantity <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">"葡萄"</span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> quantity <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">end</span>

<span class="token comment">-- 打印商品详细信息</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">print_item_info</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"=== 商品详情 ==="</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> _<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token keyword">local</span> item_total <span class="token operator">=</span> item<span class="token punctuation">.</span>price <span class="token operator">*</span> item<span class="token punctuation">.</span>quantity

        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"商品: "</span> <span class="token operator">..</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"单价: "</span> <span class="token operator">..</span> item<span class="token punctuation">.</span>price <span class="token operator">..</span> <span class="token string">"元"</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"数量: "</span> <span class="token operator">..</span> item<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"小计: "</span> <span class="token operator">..</span> item_total <span class="token operator">..</span> <span class="token string">"元"</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"------------"</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 计算购物车总价</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">calculate_cart_info</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span>
    <span class="token keyword">local</span> total_price<span class="token punctuation">,</span> total_quantity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>

    <span class="token keyword">for</span> _<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span> <span class="token keyword">do</span>
        total_price <span class="token operator">=</span> total_price <span class="token operator">+</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>price <span class="token operator">*</span> item<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span>
        total_quantity <span class="token operator">=</span> total_quantity <span class="token operator">+</span> item<span class="token punctuation">.</span>quantity
    <span class="token keyword">end</span>

    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"购物车总价: "</span> <span class="token operator">..</span> total_price <span class="token operator">..</span> <span class="token string">"元"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> total_price<span class="token punctuation">,</span> total_quantity
<span class="token keyword">end</span>

<span class="token comment">-- 判断是否有优惠（满50减10，满100减25，买10个赠1个）</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">check_discount</span><span class="token punctuation">(</span>total_price<span class="token punctuation">,</span> total_quantity<span class="token punctuation">)</span>
    <span class="token keyword">if</span> total_price <span class="token operator">&lt;</span> <span class="token number">50</span> <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"未满50元，无优惠"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> total_quantity <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"购物车物品总数："</span> <span class="token operator">..</span> total_quantity <span class="token operator">..</span> <span class="token string">"个，赠品1个"</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> discount_price <span class="token operator">=</span> total_price

    <span class="token keyword">if</span> total_price <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token keyword">then</span>
        discount_price <span class="token operator">=</span> total_price <span class="token operator">-</span> <span class="token number">25</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"符合优惠条件，满100减25"</span><span class="token punctuation">)</span>
    <span class="token keyword">elseif</span> total_price <span class="token operator">&gt;=</span> <span class="token number">50</span> <span class="token keyword">then</span>
        discount_price <span class="token operator">=</span> total_price <span class="token operator">-</span> <span class="token number">10</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"符合优惠条件，满50减10"</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"优惠后价格: "</span> <span class="token operator">..</span> discount_price <span class="token operator">..</span> <span class="token string">"元"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">rec_item</span><span class="token punctuation">(</span>recommendations<span class="token punctuation">)</span>
    <span class="token keyword">for</span> _<span class="token punctuation">,</span> rec <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>recommendations<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token keyword">local</span> rec_total <span class="token operator">=</span> rec<span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token number">1</span> <span class="token comment">-- 假设推荐买1个</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  "</span> <span class="token operator">..</span> rec<span class="token punctuation">.</span>name <span class="token operator">..</span> <span class="token string">": "</span> <span class="token operator">..</span> rec<span class="token punctuation">.</span>price <span class="token operator">..</span> <span class="token string">"元/个"</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 根据购物车推荐相关商品</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">recommendations_item</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n=== 推荐商品 ==="</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> recommendations <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">"梨子"</span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">"芒果"</span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">10</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> _<span class="token punctuation">,</span> cart_item <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> cart_item<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"苹果"</span> <span class="token keyword">then</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"您购买了苹果，可能也喜欢:"</span><span class="token punctuation">)</span>
            <span class="token function">rec_item</span><span class="token punctuation">(</span>recommendations<span class="token punctuation">)</span>
        <span class="token keyword">elseif</span> cart_item<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"香蕉"</span> <span class="token keyword">then</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"您购买了香蕉，可能也喜欢:"</span><span class="token punctuation">)</span>
            <span class="token function">rec_item</span><span class="token punctuation">(</span>recommendations<span class="token punctuation">)</span>
        <span class="token keyword">elseif</span> cart_item<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"橙子"</span> <span class="token keyword">then</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"您购买了橙子，可能也喜欢:"</span><span class="token punctuation">)</span>
            <span class="token function">rec_item</span><span class="token punctuation">(</span>recommendations<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 主程序</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">-- 获取购物车物品</span>
    <span class="token keyword">local</span> cart <span class="token operator">=</span> <span class="token function">get_cart_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">-- 打印商品信息</span>
    <span class="token function">print_item_info</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span>

    <span class="token comment">-- 计算总价和总数量</span>
    <span class="token keyword">local</span> total_price<span class="token punctuation">,</span> total_quantity <span class="token operator">=</span> <span class="token function">calculate_cart_info</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span>

    <span class="token comment">-- 检查优惠</span>
    <span class="token function">check_discount</span><span class="token punctuation">(</span>total_price<span class="token punctuation">,</span> total_quantity<span class="token punctuation">)</span>

    <span class="token comment">-- 推荐相关商品</span>
    <span class="token function">recommendations_item</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 运行主程序</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">--[[ 输出
=== 商品详情 ===
商品: 苹果
单价: 5元
数量: 3
小计: 15元
------------
商品: 香蕉
单价: 3元
数量: 2
小计: 6元
------------
商品: 橙子
单价: 6元
数量: 4
小计: 24元
------------
商品: 葡萄
单价: 8元
数量: 1
小计: 8元
------------
购物车总价: 53元
购物车物品总数：10个，赠品1个
符合优惠条件，满50减10
优惠后价格: 43元

=== 推荐商品 ===
您购买了苹果，可能也喜欢:
  梨子: 6元/个
  芒果: 10元/个
您购买了香蕉，可能也喜欢:
  梨子: 6元/个
  芒果: 10元/个
您购买了橙子，可能也喜欢:
  梨子: 6元/个
  芒果: 10元/个
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 7.1：简单的联系人管理系统" dir="auto" class="heading" id="练习_7.1：简单的联系人管理系统_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 7.1：简单的联系人管理系统</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> contacts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">add_contact</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">)</span>
    <span class="token keyword">if</span> contacts<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"联系人 "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">" 已存在"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">false</span>
    <span class="token keyword">end</span>
    
    contacts<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        phone <span class="token operator">=</span> phone<span class="token punctuation">,</span>
        email <span class="token operator">=</span> email <span class="token keyword">or</span> <span class="token string">""</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"已添加联系人: "</span> <span class="token operator">..</span> name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">true</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">find_contact</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">local</span> contact <span class="token operator">=</span> contacts<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> contact <span class="token keyword">then</span>
    	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"未找到联系人: "</span> <span class="token operator">..</span> name<span class="token punctuation">)</span>
    	
        <span class="token keyword">return</span> <span class="token keyword">nil</span>
    <span class="token keyword">end</span>
    
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"找到联系人 "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">":"</span><span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  电话: "</span> <span class="token operator">..</span> contact<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  邮箱: "</span> <span class="token operator">..</span> <span class="token punctuation">(</span>contact<span class="token punctuation">.</span>email <span class="token operator">~=</span> <span class="token string">""</span> <span class="token keyword">and</span> contact<span class="token punctuation">.</span>email <span class="token keyword">or</span> <span class="token string">"无"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> contact
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">list_contacts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">#</span>contacts <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"通讯录为空"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"=== 通讯录 ==="</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> count <span class="token operator">=</span> <span class="token number">0</span>
    
    <span class="token keyword">for</span> name<span class="token punctuation">,</span> info <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>contacts<span class="token punctuation">)</span> <span class="token keyword">do</span>
        count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token function">print</span><span class="token punctuation">(</span>count <span class="token operator">..</span> <span class="token string">". "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">" - "</span> <span class="token operator">..</span> info<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"总计: "</span> <span class="token operator">..</span> count <span class="token operator">..</span> <span class="token string">" 个联系人"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">remove_contact</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> contacts<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"联系人不存在: "</span> <span class="token operator">..</span> name<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">false</span>
    <span class="token keyword">end</span>

	contacts<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"已删除联系人: "</span> <span class="token operator">..</span> name<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token keyword">true</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试联系人管理系统</span>
<span class="token function">add_contact</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"13800138000"</span><span class="token punctuation">,</span> <span class="token string">"zhangsan@email.com"</span><span class="token punctuation">)</span>
<span class="token function">add_contact</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span> <span class="token string">"13900139000"</span><span class="token punctuation">)</span>
<span class="token function">add_contact</span><span class="token punctuation">(</span><span class="token string">"王五"</span><span class="token punctuation">,</span> <span class="token string">"13700137000"</span><span class="token punctuation">,</span> <span class="token string">"wangwu@company.com"</span><span class="token punctuation">)</span>

<span class="token function">list_contacts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">find_contact</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span>
<span class="token function">find_contact</span><span class="token punctuation">(</span><span class="token string">"赵六"</span><span class="token punctuation">)</span>

<span class="token function">remove_contact</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span>
<span class="token function">list_contacts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">--[[ 输出
=== 联系人管理系统 ===
已添加联系人: 张三
已添加联系人: 李四
已添加联系人: 王五
通讯录为空
找到联系人 张三:
  电话: 17300138000
  邮箱: zhangsan@email.com
未找到联系人: 赵六
已删除联系人: 李四
通讯录为空
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 7.2：购物车系统" dir="auto" class="heading" id="练习_7.2：购物车系统_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 7.2：购物车系统</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> shopping_cart <span class="token operator">=</span> <span class="token punctuation">{</span>
    items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token comment">-- 商品列表</span>
    total_price <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">-- 总价</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> shopping_cart<span class="token punctuation">:</span><span class="token function">add_item</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> price<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span>
    quantity <span class="token operator">=</span> quantity <span class="token keyword">or</span> <span class="token number">1</span>
    
    <span class="token comment">-- 检查是否已存在</span>
    <span class="token keyword">for</span> _<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> item<span class="token punctuation">.</span>name <span class="token operator">==</span> name <span class="token keyword">then</span>
            item<span class="token punctuation">.</span>quantity <span class="token operator">=</span> item<span class="token punctuation">.</span>quantity <span class="token operator">+</span> quantity
            item<span class="token punctuation">.</span>subtotal <span class="token operator">=</span> item<span class="token punctuation">.</span>price <span class="token operator">*</span> item<span class="token punctuation">.</span>quantity
            self<span class="token punctuation">.</span>total_price <span class="token operator">=</span> self<span class="token punctuation">.</span>total_price <span class="token operator">+</span> price <span class="token operator">*</span> quantity
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"已更新商品: "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">" x"</span> <span class="token operator">..</span> quantity<span class="token punctuation">)</span>
            
            <span class="token keyword">return</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    
    <span class="token comment">-- 新商品</span>
    <span class="token keyword">local</span> new_item <span class="token operator">=</span> <span class="token punctuation">{</span>
        name <span class="token operator">=</span> name<span class="token punctuation">,</span>
        price <span class="token operator">=</span> price<span class="token punctuation">,</span>
        quantity <span class="token operator">=</span> quantity<span class="token punctuation">,</span>
        subtotal <span class="token operator">=</span> price <span class="token operator">*</span> quantity
    <span class="token punctuation">}</span>
    
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">,</span> new_item<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>total_price <span class="token operator">=</span> self<span class="token punctuation">.</span>total_price <span class="token operator">+</span> new_item<span class="token punctuation">.</span>subtotal
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"已添加商品: "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">" x"</span> <span class="token operator">..</span> quantity<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> shopping_cart<span class="token punctuation">:</span><span class="token function">remove_item</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span>
    quantity <span class="token operator">=</span> quantity <span class="token keyword">or</span> <span class="token number">99999</span>  <span class="token comment">-- 默认移除全部</span>
    
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> item<span class="token punctuation">.</span>name <span class="token operator">==</span> name <span class="token keyword">then</span>
            <span class="token keyword">local</span> remove_qty <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>quantity<span class="token punctuation">,</span> item<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span>
            item<span class="token punctuation">.</span>quantity <span class="token operator">=</span> item<span class="token punctuation">.</span>quantity <span class="token operator">-</span> remove_qty
            item<span class="token punctuation">.</span>subtotal <span class="token operator">=</span> item<span class="token punctuation">.</span>price <span class="token operator">*</span> item<span class="token punctuation">.</span>quantity
            self<span class="token punctuation">.</span>total_price <span class="token operator">=</span> self<span class="token punctuation">.</span>total_price <span class="token operator">-</span> item<span class="token punctuation">.</span>price <span class="token operator">*</span> remove_qty
            
            <span class="token keyword">if</span> item<span class="token punctuation">.</span>quantity <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span>
                table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"已移除商品: "</span> <span class="token operator">..</span> name<span class="token punctuation">)</span>
            <span class="token keyword">else</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"已减少商品: "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">" x"</span> <span class="token operator">..</span> remove_qty <span class="token operator">..</span> <span class="token string">"，剩余: x"</span> <span class="token operator">..</span> item<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span>
            <span class="token keyword">end</span>
            
            <span class="token keyword">return</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"商品不存在: "</span> <span class="token operator">..</span> name<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> shopping_cart<span class="token punctuation">:</span><span class="token function">show_cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">#</span>self<span class="token punctuation">.</span>items <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"购物车为空"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"=== 购物车 ==="</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%d. %-15s 单价: %6.2f 数量: %3d 小计: %8.2f"</span><span class="token punctuation">,</span>
              i<span class="token punctuation">,</span> item<span class="token punctuation">.</span>name<span class="token punctuation">,</span> item<span class="token punctuation">.</span>price<span class="token punctuation">,</span> item<span class="token punctuation">.</span>quantity<span class="token punctuation">,</span> item<span class="token punctuation">.</span>subtotal<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    
    <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"\n总计: %.2f 元"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>total_price<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> shopping_cart<span class="token punctuation">:</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>total_price <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"已清空购物车"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试购物车系统</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"=== 购物车系统 ==="</span><span class="token punctuation">)</span>
shopping_cart<span class="token punctuation">:</span><span class="token function">add_item</span><span class="token punctuation">(</span><span class="token string">"苹果"</span><span class="token punctuation">,</span> <span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
shopping_cart<span class="token punctuation">:</span><span class="token function">add_item</span><span class="token punctuation">(</span><span class="token string">"香蕉"</span><span class="token punctuation">,</span> <span class="token number">3.2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
shopping_cart<span class="token punctuation">:</span><span class="token function">add_item</span><span class="token punctuation">(</span><span class="token string">"苹果"</span><span class="token punctuation">,</span> <span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">-- 增加苹果数量</span>

shopping_cart<span class="token punctuation">:</span><span class="token function">show_cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

shopping_cart<span class="token punctuation">:</span><span class="token function">remove_item</span><span class="token punctuation">(</span><span class="token string">"香蕉"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">-- 减少香蕉数量</span>

shopping_cart<span class="token punctuation">:</span><span class="token function">show_cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

shopping_cart<span class="token punctuation">:</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
shopping_cart<span class="token punctuation">:</span><span class="token function">show_cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">--[[ 输出
== 购物车系统 ===
已添加商品: 苹果 x2
已添加商品: 香蕉 x3
已更新商品: 苹果 x1
=== 购物车 ===
1. 苹果          单价:   5.50 数量:   3 小计:    16.50
2. 香蕉          单价:   3.20 数量:   3 小计:     9.60

总计: 38.90 元
已减少商品: 香蕉 x1，剩余: x2
=== 购物车 ===
1. 苹果          单价:   5.50 数量:   3 小计:    16.50
2. 香蕉          单价:   3.20 数量:   2 小计:     6.40

总计: 35.70 元
已清空购物车
购物车为空
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 8.1：简单的文本分析器" dir="auto" class="heading" id="练习_8.1：简单的文本分析器_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 8.1：简单的文本分析器</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> analysis <span class="token operator">=</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> analysis<span class="token punctuation">:</span><span class="token function">analyze_text</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">local</span> data <span class="token operator">=</span> self<span class="token punctuation">.</span>data

    <span class="token comment">-- 基本统计</span>
    data<span class="token punctuation">.</span>total_chars <span class="token operator">=</span> <span class="token operator">#</span>text
    <span class="token keyword">local</span> _<span class="token punctuation">,</span> lines <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">gsub</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>lines <span class="token operator">=</span> lines <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token comment">-- 单词统计</span>
    <span class="token keyword">local</span> word_pattern <span class="token operator">=</span> <span class="token string">"[%a\128-\255]+[%w\128-\255%-']*"</span>
    <span class="token keyword">local</span> words <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> word <span class="token keyword">in</span> string<span class="token punctuation">.</span><span class="token function">gmatch</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> word_pattern<span class="token punctuation">)</span> <span class="token keyword">do</span>
        word <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">lower</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span>
        words<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>words<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">end</span>

    data<span class="token punctuation">.</span>word_count <span class="token operator">=</span> <span class="token number">0</span>
    data<span class="token punctuation">.</span>most_frequent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> word<span class="token punctuation">,</span> count <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span> <span class="token keyword">do</span>
        data<span class="token punctuation">.</span>word_count <span class="token operator">=</span> data<span class="token punctuation">.</span>word_count <span class="token operator">+</span> count

        <span class="token comment">-- 记录最频繁的单词</span>
        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>most_frequent<span class="token punctuation">,</span> <span class="token punctuation">{</span> word <span class="token operator">=</span> word<span class="token punctuation">,</span> count <span class="token operator">=</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- 按频率排序</span>
    table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>most_frequent<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        <span class="token keyword">if</span> a<span class="token punctuation">.</span>count <span class="token operator">==</span> b<span class="token punctuation">.</span>count <span class="token keyword">then</span>
            <span class="token keyword">return</span> a<span class="token punctuation">.</span>word <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>word
        <span class="token keyword">end</span>

        <span class="token keyword">return</span> a<span class="token punctuation">.</span>count <span class="token operator">&gt;</span> b<span class="token punctuation">.</span>count
    <span class="token keyword">end</span><span class="token punctuation">)</span>

    <span class="token comment">-- 只保留前 5 个</span>
    <span class="token keyword">if</span> <span class="token operator">#</span>data<span class="token punctuation">.</span>most_frequent <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token keyword">then</span>
        <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">#</span>data<span class="token punctuation">.</span>most_frequent <span class="token keyword">do</span>
            data<span class="token punctuation">.</span>most_frequent<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试文本分析器</span>
<span class="token keyword">local</span> test_text <span class="token operator">=</span> <span class="token string">[[
Lua is a powerful, efficient, lightweight, embeddable scripting language.
It supports procedural programming, object-oriented programming, functional
programming, data-driven programming, and data description.

Lua combines simple procedural syntax with powerful data description
constructs based on associative arrays and extensible semantics.
Lua is dynamically typed, runs by interpreting bytecode with a
register-based virtual machine, and has automatic memory management with
incremental garbage collection, making it ideal for configuration,
scripting, and rapid prototyping.
]]</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"=== 文本分析器 ==="</span><span class="token punctuation">)</span>
analysis<span class="token punctuation">:</span><span class="token function">analyze_text</span><span class="token punctuation">(</span>test_text<span class="token punctuation">)</span>

<span class="token keyword">local</span> data <span class="token operator">=</span> analysis<span class="token punctuation">.</span>data

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"基本统计:"</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  总字符数: "</span> <span class="token operator">..</span> data<span class="token punctuation">.</span>total_chars<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  行数: "</span> <span class="token operator">..</span> data<span class="token punctuation">.</span>lines<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  单词数: "</span> <span class="token operator">..</span> data<span class="token punctuation">.</span>word_count<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n 最频繁的单词:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>most_frequent<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"  %2d. %-15s: %d 次"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> item<span class="token punctuation">.</span>word<span class="token punctuation">,</span> item<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token comment">--[[ 输出
基本统计:
  总字符数: 582
  行数: 11
  单词数: 70

 最频繁的单词:
   1. and            : 4 次
   2. programming    : 4 次
   3. lua            : 3 次
   4. with           : 3 次
   5. a              : 2 次
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 9.1：创建一个日志模块" dir="auto" class="heading" id="练习_9.1：创建一个日志模块_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 9.1：创建一个日志模块</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> log <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

log<span class="token punctuation">.</span>LEVEL_NAMES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"INFO"</span><span class="token punctuation">,</span>
    <span class="token string">"ERROR"</span>
<span class="token punctuation">}</span>

<span class="token comment">-- 创建新的日志实例</span>
<span class="token keyword">function</span> log<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">local</span> logger <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">-- 添加日志方法</span>
    <span class="token keyword">for</span> _<span class="token punctuation">,</span> level_name <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>LEVEL_NAMES<span class="token punctuation">)</span> <span class="token keyword">do</span>
        logger<span class="token punctuation">[</span>string<span class="token punctuation">.</span><span class="token function">lower</span><span class="token punctuation">(</span>level_name<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
            log<span class="token punctuation">:</span><span class="token function">_log</span><span class="token punctuation">(</span>level_name<span class="token punctuation">,</span> name<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> logger
<span class="token keyword">end</span>

<span class="token comment">-- 内部日志方法</span>
<span class="token keyword">function</span> log<span class="token punctuation">:</span><span class="token function">_log</span><span class="token punctuation">(</span>level_name<span class="token punctuation">,</span> name<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token comment">-- 格式化消息</span>
    message <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>

    <span class="token comment">-- 构建日志前缀</span>
    <span class="token keyword">local</span> log_line <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"[%s] %s: %s"</span><span class="token punctuation">,</span> level_name<span class="token punctuation">,</span> name<span class="token punctuation">,</span> message<span class="token punctuation">)</span>

    <span class="token function">print</span><span class="token punctuation">(</span>log_line<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">return</span> log
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 10.2：模拟数据库操作错误处理" dir="auto" class="heading" id="练习_10.2：模拟数据库操作错误处理_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 10.2：模拟数据库操作错误处理</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 创建结构化的错误类型，便于处理</span>
<span class="token comment">-- 错误类型定义</span>
<span class="token keyword">local</span> error_types <span class="token operator">=</span> <span class="token punctuation">{</span>
    VALIDATION <span class="token operator">=</span> <span class="token punctuation">{</span>
        code <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
        name <span class="token operator">=</span> <span class="token string">"VALIDATION_ERROR"</span><span class="token punctuation">,</span>
        description <span class="token operator">=</span> <span class="token string">"输入验证失败"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    DATABASE <span class="token operator">=</span> <span class="token punctuation">{</span>
        code <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
        name <span class="token operator">=</span> <span class="token string">"DATABASE_ERROR"</span><span class="token punctuation">,</span>
        description <span class="token operator">=</span> <span class="token string">"数据库操作失败"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    NETWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
        code <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span>
        name <span class="token operator">=</span> <span class="token string">"NETWORK_ERROR"</span><span class="token punctuation">,</span>
        description <span class="token operator">=</span> <span class="token string">"网络通信失败"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    PERMISSION <span class="token operator">=</span> <span class="token punctuation">{</span>
        code <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">,</span>
        name <span class="token operator">=</span> <span class="token string">"PERMISSION_ERROR"</span><span class="token punctuation">,</span>
        description <span class="token operator">=</span> <span class="token string">"权限不足"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    INTERNAL <span class="token operator">=</span> <span class="token punctuation">{</span>
        code <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
        name <span class="token operator">=</span> <span class="token string">"INTERNAL_ERROR"</span><span class="token punctuation">,</span>
        description <span class="token operator">=</span> <span class="token string">"内部服务器错误"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">-- 错误创建函数</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">create_error</span><span class="token punctuation">(</span>error_type<span class="token punctuation">,</span> message<span class="token punctuation">,</span> details<span class="token punctuation">)</span>
    <span class="token keyword">local</span> error_info <span class="token operator">=</span> error_types<span class="token punctuation">[</span>error_type<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> error_info <span class="token keyword">then</span>
        error_info <span class="token operator">=</span> error_types<span class="token punctuation">.</span>INTERNAL
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type <span class="token operator">=</span> error_type<span class="token punctuation">,</span>
        code <span class="token operator">=</span> error_info<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
        name <span class="token operator">=</span> error_info<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        message <span class="token operator">=</span> message <span class="token keyword">or</span> error_info<span class="token punctuation">.</span>description<span class="token punctuation">,</span>
        details <span class="token operator">=</span> details<span class="token punctuation">,</span>
        timestamp <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        stack_trace <span class="token operator">=</span> debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token keyword">end</span>

<span class="token comment">-- 错误抛出函数</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">throw_error</span><span class="token punctuation">(</span>error_type<span class="token punctuation">,</span> message<span class="token punctuation">,</span> details<span class="token punctuation">)</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token function">create_error</span><span class="token punctuation">(</span>error_type<span class="token punctuation">,</span> message<span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 错误处理函数</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">handle_error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
    <span class="token comment">-- 如果是我们的自定义错误</span>
    <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"table"</span> <span class="token keyword">and</span> err<span class="token punctuation">.</span>code <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"[错误处理] 类型: %s (%d)"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>name<span class="token punctuation">,</span> err<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"          消息: %s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> err<span class="token punctuation">.</span>details <span class="token keyword">then</span>
            <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"          详情: %s"</span><span class="token punctuation">,</span> <span class="token function">tostring</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>details<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token keyword">if</span> context <span class="token keyword">then</span>
            <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"          上下文: %s"</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"          调用栈:"</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack_trace<span class="token punctuation">)</span>

        <span class="token comment">-- 根据错误类型采取不同措施</span>
        <span class="token keyword">if</span> err<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"VALIDATION"</span> <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> <span class="token string">"输入错误，请检查后重试"</span>
        <span class="token keyword">elseif</span> err<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"PERMISSION"</span> <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> <span class="token string">"权限不足，请联系管理员"</span>
        <span class="token keyword">elseif</span> err<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"NETWORK"</span> <span class="token keyword">then</span>
            <span class="token comment">-- 可以尝试重试</span>
            <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> <span class="token string">"网络错误，请稍后重试"</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> <span class="token string">"系统错误，请联系技术支持"</span>
        <span class="token keyword">end</span>
    <span class="token keyword">else</span>
        <span class="token comment">-- 其他类型的错误</span>
        <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> <span class="token string">"未知错误: "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 模拟数据库连接</span>
<span class="token keyword">local</span> data_base <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> data_base<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        host <span class="token operator">=</span> config<span class="token punctuation">.</span>host <span class="token keyword">or</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
        port <span class="token operator">=</span> config<span class="token punctuation">.</span>port <span class="token keyword">or</span> <span class="token number">3306</span><span class="token punctuation">,</span>
        username <span class="token operator">=</span> config<span class="token punctuation">.</span>username <span class="token keyword">or</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
        password <span class="token operator">=</span> config<span class="token punctuation">.</span>password <span class="token keyword">or</span> <span class="token string">""</span><span class="token punctuation">,</span>
        database <span class="token operator">=</span> config<span class="token punctuation">.</span>database <span class="token keyword">or</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
        connected <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
        transaction_active <span class="token operator">=</span> <span class="token keyword">false</span>
    <span class="token punctuation">}</span>

    <span class="token comment">-- 连接数据库</span>
    <span class="token keyword">function</span> instance<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>connected <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token keyword">true</span>
        <span class="token keyword">end</span>

        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"  连接数据库 %s:%d..."</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">-- 模拟连接错误</span>
		<span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"NETWORK"</span><span class="token punctuation">,</span> <span class="token string">"数据库连接失败"</span><span class="token punctuation">,</span>
			<span class="token punctuation">{</span> host <span class="token operator">=</span> self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> port <span class="token operator">=</span> self<span class="token punctuation">.</span>port <span class="token punctuation">}</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token keyword">true</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  连接成功"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- 执行查询</span>
    <span class="token keyword">function</span> instance<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>connected <span class="token keyword">then</span>
            <span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"DATABASE"</span><span class="token punctuation">,</span> <span class="token string">"数据库未连接"</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"  执行查询: %s"</span><span class="token punctuation">,</span> sql<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> params <span class="token keyword">then</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  参数: "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token comment">-- 模拟查询错误</span>
        <span class="token keyword">if</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"DROP TABLE"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"DELETE"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>transaction_active <span class="token keyword">then</span>
                <span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"DATABASE"</span><span class="token punctuation">,</span> <span class="token string">"危险操作需要在事务中执行"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> sql <span class="token operator">=</span> sql <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>

        <span class="token keyword">if</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"SELECT"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"nonexistent"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"DATABASE"</span><span class="token punctuation">,</span> <span class="token string">"查询的表不存在"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> sql <span class="token operator">=</span> sql <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token keyword">if</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"INSERT"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> params <span class="token keyword">and</span> params<span class="token punctuation">.</span>email <span class="token keyword">then</span>
            <span class="token comment">-- 模拟唯一约束冲突</span>
            <span class="token keyword">if</span> params<span class="token punctuation">.</span>email <span class="token operator">==</span> <span class="token string">"duplicate@example.com"</span> <span class="token keyword">then</span>
                <span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"DATABASE"</span><span class="token punctuation">,</span> <span class="token string">"重复的邮箱地址"</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span> sql <span class="token operator">=</span> sql<span class="token punctuation">,</span> email <span class="token operator">=</span> params<span class="token punctuation">.</span>email <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>

        <span class="token comment">-- 模拟成功响应</span>
        <span class="token keyword">if</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"SELECT"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"用户1"</span><span class="token punctuation">,</span> email <span class="token operator">=</span> <span class="token string">"user1@example.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"用户2"</span><span class="token punctuation">,</span> email <span class="token operator">=</span> <span class="token string">"user2@example.com"</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">elseif</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"INSERT"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> affected_rows <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> last_insert_id <span class="token operator">=</span> <span class="token number">100</span> <span class="token punctuation">}</span>
        <span class="token keyword">elseif</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"UPDATE"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> affected_rows <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span>
        <span class="token keyword">elseif</span> sql<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"DELETE"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> affected_rows <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span>
        <span class="token keyword">end</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- 开始事务</span>
    <span class="token keyword">function</span> instance<span class="token punctuation">:</span><span class="token function">begin_transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transaction_active <span class="token keyword">then</span>
            <span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"DATABASE"</span><span class="token punctuation">,</span> <span class="token string">"事务已在进行中"</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        self<span class="token punctuation">.</span>transaction_active <span class="token operator">=</span> <span class="token keyword">true</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  开始事务"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- 提交事务</span>
    <span class="token keyword">function</span> instance<span class="token punctuation">:</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>transaction_active <span class="token keyword">then</span>
            <span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"DATABASE"</span><span class="token punctuation">,</span> <span class="token string">"没有活动的事务"</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        self<span class="token punctuation">.</span>transaction_active <span class="token operator">=</span> <span class="token keyword">false</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  提交事务"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- 回滚事务</span>
    <span class="token keyword">function</span> instance<span class="token punctuation">:</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>transaction_active <span class="token keyword">then</span>
            <span class="token function">throw_error</span><span class="token punctuation">(</span><span class="token string">"DATABASE"</span><span class="token punctuation">,</span> <span class="token string">"没有活动的事务"</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        self<span class="token punctuation">.</span>transaction_active <span class="token operator">=</span> <span class="token keyword">false</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  回滚事务"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- 断开连接</span>
    <span class="token keyword">function</span> instance<span class="token punctuation">:</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transaction_active <span class="token keyword">then</span>
            self<span class="token punctuation">:</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token keyword">false</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  断开数据库连接"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- 安全执行（带错误处理）</span>
    <span class="token keyword">function</span> instance<span class="token punctuation">:</span><span class="token function">safe_execute</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
        <span class="token keyword">local</span> success<span class="token punctuation">,</span> result <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span> self<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> success <span class="token keyword">then</span>
            <span class="token comment">-- 如果是数据库错误，尝试重连</span>
            <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"table"</span> <span class="token keyword">and</span> result<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"DATABASE"</span> <span class="token keyword">then</span>
                <span class="token keyword">if</span> result<span class="token punctuation">.</span>message<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"连接"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> result<span class="token punctuation">.</span>message<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"断开"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
                    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  检测到连接问题，尝试重连..."</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token keyword">false</span>
                    <span class="token keyword">local</span> reconnect_success <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>connect<span class="token punctuation">,</span> self<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> reconnect_success <span class="token keyword">then</span>
                        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  重连成功，重试操作..."</span><span class="token punctuation">)</span>
                        success<span class="token punctuation">,</span> result <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span> self<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
                    <span class="token keyword">end</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> success <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> result
        <span class="token keyword">end</span>

        <span class="token keyword">return</span> result
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> instance
<span class="token keyword">end</span>

<span class="token comment">-- 使用数据库</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"数据库操作测试:"</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> db <span class="token operator">=</span> data_base<span class="token punctuation">.</span><span class="token function">new</span> <span class="token punctuation">{</span>
    host <span class="token operator">=</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
    database <span class="token operator">=</span> <span class="token string">"mydb"</span><span class="token punctuation">,</span>
    username <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>
    password <span class="token operator">=</span> <span class="token string">"secret"</span>
<span class="token punctuation">}</span>

<span class="token comment">-- 包装数据库操作为安全操作</span>
<span class="token keyword">function</span> <span class="token function">safe_database_operation</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> operation_name<span class="token punctuation">,</span> operation<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n操作: "</span> <span class="token operator">..</span> operation_name<span class="token punctuation">)</span>

    <span class="token keyword">local</span> result<span class="token punctuation">,</span> err <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">safe_execute</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> result <span class="token keyword">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  成功"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
    <span class="token keyword">else</span>
        <span class="token keyword">local</span> _<span class="token punctuation">,</span> user_msg <span class="token operator">=</span> <span class="token function">handle_error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> operation_name<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  失败: "</span> <span class="token operator">..</span> user_msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> err
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试各种操作</span>
<span class="token comment">-- 连接数据库</span>
<span class="token function">safe_database_operation</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"连接数据库"</span><span class="token punctuation">,</span> db<span class="token punctuation">.</span>connect<span class="token punctuation">)</span>

<span class="token comment">-- 查询数据</span>
<span class="token keyword">local</span> users<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">safe_database_operation</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"查询用户"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM users WHERE status = 'active'"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> users <span class="token keyword">then</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  查询到 "</span> <span class="token operator">..</span> <span class="token operator">#</span>users <span class="token operator">..</span> <span class="token string">" 个用户"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试插入重复数据</span>
<span class="token keyword">local</span> insert_result<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">safe_database_operation</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"插入用户"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users (name, email) VALUES (?, ?)"</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">"测试用户"</span><span class="token punctuation">,</span> <span class="token string">"duplicate@example.com"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token comment">-- 测试事务</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n测试事务操作:"</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> transaction_success<span class="token punctuation">,</span> transaction_err <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    db<span class="token punctuation">:</span><span class="token function">begin_transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">-- 多个操作</span>
    db<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"UPDATE accounts SET balance = balance - 100 WHERE id = 1"</span><span class="token punctuation">)</span>
    db<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"UPDATE accounts SET balance = balance + 100 WHERE id = 2"</span><span class="token punctuation">)</span>

    db<span class="token punctuation">:</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  事务执行成功"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token keyword">not</span> transaction_success <span class="token keyword">then</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  事务失败: "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>transaction_err<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> db<span class="token punctuation">.</span>transaction_active <span class="token keyword">then</span>
        db<span class="token punctuation">:</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 断开连接</span>
<span class="token function">safe_database_operation</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">"断开连接"</span><span class="token punctuation">,</span> db<span class="token punctuation">.</span>disconnect<span class="token punctuation">)</span>
<span class="token comment">--[[ 输出
操作: 连接数据库
  连接数据库 localhost:3306...
[错误处理] 类型: NETWORK_ERROR (300)
          消息: 数据库连接失败
          详情: table: 00E5CEA0
          上下文: 连接数据库
          调用栈:

stack traceback:
	test.lua:51: in function 'throw_error'
	test.lua:114: in function &lt;test.lua:104&gt;
	[C]: in function 'pcall'
	test.lua:213: in function 'safe_execute'
	test.lua:253: in function 'safe_database_operation'
	test.lua:267: in main chunk
	[C]: ?
  失败: 网络错误，请稍后重试

操作: 查询用户
  检测到连接问题，尝试重连...
  连接数据库 localhost:3306...
[错误处理] 类型: DATABASE_ERROR (200)
          消息: 数据库未连接
          上下文: 查询用户
          调用栈:

stack traceback:
	test.lua:51: in function 'throw_error'
	test.lua:126: in function &lt;test.lua:124&gt;
	(tail call): ?
	[C]: in function 'pcall'
	test.lua:213: in function 'safe_execute'
	test.lua:253: in function 'safe_database_operation'
	test.lua:270: in main chunk
	[C]: ?
  失败: 系统错误，请联系技术支持

操作: 插入用户
  检测到连接问题，尝试重连...
  连接数据库 localhost:3306...
[错误处理] 类型: DATABASE_ERROR (200)
          消息: 数据库未连接
          上下文: 插入用户
          调用栈:

stack traceback:
	test.lua:51: in function 'throw_error'
	test.lua:126: in function &lt;test.lua:124&gt;
	(tail call): ?
	[C]: in function 'pcall'
	test.lua:213: in function 'safe_execute'
	test.lua:253: in function 'safe_database_operation'
	test.lua:279: in main chunk
	[C]: ?
  失败: 系统错误，请联系技术支持

测试事务操作:
  开始事务
  事务失败: table: 00E5CF68
  回滚事务

操作: 断开连接
  断开数据库连接
  成功
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 11.1：实现一个数据管道系统" dir="auto" class="heading" id="练习_11.1：实现一个数据管道系统_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 11.1：实现一个数据管道系统</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 定义管道操作</span>
<span class="token keyword">local</span> pipeline_sys <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> pipeline_sys<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>source_iterator<span class="token punctuation">)</span>
    <span class="token keyword">local</span> pipeline <span class="token operator">=</span> <span class="token punctuation">{</span>
        source <span class="token operator">=</span> source_iterator<span class="token punctuation">,</span>
        operations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> pipeline<span class="token punctuation">:</span><span class="token function">map</span><span class="token punctuation">(</span>transform_func<span class="token punctuation">)</span>
        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>operations<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            type <span class="token operator">=</span> <span class="token string">"map"</span><span class="token punctuation">,</span>
            func <span class="token operator">=</span> transform_func
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">end</span>

    <span class="token keyword">function</span> pipeline<span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span>predicate_func<span class="token punctuation">)</span>
        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>operations<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            type <span class="token operator">=</span> <span class="token string">"filter"</span><span class="token punctuation">,</span>
            func <span class="token operator">=</span> predicate_func
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">end</span>

    <span class="token keyword">function</span> pipeline<span class="token punctuation">:</span><span class="token function">take</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>operations<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            type <span class="token operator">=</span> <span class="token string">"take"</span><span class="token punctuation">,</span>
            count <span class="token operator">=</span> n
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">end</span>

    <span class="token keyword">function</span> pipeline<span class="token punctuation">:</span><span class="token function">skip</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>operations<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            type <span class="token operator">=</span> <span class="token string">"skip"</span><span class="token punctuation">,</span>
            count <span class="token operator">=</span> n
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">end</span>

    <span class="token keyword">function</span> pipeline<span class="token punctuation">:</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">local</span> source_iter <span class="token operator">=</span> self<span class="token punctuation">.</span>source
        <span class="token keyword">local</span> skip_count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">local</span> take_count <span class="token operator">=</span> math<span class="token punctuation">.</span>huge

        <span class="token comment">-- 从操作中获取初始的skip和take值</span>
        <span class="token keyword">for</span> _<span class="token punctuation">,</span> op <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>operations<span class="token punctuation">)</span> <span class="token keyword">do</span>
            <span class="token keyword">if</span> op<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"skip"</span> <span class="token keyword">then</span>
                skip_count <span class="token operator">=</span> op<span class="token punctuation">.</span>count
            <span class="token keyword">elseif</span> op<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"take"</span> <span class="token keyword">then</span>
                take_count <span class="token operator">=</span> op<span class="token punctuation">.</span>count
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>

        <span class="token comment">-- 创建处理链</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span>
                <span class="token keyword">if</span> take_count <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span>
                    <span class="token keyword">return</span> <span class="token keyword">nil</span>
                <span class="token keyword">end</span>

                <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">source_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

                <span class="token keyword">if</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">nil</span> <span class="token keyword">then</span>
                    <span class="token keyword">return</span> <span class="token keyword">nil</span>
                <span class="token keyword">end</span>

                <span class="token keyword">local</span> processed <span class="token operator">=</span> values
                <span class="token keyword">local</span> should_emit <span class="token operator">=</span> <span class="token keyword">true</span>

                <span class="token keyword">if</span> skip_count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">then</span>
                    skip_count <span class="token operator">=</span> skip_count <span class="token operator">-</span> <span class="token number">1</span>
                    should_emit <span class="token operator">=</span> <span class="token keyword">false</span>
                <span class="token keyword">else</span>
                    <span class="token comment">-- 应用所有操作</span>
                    <span class="token keyword">for</span> _<span class="token punctuation">,</span> op <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>operations<span class="token punctuation">)</span> <span class="token keyword">do</span>
                        <span class="token keyword">if</span> op<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"map"</span> <span class="token keyword">then</span>
                            processed <span class="token operator">=</span> <span class="token punctuation">{</span> op<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token function">unpack</span><span class="token punctuation">(</span>processed<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
                        <span class="token keyword">elseif</span> op<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"filter"</span> <span class="token keyword">then</span>
                            <span class="token keyword">if</span> <span class="token keyword">not</span> op<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token function">unpack</span><span class="token punctuation">(</span>processed<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
                                should_emit <span class="token operator">=</span> <span class="token keyword">false</span>
                                <span class="token keyword">break</span>
                            <span class="token keyword">end</span>
                        <span class="token keyword">end</span>
                    <span class="token keyword">end</span>
                <span class="token keyword">end</span>

                <span class="token keyword">if</span> should_emit <span class="token keyword">then</span>
                    take_count <span class="token operator">=</span> take_count <span class="token operator">-</span> <span class="token number">1</span>
                    <span class="token keyword">return</span> <span class="token function">unpack</span><span class="token punctuation">(</span>processed<span class="token punctuation">)</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> pipeline
<span class="token keyword">end</span>

<span class="token comment">-- 测试数据管道</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"数据管道测试:"</span><span class="token punctuation">)</span>

<span class="token comment">-- 创建数据源</span>
<span class="token keyword">function</span> <span class="token function">number_source</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">)</span>
    <span class="token keyword">local</span> current <span class="token operator">=</span> from <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        current <span class="token operator">=</span> current <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">if</span> current <span class="token operator">&lt;=</span> to <span class="token keyword">then</span>
            <span class="token keyword">return</span> current
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 构建管道</span>
<span class="token keyword">local</span> pipeline <span class="token operator">=</span> pipeline_sys<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">number_source</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">return</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token comment">-- 只保留偶数</span>
pipeline<span class="token punctuation">:</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">end</span><span class="token punctuation">)</span>         <span class="token comment">-- 乘以2</span>
pipeline<span class="token punctuation">:</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                                   <span class="token comment">-- 跳过前3个</span>
pipeline<span class="token punctuation">:</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>                                   <span class="token comment">-- 取5个</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"管道处理结果:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> value <span class="token keyword">in</span> pipeline<span class="token punctuation">:</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
    io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>value <span class="token operator">..</span> <span class="token string">" "</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">-- 复杂管道示例</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n复杂管道示例:"</span><span class="token punctuation">)</span>

<span class="token comment">-- 模拟用户数据</span>
<span class="token keyword">function</span> <span class="token function">user_data_source</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> users <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">85</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">92</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"王五"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">78</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"赵六"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">88</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"钱七"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">95</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"孙八"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">65</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"周九"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">82</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"吴十"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">26</span><span class="token punctuation">,</span> score <span class="token operator">=</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">local</span> index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">local</span> user <span class="token operator">=</span> users<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        <span class="token keyword">if</span> user <span class="token keyword">then</span>
            <span class="token keyword">return</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">,</span> user<span class="token punctuation">.</span>score
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- 用户数据处理管道</span>
<span class="token keyword">local</span> user_pipeline <span class="token operator">=</span> pipeline_sys<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">user_data_source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
user_pipeline<span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">)</span>
    <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> <span class="token number">20</span> <span class="token keyword">and</span> age <span class="token operator">&lt;=</span> <span class="token number">30</span> <span class="token comment">-- 年龄在20-30之间</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>
user_pipeline<span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">)</span>
    <span class="token keyword">return</span> score <span class="token operator">&gt;=</span> <span class="token number">80</span> <span class="token comment">-- 分数80以上</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>
user_pipeline<span class="token punctuation">:</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">)</span>
    <span class="token comment">-- 添加评级</span>
    <span class="token keyword">local</span> rating
    <span class="token keyword">if</span> score <span class="token operator">&gt;=</span> <span class="token number">90</span> <span class="token keyword">then</span>
        rating <span class="token operator">=</span> <span class="token string">"优秀"</span>
    <span class="token keyword">elseif</span> score <span class="token operator">&gt;=</span> <span class="token number">85</span> <span class="token keyword">then</span>
        rating <span class="token operator">=</span> <span class="token string">"良好"</span>
    <span class="token keyword">else</span>
        rating <span class="token operator">=</span> <span class="token string">"合格"</span>
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">,</span> rating
<span class="token keyword">end</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"符合条件的用户:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">,</span> rating <span class="token keyword">in</span> user_pipeline<span class="token punctuation">:</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"  ID: %d, 姓名: %s, 年龄: %d, 分数: %d, 评级: %s"</span><span class="token punctuation">,</span>
        id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">,</span> rating<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token comment">--[[ 输出
数据管道测试:
管道处理结果:
8 12 16 20 24 

复杂管道示例:
符合条件的用户:
  ID: 1, 姓名: 张三, 年龄: 25, 分数: 85, 评级: 良好
  ID: 2, 姓名: 李四, 年龄: 30, 分数: 92, 评级: 优秀
  ID: 5, 姓名: 钱七, 年龄: 28, 分数: 95, 评级: 优秀
  ID: 8, 姓名: 吴十, 年龄: 26, 分数: 90, 评级: 优秀
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 12.1：使用协程实现生成器" dir="auto" class="heading" id="练习_12.1：使用协程实现生成器_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 12.1：使用协程实现生成器</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">range</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> step<span class="token punctuation">)</span>
    step <span class="token operator">=</span> step <span class="token keyword">or</span> <span class="token number">1</span>

    <span class="token keyword">return</span> coroutine<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token operator">=</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> step <span class="token keyword">do</span>
            coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 使用</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token comment">--[[ 输出
1
3
5
7
9
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 13.1：实现向量类" dir="auto" class="heading" id="练习_13.1：实现向量类_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 13.1：实现向量类</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 向量类实现</span>
Vector <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Vector<span class="token punctuation">.</span>__index <span class="token operator">=</span> Vector

<span class="token comment">-- 构造函数</span>
<span class="token keyword">function</span> Vector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token keyword">local</span> v <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> x<span class="token punctuation">,</span> y <span class="token operator">=</span> y<span class="token punctuation">}</span>
    <span class="token function">setmetatable</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> Vector<span class="token punctuation">)</span>
    <span class="token keyword">return</span> v
<span class="token keyword">end</span>

<span class="token comment">-- 加法</span>
<span class="token keyword">function</span> Vector<span class="token punctuation">.</span><span class="token function">__add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> Vector <span class="token keyword">and</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> Vector <span class="token keyword">then</span>
        <span class="token keyword">return</span> Vector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">,</span> a<span class="token punctuation">.</span>y <span class="token operator">+</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot add non-vector values"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 减法</span>
<span class="token keyword">function</span> Vector<span class="token punctuation">.</span><span class="token function">__sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> Vector <span class="token keyword">and</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> Vector <span class="token keyword">then</span>
        <span class="token keyword">return</span> Vector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">,</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot subtract non-vector values"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 乘法（点积）</span>
<span class="token keyword">function</span> Vector<span class="token punctuation">.</span><span class="token function">__mul</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> Vector <span class="token keyword">and</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> Vector <span class="token keyword">then</span>
        <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>y <span class="token operator">*</span> b<span class="token punctuation">.</span>y
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot multiply non-vector values"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 负号</span>
<span class="token keyword">function</span> Vector<span class="token punctuation">.</span><span class="token function">__unm</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> Vector <span class="token keyword">then</span>
        <span class="token keyword">return</span> Vector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">-</span>a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>a<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot negate non-vector value"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 字符串表示</span>
<span class="token keyword">function</span> Vector<span class="token punctuation">.</span><span class="token function">__tostring</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Vector(%d, %d)"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试代码</span>
<span class="token keyword">local</span> v1 <span class="token operator">=</span> Vector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> v2 <span class="token operator">=</span> Vector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">-- Vector(3, 4)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v2 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">-- Vector(1, 2)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 + v2 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>v1 <span class="token operator">+</span> v2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Vector(4, 6)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 - v2 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>v1 <span class="token operator">-</span> v2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Vector(2, 2)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 * v2 = "</span> <span class="token operator">..</span> <span class="token punctuation">(</span>v1 <span class="token operator">*</span> v2<span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">-- 11</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"-v1 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span><span class="token operator">-</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">-- Vector(-3, -4)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="练习 13.2：跟踪向量的修改" dir="auto" class="heading" id="练习_13.2：跟踪向量的修改_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>练习 13.2：跟踪向量的修改</h3></div><div class="el-pre"><pre class="language-lua"><code data-line="0" class="language-lua is-loaded"><span class="token comment">-- 带日志功能的向量类</span>
TrackedVector <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
TrackedVector<span class="token punctuation">.</span>__index <span class="token operator">=</span> TrackedVector

<span class="token comment">-- 构造函数</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token keyword">local</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> x<span class="token punctuation">,</span>
        y <span class="token operator">=</span> y<span class="token punctuation">,</span>
        _log <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">-- 日志记录</span>
    <span class="token punctuation">}</span>
    <span class="token function">setmetatable</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> TrackedVector<span class="token punctuation">)</span>

    <span class="token comment">-- 记录创建</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_log<span class="token punctuation">,</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"创建向量: Vector(%d, %d)"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> v
<span class="token keyword">end</span>

<span class="token comment">-- 添加日志条目</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span> operand<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
    <span class="token keyword">local</span> entry <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s: "</span><span class="token punctuation">,</span> operation<span class="token punctuation">)</span>

    <span class="token keyword">if</span> operand <span class="token keyword">then</span>
        entry <span class="token operator">=</span> entry <span class="token operator">..</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"与 %s "</span><span class="token punctuation">,</span> <span class="token function">tostring</span><span class="token punctuation">(</span>operand<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    entry <span class="token operator">=</span> entry <span class="token operator">..</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"运算, 结果: %s"</span><span class="token punctuation">,</span> <span class="token function">tostring</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_log<span class="token punctuation">,</span> entry<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 加法（带日志）</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">.</span><span class="token function">__add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> TrackedVector <span class="token keyword">and</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> TrackedVector <span class="token keyword">then</span>
        <span class="token keyword">local</span> result <span class="token operator">=</span> TrackedVector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">,</span> a<span class="token punctuation">.</span>y <span class="token operator">+</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

        <span class="token comment">-- 记录到两个向量的日志中</span>
        a<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span><span class="token string">"被加"</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
        b<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span><span class="token string">"加数"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> result<span class="token punctuation">)</span>

        <span class="token keyword">return</span> result
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot add non-vector values"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 减法（带日志）</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">.</span><span class="token function">__sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> TrackedVector <span class="token keyword">and</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> TrackedVector <span class="token keyword">then</span>
        <span class="token keyword">local</span> result <span class="token operator">=</span> TrackedVector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">,</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

        a<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span><span class="token string">"被减"</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
        b<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span><span class="token string">"减数"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> result<span class="token punctuation">)</span>

        <span class="token keyword">return</span> result
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot subtract non-vector values"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 乘法（点积，带日志）</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">.</span><span class="token function">__mul</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> TrackedVector <span class="token keyword">and</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> TrackedVector <span class="token keyword">then</span>
        <span class="token keyword">local</span> result <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>y <span class="token operator">*</span> b<span class="token punctuation">.</span>y

        a<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span><span class="token string">"点积"</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
        b<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span><span class="token string">"点积"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> result<span class="token punctuation">)</span>

        <span class="token keyword">return</span> result
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot multiply non-vector values"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 负号（带日志）</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">.</span><span class="token function">__unm</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">getmetatable</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> TrackedVector <span class="token keyword">then</span>
        <span class="token keyword">local</span> result <span class="token operator">=</span> TrackedVector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">-</span>a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>a<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        a<span class="token punctuation">:</span><span class="token function">_add_log</span><span class="token punctuation">(</span><span class="token string">"取负"</span><span class="token punctuation">,</span> <span class="token keyword">nil</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
    <span class="token keyword">end</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cannot negate non-vector value"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 获取日志</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">.</span><span class="token function">get_log</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">local</span> logs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">-- 添加向量基本信息</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>logs<span class="token punctuation">,</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"向量: %s"</span><span class="token punctuation">,</span> <span class="token function">tostring</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">-- 添加所有操作记录</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> entry <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_log<span class="token punctuation">)</span> <span class="token keyword">do</span>
        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>logs<span class="token punctuation">,</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%d. %s"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> logs
<span class="token keyword">end</span>

<span class="token comment">-- 字符串表示（与普通向量兼容）</span>
<span class="token keyword">function</span> TrackedVector<span class="token punctuation">.</span><span class="token function">__tostring</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Vector(%d, %d)"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 测试代码</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n\n=== 练习2：带日志的向量类测试 ==="</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> v1 <span class="token operator">=</span> TrackedVector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> v2 <span class="token operator">=</span> TrackedVector<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Vector(3, 4)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v2 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Vector(1, 2)</span>

<span class="token keyword">local</span> sum <span class="token operator">=</span> v1 <span class="token operator">+</span> v2
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 + v2 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Vector(4, 6)</span>

<span class="token keyword">local</span> diff <span class="token operator">=</span> v1 <span class="token operator">-</span> v2
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 - v2 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Vector(2, 2)</span>

<span class="token keyword">local</span> dot <span class="token operator">=</span> v1 <span class="token operator">*</span> v2
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"v1 * v2 = "</span> <span class="token operator">..</span> dot<span class="token punctuation">)</span> <span class="token comment">-- 11</span>

<span class="token keyword">local</span> neg <span class="token operator">=</span> <span class="token operator">-</span>v1
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"-v1 = "</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>neg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Vector(-3, -4)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n=== v1的操作日志 ==="</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> v1_logs <span class="token operator">=</span> v1<span class="token punctuation">:</span><span class="token function">get_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>v1_logs<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n=== v2的操作日志 ==="</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> v2_logs <span class="token operator">=</span> v2<span class="token punctuation">:</span><span class="token function">get_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>v2_logs<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">--[[ 输出
=== 练习2：带日志的向量类测试 ===
v1 = Vector(3, 4)
v2 = Vector(1, 2)
v1 + v2 = Vector(4, 6)
v1 - v2 = Vector(2, 2)
v1 * v2 = 11
-v1 = Vector(-3, -4)

=== v1的操作日志 ===
向量: Vector(3, 4)
1. 创建向量: Vector(3, 4)
2. 被加: 与 Vector(1, 2) 运算, 结果: Vector(4, 6)
3. 被减: 与 Vector(1, 2) 运算, 结果: Vector(2, 2)
4. 点积: 与 Vector(1, 2) 运算, 结果: 11
5. 取负: 运算, 结果: Vector(-3, -4)

=== v2的操作日志 ===
向量: Vector(1, 2)
1. 创建向量: Vector(1, 2)
2. 加数: 与 Vector(3, 4) 运算, 结果: Vector(4, 6)
3. 减数: 与 Vector(3, 4) 运算, 结果: Vector(2, 2)
4. 点积: 与 Vector(3, 4) 运算, 结果: 11
--]]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="第-1-节-语法/参考答案.html#参考答案_0" data-path="#参考答案_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="参考答案">参考答案</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="第-1-节-语法/参考答案.html#**本篇为所有练习的参考答案，下滑查看**_0" data-path="#**本篇为所有练习的参考答案，下滑查看**_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="**本篇为所有练习的参考答案，下滑查看**"><strong>本篇为所有练习的参考答案，下滑查看</strong></div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#**练习_2.2**：判断以下哪些是合法的标识符：_0" data-path="#**练习_2.2**：判断以下哪些是合法的标识符：_0"><div class="tree-item-inner heading-link" heading-name="**练习 2.2**：判断以下哪些是合法的标识符："><strong>练习 2.2</strong>：判断以下哪些是合法的标识符：</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_2.3：创建一个自我介绍程序_0" data-path="#练习_2.3：创建一个自我介绍程序_0"><div class="tree-item-inner heading-link" heading-name="练习 2.3：创建一个自我介绍程序">练习 2.3：创建一个自我介绍程序</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_3.1：数据类型识别_0" data-path="#练习_3.1：数据类型识别_0"><div class="tree-item-inner heading-link" heading-name="练习 3.1：数据类型识别">练习 3.1：数据类型识别</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_4.1：简单计算器_0" data-path="#练习_4.1：简单计算器_0"><div class="tree-item-inner heading-link" heading-name="练习 4.1：简单计算器">练习 4.1：简单计算器</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_5.1：猜数字游戏_0" data-path="#练习_5.1：猜数字游戏_0"><div class="tree-item-inner heading-link" heading-name="练习 5.1：猜数字游戏">练习 5.1：猜数字游戏</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_5.2：打印图形_0" data-path="#练习_5.2：打印图形_0"><div class="tree-item-inner heading-link" heading-name="练习 5.2：打印图形">练习 5.2：打印图形</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_6.1：简单的计算器函数库_0" data-path="#练习_6.1：简单的计算器函数库_0"><div class="tree-item-inner heading-link" heading-name="练习 6.1：简单的计算器函数库">练习 6.1：简单的计算器函数库</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_6.2：提取函数，优化代码_0" data-path="#练习_6.2：提取函数，优化代码_0"><div class="tree-item-inner heading-link" heading-name="练习 6.2：提取函数，优化代码">练习 6.2：提取函数，优化代码</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_7.1：简单的联系人管理系统_0" data-path="#练习_7.1：简单的联系人管理系统_0"><div class="tree-item-inner heading-link" heading-name="练习 7.1：简单的联系人管理系统">练习 7.1：简单的联系人管理系统</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_7.2：购物车系统_0" data-path="#练习_7.2：购物车系统_0"><div class="tree-item-inner heading-link" heading-name="练习 7.2：购物车系统">练习 7.2：购物车系统</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_8.1：简单的文本分析器_0" data-path="#练习_8.1：简单的文本分析器_0"><div class="tree-item-inner heading-link" heading-name="练习 8.1：简单的文本分析器">练习 8.1：简单的文本分析器</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_9.1：创建一个日志模块_0" data-path="#练习_9.1：创建一个日志模块_0"><div class="tree-item-inner heading-link" heading-name="练习 9.1：创建一个日志模块">练习 9.1：创建一个日志模块</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_10.2：模拟数据库操作错误处理_0" data-path="#练习_10.2：模拟数据库操作错误处理_0"><div class="tree-item-inner heading-link" heading-name="练习 10.2：模拟数据库操作错误处理">练习 10.2：模拟数据库操作错误处理</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_11.1：实现一个数据管道系统_0" data-path="#练习_11.1：实现一个数据管道系统_0"><div class="tree-item-inner heading-link" heading-name="练习 11.1：实现一个数据管道系统">练习 11.1：实现一个数据管道系统</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_12.1：使用协程实现生成器_0" data-path="#练习_12.1：使用协程实现生成器_0"><div class="tree-item-inner heading-link" heading-name="练习 12.1：使用协程实现生成器">练习 12.1：使用协程实现生成器</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_13.1：实现向量类_0" data-path="#练习_13.1：实现向量类_0"><div class="tree-item-inner heading-link" heading-name="练习 13.1：实现向量类">练习 13.1：实现向量类</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="第-1-节-语法/参考答案.html#练习_13.2：跟踪向量的修改_0" data-path="#练习_13.2：跟踪向量的修改_0"><div class="tree-item-inner heading-link" heading-name="练习 13.2：跟踪向量的修改">练习 13.2：跟踪向量的修改</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>