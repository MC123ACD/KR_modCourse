# 技能规范
`entity_attacks` 函数负责实现所有具有普适性的主动技能

1. 该函数返回的第一个参数，为 `true` 代表跳过 entity 之后的逻辑，为 `false` 代表可继续，为 `nil` 代表可跳可不跳

2. 返回的第二个参数，没有合适的目标时返回 `A_NO_TARGET`，技能已施放时返回 `A_DONE`。其他情况返回 `nil`。

entity_attacks 第三个传入参数 a 的专用键值对：
skill：类型 string。代表使用哪一种技能。比如"range_unit"。
vis_bans：类型 integer。代表禁止对哪些目标施放技能。如果想禁止对友方单位施放技能，设置为 F_FRIEND。如果想禁止对敌我单位施放技能，设置为 bor (F_FRIEND, F_ENEMY)。
basic_attack：类型 boolean。代表是否为基础攻击。true 代表是。
animation：类型 string。代表施放技能的动画。
cast_time：类型 number。代表技能前摇。
sound：类型 string。代表施法时播放的声音。
sound_args：类型 table。格式为{delay = 0.1, ...}。代表施法时播放声音的参数。需配合 sound 使用。
power_name：类型 string。代表技能所对应的升级名字。
initial_level：类型 number。代表技能的初始等级，在技能升级时使用。需配合 power_name 使用。仅对 shooter 生效。
can_be_silenced：类型 boolean。代表技能是否可以被沉默。
disabled_if_having_modifiers：类型 table。格式为{"xxx", ...}。xxx 为 modifier 的名字。代表 entity 身上有某些 modifier 时，技能被禁用。
melee_break：类型 boolean。代表技能是否可在近战时施放。true 代表可以。
ranged_break：类型 boolean。代表技能是否可在远程攻击时施放。true 代表可以。仅对敌方单位生效。
skill_id：类型 string。代表技能的标识。需配合 skills_interval，reset_partners_skill 或者 extra_cooldowns 使用。
skills_interval：类型 number。代表同一组士兵或射手的，拥有同一个 skill_id 的技能的施放间隔。比如四级鱼人塔士兵的掷网，当一个士兵掷网后，另一个士兵将间隔 1 秒后才能掷网。
reset_partners_skill：类型 boolean。代表技能施放后，是否重置同一组士兵或射手的，拥有同一个 skill_id 的技能的冷却。true 代表重置。
extra_cooldowns：类型 table。格式为{{skill_id = "xxx", extra_cooldown = -1}, ...}。表示技能施放后，增加此 entity 的带有相同 skill_id 的技能的冷却。
增加的时间为 extra_cooldown 所对应的数值，可为负数。
search_type：类型 number。代表搜索目标的模式。可选的值如下：
U.search_type = {
	nearest = 1,
	farthest = 2,
	random = 3,
	max_health = 4,
	min_health = 5,
	close_to_exit = 6,-- 最接近终点
	far_from_exit = 7,-- 最远离终点
	find_max_crowd = 8,-- 最密集
	max_initial_health = 9,-- 最大生命值最多
	min_initial_health = 10,-- 最大生命值最少
}
crowd_range：类型 number。只有 search_type 为U.search_type. find_max_crowd 时有效。需配合 min_targets 使用。
min_targets：类型 integer。只有 search_type 为U.search_type. find_max_crowd 时有效。需配合 crowd_range 使用。此时搜索条件之一为：
主目标周围 crowd_range 范围内的目标总数（包含主目标）大于等于 min_targets。

向某个目标射出投射物的技能 range_unit，专用键值对：
bullet：类型 string。代表投射物的名字。
bullet_start_offset：类型 table。格式{v (1, 1), ...}。代表投射物相对 entity 的初始位置。
node_prediction：类型 number。代表技能的预判时间。通常与投射物的飞行时间一致。
allowed_templates：类型 table。格式为{"xxx", ...}。xxx 为目标的名字。代表名字在 allowed_templates 中的目标，才会被施放技能。
excluded_templates：类型 table。格式为{"xxx", ...}。xxx 为目标的名字。代表名字在 excluded_templates 中的目标，不会被施放技能。
max_bullets：类型 integer。代表单次发射的投射物数量。
same_target：类型 boolean。代表单次发射的多个投射物是否瞄准同一个目标。true 代表是，false 代表尽可能瞄准不同的目标。需配合 max_bullets 使用。
use_center：类型 boolean。代表是否瞄准中间的子路径。true 代表是。
animation_prepare：类型 string。代表施放技能前的准备动画。
loops：类型 integer。代表连续施放技能的次数。
animation_start：类型 string。代表开始施放技能的动画。需配合 loops 使用。
animation_loop：类型 string。代表连续施放技能时的动画。需配合 loops 使用。
animation_end：类型 string。代表施放技能结束的动画。需配合 loops 使用。
shoot_times：类型 table。代表连续施法时，单次施法的发射时间。需配合 loops 使用。比如 shoot_times 为{0.1, 0.2}，loops 为 3 时，代表连续施法 3 次，
每次施法，都是在 0.1 秒后射出第一发投射物，然后在 0.2 秒后射出第二发投射物。
different_targets：类型 boolean。代表连续施法时的单次发射，是否尽可能瞄准不同的目标。true 代表是。
target_id：类型 integer。代表目标的 id。如果这个键值对存在，会忽略所有条件，直接向目标施法。

向施法者附近的路径节点射出投射物的技能 range_at_path，专用键值对：
bullet：类型 string。代表投射物的名字。
bullet_start_offset：类型 table。格式{v (1, 1), ...}。代表投射物相对 entity 的初始位置。
use_center：类型 boolean。代表是否瞄准中间的子路径。true 代表是。
min_targets：类型 integer。代表探测到的目标数量大于等于 min_targets 时，才会施放技能。
range_nodes：类型 integer。代表探测模式为沿路径探测目标，探测范围为 range_nodes 个节点，该模式只能用于探测敌方单位。
range：类型 number。代表探测模式为根据距离探测目标，探测半径为 range，如果设置了 range_nodes，此键值对无效。
min_nodes：类型 integer。代表施法时相对施法者位置，可选取的最小节点。可为负数，负数时靠近路径起点，正数时靠近路径终点。
max_nodes：类型 integer。代表施法时相对施法者位置，可选取的最大节点。可为负数，负数时靠近路径起点，正数时靠近路径终点。
max_bullets：类型 integer。代表发射的投射物数量。

在施法者附近添加 entity 的技能 spawner，专用键值对：
min_targets：类型 integer。代表探测到的目标数量大于等于 min_targets 时，才会施放技能。
range_nodes：类型 integer。代表探测模式为沿路径探测目标，探测范围为 range_nodes 个节点，该模式只能用于探测敌方单位。
range：类型 number。代表探测模式为根据距离探测目标，探测半径为 range，如果设置了 range_nodes，此键值对无效。
custom_spawn_points：类型 table。格式为{v (1, 1), ...}。代表被召唤的 entity 相对施法者的出生位置。
max_count：类型 integer。代表被召唤的 entity 的数量。
spawn_delay：类型 number。代表召唤 entity 的间隔时间。
entity_names：类型 table。格式为{"xxx", ...}。xxx 为被添加的 entity 的名字。需配合 entity_chances 使用。
entity_chances：类型 table。格式为{0.1, ...}。代表被召唤的 entity 的出现概率。entity_chances 与 entity_names 的长度相同，且表中所有概率之和为 1。
nodes_to_entrance：类型 integer。施法者距路径起点小于等于 nodes_to_entrance 个节点时禁止施法。设置了 custom_spawn_points 时无效。
nodes_to_exit：类型 integer。施法者距路径终点小于等于 nodes_to_exit 个节点时禁止施法。设置了 custom_spawn_points 时无效。
min_nodes：类型 integer。施法时相对施法者位置，可选取的最小节点。可为负数，负数时靠近路径起点，正数时靠近路径终点。设置了 custom_spawn_points 时无效。
max_nodes：类型 integer。施法时相对施法者位置，可选取的最大节点。可为负数，负数时靠近路径起点，正数时靠近路径终点。设置了 custom_spawn_points 时无效。
use_center：类型 boolean。代表是否选取中间的子路径。true 代表是。设置了 custom_spawn_points 时无效。
random_subpath：类型 boolean。代表是否随机选择子路径。true 代表是。设置了 custom_spawn_points 或 use_center 时无效。

向目标所在位置添加 entity 的技能 object_on_target，专用键值对：
target_id：类型 integer。代表目标的 id。如果这个键值对存在，会忽略所有条件，直接向目标施法。
entity：类型 string。代表被添加的 entity 的名字。
use_center：类型 boolean。代表是否选取中间的子路径。true 代表是。
use_caster_position：类型 boolean。代表是否选择施法者的位置，来代替目标所在位置。true 代表是。
delay：类型 number。代表完成施法前摇后，entity 出现的延迟时间。
